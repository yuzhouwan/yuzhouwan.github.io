<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/yuzhouwan_logo_with_copyright.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/yuzhouwan_logo_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/yuzhouwan_logo_16x16.ico">
  <link rel="mask-icon" href="/yuzhouwan_logo_with_copyright.jpg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yuzhouwan.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":5,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":{"valine":{"text":"Valine：匿名","order":-1},"disqus":{"text":"Disqus：海外","order":-2},"gitalk":{"text":"Gitalk：可用 Github 账号登录","order":-3}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="介绍 Linux 相关的命令、Shell 编程、实用技巧、优化实战和系统架构相关知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 实战技巧">
<meta property="og:url" content="https://yuzhouwan.com/posts/15691/">
<meta property="og:site_name" content="宇宙湾">
<meta property="og:description" content="介绍 Linux 相关的命令、Shell 编程、实用技巧、优化实战和系统架构相关知识。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1020982-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1217710-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1670647-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-5366753-blue.svg">
<meta property="article:published_time" content="2017-04-07T12:30:58.000Z">
<meta property="article:modified_time" content="2020-10-29T13:44:24.888Z">
<meta property="article:author" content="Benedict Jin">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1020982-blue.svg">

<link rel="canonical" href="https://yuzhouwan.com/posts/15691/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Linux 实战技巧 | 宇宙湾</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97020848-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-97020848-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.null { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .null > span { position: relative; z-index: 10; }  .null img, .null .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .null img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .null-fallback { color: inherit; } .null-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="宇宙湾" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">宇宙湾</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">厚积薄发</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">144</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">52</span></a>

  </li>
        <li class="menu-item menu-item-书单">

    <a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i>书单</a>

  </li>
        <li class="menu-item menu-item-影视">

    <a href="/movies/" rel="section"><i class="fa fa-film fa-fw"></i>影视</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yuzhouwan.com/posts/15691/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/yuzhouwan_logo_128x128.ico">
      <meta itemprop="name" content="Benedict Jin">
      <meta itemprop="description" content="Benedict Jin's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇宙湾">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux 实战技巧
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-07 20:30:58" itemprop="dateCreated datePublished" datetime="2017-04-07T20:30:58+08:00">2017-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-29 21:44:24" itemprop="dateModified" datetime="2020-10-29T21:44:24+08:00">2020-10-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">语言</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>25 分钟</span>
            </span>
            <div class="post-description">介绍 Linux 相关的命令、Shell 编程、实用技巧、优化实战和系统架构相关知识。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="adduser"><a href="#adduser" class="headerlink" title="adduser"></a>adduser</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以创建 Apache Eagle 用户为例</span></span><br><span class="line">$ adduser eagle</span><br><span class="line">$ passwd eagle            <span class="comment"># ur password for eagle user</span></span><br><span class="line"><span class="comment"># 赋予用户可以 sudo 的权限</span></span><br><span class="line">$ chmod u+w /etc/sudoers</span><br><span class="line">$ vim /etc/sudoers</span><br><span class="line">  <span class="comment"># 找到 `root ALL=(ALL) ALL` 这行，并在下面添加 eagle 用户</span></span><br><span class="line">  eagle    ALL=(ALL)    ALL</span><br><span class="line">$ chmod u-w /etc/sudoers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 eagle 用户</span></span><br><span class="line">$ su - eagle</span><br></pre></td></tr></tbody></table></figure>
<h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'1'</span> &gt;&gt; sum</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'2'</span> &gt;&gt; sum</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'3'</span> &gt;&gt; sum</span><br><span class="line">$ cat sum</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat sum | awk <span class="string">'{s+=$1} END {print s}'</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'{s+=$1} END {print s}'</span> sum</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6</span><br></pre></td></tr></tbody></table></figure>
<h3 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载并一键执行 Shell 脚本，更多相关内容：https://yuzhouwan.com/posts/666/</span></span><br><span class="line">$ bash -c <span class="string">"<span class="subst">$(curl -L https://raw.githubusercontent.com/asdf2014/algorithm/master/first_commit.sh)</span>"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看系统版本</span></span><br><span class="line">$ cat /etc/issue</span><br><span class="line">  Yuzhouwan Group Enterprise Linux Server release 7.2</span><br></pre></td></tr></tbody></table></figure>
<h3 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 软链接</span></span><br><span class="line">$ chown -h superset:superset superset</span><br><span class="line"><span class="comment"># 所有子目录及文件</span></span><br><span class="line">$ chown -R superset:superset superset-0.15.4</span><br></pre></td></tr></tbody></table></figure>
<h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -r 拷贝目录</span></span><br><span class="line"><span class="comment"># -p 保留源文件或目录的属性，包括所有者、所属组、权限与时间</span></span><br><span class="line"><span class="comment"># -u 只会在源文件的修改时间，相比目的文件的修改时间更新时，或是对应的目的文件不存在，才执行复制</span></span><br><span class="line"><span class="comment"># -v 打印拷贝了哪些文件</span></span><br><span class="line">$ cp -r -p -u -v ../* /</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过如下方式，可以避免源文件不存在而导致的报错</span></span><br><span class="line">$ cp ~/does_not_exist ~/somewhere 2&gt;/dev/null | <span class="literal">true</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"always get here"</span></span><br></pre></td></tr></tbody></table></figure>
<div class="note info">为了避免别名的影响，可以使用 /bin/cp 原生的命令，或者 unalias cp 消除别名</div>

<h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看脚本是否执行</span></span><br><span class="line">$ tail -f /var/<span class="built_in">log</span>/cron</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防止 nohup 的定时任务发邮件给 root，导致 var 目录堆积（/var/spool/cron）</span></span><br><span class="line">$ crontab -e</span><br><span class="line">  <span class="comment"># 加在文件开头</span></span><br><span class="line">  MAILTO=<span class="string">""</span></span><br></pre></td></tr></tbody></table></figure>
<a id="more"></a>
<h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送 Post 请求</span></span><br><span class="line">$ curl -H <span class="string">"Content-Type:application/json"</span> -X POST --data <span class="string">'{"blog":"yuzhouwan"}'</span> localhost:8080/api/query</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送的 Put 请求中带时间戳</span></span><br><span class="line"><span class="keyword">for</span> (( i=1; i&lt;=100; i++ )); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">'[{"ts": "yuzhouwan_'</span>`date <span class="string">"+%s"</span>`<span class="string">'"}]'</span> &gt; id.data;  curl -s -X POST -H <span class="string">"Content-Type: application/json"</span> http://yuzhouwan:8081/api/put -d <span class="string">"@id.data"</span> ; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 gzip 压缩的请求</span></span><br><span class="line">$ gzip raw</span><br><span class="line">$ curl -X POST --data-binary <span class="string">"@raw.gz"</span> --header <span class="string">"Content-Type: application/json"</span> --header <span class="string">"Content-Encoding: gzip"</span> http://yuzhouwan:8888/gzip_api</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看公网 IP</span></span><br><span class="line">$ curl cip.cc</span><br></pre></td></tr></tbody></table></figure>
<h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该时间戳格式为 13 位毫秒级别</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"`date -d '2017-04-21 10:00:00' +%s`000"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印时间戳</span></span><br><span class="line">$ date +%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化时间戳</span></span><br><span class="line">$ date <span class="string">'+%Y-%m-%d %H:%M:%S'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印纳秒</span></span><br><span class="line">$ date <span class="string">"+%s%N"</span></span><br><span class="line">  1539065478653578171</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析时间戳</span></span><br><span class="line">$ date -d@1545149326</span><br><span class="line">  Wed Dec 19 00:08:46 CST 2018</span><br><span class="line">$ date -d@1543210000 <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br><span class="line">  2018-11-26 13:26:40</span><br><span class="line"></span><br><span class="line"><span class="comment"># For MacOS</span></span><br><span class="line">$ date -r 1577808000</span><br><span class="line">  2020年 1月 1日 星期三 00时00分00秒 CST</span><br><span class="line">$ date -r 1577808000 <span class="string">"+%Y-%m-%d %H:%M:%S"</span></span><br><span class="line">  2020-01-01 00:00:00</span><br></pre></td></tr></tbody></table></figure>
<h3 id="df"><a href="#df" class="headerlink" title="df"></a>df</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 磁盘信息</span></span><br><span class="line">$ df -h</span><br><span class="line">  Filesystem                   Size  Used Avail Use% Mounted on</span><br><span class="line">  /dev/mapper/systemvg-rootlv  7.9G  388M  7.1G   6% /</span><br><span class="line">  tmpfs                        3.9G   12K  3.9G   1% /dev/shm</span><br><span class="line">  /dev/vda1                    485M   39M  421M   9% /boot</span><br><span class="line">  /dev/mapper/systemvg-homelv   30G   11G   18G  38% /home</span><br><span class="line">  /dev/mapper/systemvg-optlv    30G  187M   28G   1% /opt</span><br><span class="line">  /dev/mapper/systemvg-tmplv   2.0G   68M  1.9G   4% /tmp</span><br><span class="line">  /dev/mapper/systemvg-usrlv   9.9G  2.7G  6.7G  29% /usr</span><br><span class="line">  /dev/mapper/systemvg-varlv   6.0G  352M  5.3G   7% /var</span><br><span class="line">  /dev/mapper/datavg-datalv     98G  4.1G   89G   5% /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到 device 对应的 disk</span></span><br><span class="line">$ ls -trl /dev/mapper/</span><br><span class="line">  crw-rw---- 1 root root 10, 58 May 27  2017 control</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-lv_swap -&gt; ../dm-0</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-optlv -&gt; ../dm-4</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-tmplv -&gt; ../dm-5</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-usrlv -&gt; ../dm-6</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-varlv -&gt; ../dm-3</span><br><span class="line">  lrwxrwxrwx 1 root root      7 May 27  2017 systemvg-rootlv -&gt; ../dm-1</span><br><span class="line">  lrwxrwxrwx 1 root root      7 Jun  1  2017 datavg-datalv -&gt; ../dm-7</span><br><span class="line">  lrwxrwxrwx 1 root root      7 Jun  1  2017 systemvg-homelv -&gt; ../dm-2</span><br></pre></td></tr></tbody></table></figure>
<h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"a"</span> &gt; a</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"b"</span> &gt; b</span><br><span class="line">$ diff a b</span><br><span class="line">  1c1</span><br><span class="line">  &lt; a</span><br><span class="line">  ---</span><br><span class="line">  &gt; b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1c1：表示 a 文件的第 1 行 和 b 文件的第 1 行不一致</span></span><br><span class="line"><span class="comment"># &lt; a：展示的是 a 文件中不一致的那一行的内容</span></span><br><span class="line"><span class="comment"># &gt; b：展示的是 b 文件中不一致的那一行的内容</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="du"><a href="#du" class="headerlink" title="du"></a>du</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件大小</span></span><br><span class="line">$ du -h /home/ --max-depth=1</span><br><span class="line">  3.1G	/home/eagle</span><br><span class="line">  40.8G	/home/</span><br><span class="line"></span><br><span class="line">$ du -sh *</span><br><span class="line">  64K	logs</span><br><span class="line">  276M	software</span><br><span class="line">  28K	zkdata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定以 MB 为单位展示大小，并排序</span></span><br><span class="line">$ du -sm * | sort -nr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 另外，使用 `ll -h` 也可以得到文件的大小</span></span><br><span class="line">$ ll -h</span><br><span class="line">  总用量 546M</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper  41M 8月  31 10:08 zookeeper.log</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 101M 8月  31 00:06 zookeeper.log.1</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 101M 8月  29 11:39 zookeeper.log.2</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 101M 8月  27 16:01 zookeeper.log.3</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 101M 8月  25 20:38 zookeeper.log.4</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 101M 8月  24 00:34 zookeeper.log.5</span><br><span class="line">  -rw-rw-r-- 1 zookeeper zookeeper 4.2M 8月  31 09:35 zookeeper.out</span><br></pre></td></tr></tbody></table></figure>
<h3 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不换行</span></span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">"yuzhouwan.com\c"</span> &gt;&gt; blogs.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除法结果保留小数位</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"scale=2;1234/1000"</span> | bc</span><br><span class="line">  1.23</span><br><span class="line">$ res=$(<span class="built_in">echo</span> <span class="string">"scale=2;1234/1000"</span> | bc)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$res</span></span><br><span class="line">  1.23</span><br></pre></td></tr></tbody></table></figure>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到最占用磁盘空间的十个文件</span></span><br><span class="line">$ find / -<span class="built_in">type</span> f -print0 | xargs -0 du -h | sort -rh | head -n 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当需要删除的文件列表过长时，rm 会报错 Argument list too long，此时则可以使用 find 命令进行查找删除</span></span><br><span class="line">$ find . -name <span class="string">"*.log"</span> -delete</span><br></pre></td></tr></tbody></table></figure>
<h3 id="firefox"><a href="#firefox" class="headerlink" title="firefox"></a>firefox</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install firefox</span><br><span class="line">$ firefox yuzhouwan.html</span><br></pre></td></tr></tbody></table></figure>
<h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或操作</span></span><br><span class="line">$ grep -E <span class="string">'bin|etc'</span></span><br><span class="line">$ egrep <span class="string">'bin|etc'</span></span><br><span class="line">$ awk <span class="string">'/bin|etc/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与操作</span></span><br><span class="line">$ grep bin | grep etc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不区分大小写</span></span><br><span class="line">$ grep -i BIN		<span class="comment"># (bin/sbin)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全词匹配</span></span><br><span class="line">$ grep -w bin		<span class="comment"># (bin)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配，并指定显示多少行上下文</span></span><br><span class="line">$ grep -C 1 bin		<span class="comment"># (bin/boot root/sbin/script)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤脚本输出（|&amp; 相当于 stdout + stderr）</span></span><br><span class="line">$ zkServer.sh status |&amp; grep Mode</span><br><span class="line">  Mode: follower</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊字符，需要增加反斜杠（\），进行转义</span></span><br><span class="line">$ grep \$</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据字段 str 匹配到某一行，并获取这一行随后的 n 行（grep -A &lt;n&gt; &lt;str&gt;）</span></span><br><span class="line">$ vim yuzhouwan.txt</span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">  3</span><br><span class="line">  4</span><br><span class="line">  5</span><br><span class="line">  6</span><br><span class="line">$ cat yuzhouwan.txt | grep -A 2 3</span><br><span class="line">  3</span><br><span class="line">  4</span><br><span class="line">  5</span><br></pre></td></tr></tbody></table></figure>
<h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看机器的 IP 地址</span></span><br><span class="line">$ hostname -i</span><br><span class="line">  10.10.10.1</span><br></pre></td></tr></tbody></table></figure>
<h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘 I/O</span></span><br><span class="line">$ iostat -x 1 10</span><br><span class="line">  Linux 2.6.32-504.3.3.el6.centos.plus.x86_64 (yuzhouwan01.com) 	01/19/2018 	_x86_64_	(24 CPU)</span><br><span class="line"></span><br><span class="line">  avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">            17.28    0.00    2.02    0.08    0.00   80.62</span><br><span class="line"></span><br><span class="line">  Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util</span><br><span class="line">  sdb               0.01   159.15    2.51    9.62   493.46  1350.14   151.96     0.02    1.77   0.28   0.34</span><br><span class="line">  sdd               0.01   162.24    2.49    9.69   493.13  1375.44   153.42     0.02    1.85   0.28   0.34</span><br><span class="line">  sdc               0.01   162.57    2.49    9.83   487.72  1379.15   151.58     0.02    2.02   0.27   0.34</span><br><span class="line">  sde               0.01   161.54    2.54    9.80   500.08  1370.68   151.61     0.02    1.87   0.28   0.34</span><br><span class="line">  sdg               0.01   162.06    2.53    9.83   498.98  1375.10   151.64     0.02    1.93   0.28   0.34</span><br><span class="line">  sdf               0.01   163.34    2.53    9.74   496.43  1384.64   153.22     0.02    1.92   0.28   0.35</span><br><span class="line">  sdh               0.01   161.44    2.56    9.74   502.61  1369.43   152.20     0.02    1.90   0.28   0.34</span><br><span class="line">  sdi               0.01   162.58    2.54    9.78   498.87  1378.82   152.48     0.02    1.99   0.28   0.35</span><br><span class="line">  sda               0.29    83.48    0.29  146.49    14.22  1146.37     7.91     0.04    0.28   0.05   0.69</span><br><span class="line">  sdj               0.01   164.20    2.60    9.77   512.11  1391.74   153.90     0.02    1.97   0.28   0.35</span><br><span class="line">  sdk               0.01   161.76    2.60    9.70   505.17  1371.69   152.56     0.03    2.04   0.28   0.35</span><br><span class="line">  sdl               0.01   168.31    2.50    9.84   490.59  1425.20   155.30     0.03    2.57   0.28   0.35</span><br><span class="line">  sdm               0.01   162.34    2.52    9.69   486.76  1376.20   152.68     0.02    1.97   0.28   0.34</span><br><span class="line">  dm-0              0.00     0.00    0.02    0.31     0.70     2.45     9.64     0.00    6.04   0.43   0.01</span><br><span class="line">  dm-1              0.00     0.00    0.39    0.42     3.10     3.32     8.00     0.00    3.42   0.27   0.02</span><br><span class="line">  dm-2              0.00     0.00    0.10  173.34     7.42  1035.66     6.01     0.02    0.04   0.03   0.55</span><br><span class="line">  dm-3              0.00     0.00    0.01    7.47     0.22    59.05     7.93     0.00    0.56   0.07   0.05</span><br><span class="line">  dm-4              0.00     0.00    0.00    4.10     0.00    32.78     8.00     0.00    0.56   0.04   0.02</span><br><span class="line">  dm-5              0.00     0.00    0.04    0.81     1.26     6.51     9.07     0.00    0.59   0.17   0.01</span><br><span class="line">  dm-6              0.00     0.00    0.01    0.82     1.51     6.59     9.68     0.00    2.02   0.16   0.01</span><br></pre></td></tr></tbody></table></figure>
<h3 id="jq"><a href="#jq" class="headerlink" title="jq"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stedolan.github.io/jq/">jq</a></h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://stedolan.github.io/jq/download/ 下载 jq-linux64</span></span><br><span class="line">$ mv jq-linux64 ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software/</span><br><span class="line">$ chmod +x jq-linux64</span><br><span class="line">$ ln -s jq-linux64 jq</span><br><span class="line">$ vim ~/.bashrc</span><br><span class="line">  <span class="built_in">alias</span> jq=<span class="string">'/home/connect/software/jq'</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line">$ curl localhost:8083/ | jq</span><br><span class="line">  {</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.11.0.0-cp1"</span>,</span><br><span class="line">    <span class="string">"commit"</span>: <span class="string">"5cadaa94d0a69e0d"</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取某一个元素</span></span><br><span class="line">$ jq <span class="string">".element"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数组中的某一个</span></span><br><span class="line">$ jq <span class="string">".element[0]"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新把 JSON 压缩成一行</span></span><br><span class="line">$ jq -c</span><br></pre></td></tr></tbody></table></figure>
<h3 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 线程 dump，可以判断进程是否是假死状态</span></span><br><span class="line">$ jstack -m &lt;pid&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 Java 进程的 GC 情况</span></span><br><span class="line"><span class="comment"># Usage: jstat -gcutil &lt;pid&gt; &lt;interval_ms&gt;</span></span><br><span class="line">$ jstat -gcutil 24909 1000</span><br><span class="line">    S0     S1     E      O      P       YGC   YGCT     FGC   FGCT     GCT</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  98.56   6.38  46.86      2    0.147     0    0.000    0.147</span><br><span class="line">  40.77   0.00  99.16   6.38  46.87      2    0.147     0    0.000    0.147</span><br></pre></td></tr></tbody></table></figure>
<h3 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk -d -o name,rota</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rota，全称 rotational，表示磁盘是否可以旋转</span></span><br><span class="line"><span class="comment"># 其中，0 表示不可以旋转，而 1 表示可以旋转</span></span><br><span class="line"><span class="comment"># 前者不可以旋转的说明是 SSD 盘，反之，后者可以旋转则不是 SSD 盘，有可能是 SDA 盘等</span></span><br><span class="line">NAME  ROTA</span><br><span class="line">vda      1</span><br><span class="line">vdb      1</span><br></pre></td></tr></tbody></table></figure>
<h3 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统级 监控 &amp; 诊断工具</span></span><br><span class="line"><span class="comment"># 指定进程号，可以查看该进程打开的文件</span></span><br><span class="line">$ lsof -p &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对打开的文件数，对进程进行排序</span></span><br><span class="line">$ lsof -n | awk <span class="string">'{print $2}'</span> | sort | uniq -c | sort -nr</span><br></pre></td></tr></tbody></table></figure>
<h3 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模拟暴露 8080 端口的服务器</span></span><br><span class="line">$ nc -l 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最简聊天室</span></span><br><span class="line"><span class="comment"># Windows1</span></span><br><span class="line">$ nc -l 8080</span><br><span class="line"><span class="comment"># Windows2</span></span><br><span class="line">$ nc localhost 8080</span><br><span class="line"><span class="comment"># 然后，可以在各自的窗口输入信息，另一个窗口就可以接收到</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="nmon"><a href="#nmon" class="headerlink" title="nmon"></a>nmon</h3><h4 id="生成-nmon-文件"><a href="#生成-nmon-文件" class="headerlink" title="生成 nmon 文件"></a>生成 nmon 文件</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得帮助文档</span></span><br><span class="line">$ nmon_x86_64_centos6 -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同的操作系统，可能 nmon 命令不一样</span></span><br><span class="line"><span class="comment"># -f 使得 xxx.nmon 文件名包含文件创建的时间</span></span><br><span class="line"><span class="comment"># -N 指定需要对 NFS 活动情况进行监控</span></span><br><span class="line"><span class="comment"># -m 指定生成的 xxx.nmon 存放的目录</span></span><br><span class="line"><span class="comment"># -s 指定相隔多少秒，做一次监控</span></span><br><span class="line"><span class="comment"># -c 指定采集多少次监控数据，生成一个 xxx.nmon 文件</span></span><br><span class="line">$ /nmon/nmon_x86_64_rhel6 -f -N -m /nmon -s 60 -c 1440</span><br><span class="line">$ /nmon/nmon_x86_64_centos6 -f -N -m /nmon -s 60 -c 1440</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换 .nmon 文件为 .csv 文件</span></span><br><span class="line">$ sort yuzhouwan-prd3_170831_0001.nmon &gt; yuzhouwan-prd3_170831_0001.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看监控数据</span></span><br><span class="line"><span class="comment"># 在 https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/Power%20Systems/page/nmon_analyser 页面，下载 nmon analyser v52_1.xlsm 文件</span></span><br><span class="line"><span class="comment"># 打开后，会提示“启用宏定义”，点击确定</span></span><br><span class="line"><span class="comment"># 一共会有 Analyser / Settings / Release Notes 三个 sheet，跳转到第一个 Analyser 里</span></span><br><span class="line"><span class="comment"># 点击 “Analyze nmon data” 按钮，选择 yuzhouwan-prd3_170831_0001.csv 文件</span></span><br><span class="line"><span class="comment"># 会生成一个 yuzhouwan-prd3_170831_0001.nmon.xlsx，并直接打开</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="系统资源实时监控"><a href="#系统资源实时监控" class="headerlink" title="系统资源实时监控"></a>系统资源实时监控</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ /nmon/nmon_x86_64_centos6</span><br><span class="line">  <span class="comment"># 常用组合：nml</span></span><br><span class="line">  lnmonq14g-------------------Hostname=yuzhouwan-prd3-Refresh= 2secs ---11:04.35-----------|</span><br><span class="line">  | CPU +-------------------------------------------------------------------------+        |</span><br><span class="line">  |100%-|                                           |                                      |</span><br><span class="line">  | 95%-|                                           |                                      | <span class="comment"># 为方便展示，此处省去 25% ~ 90%</span></span><br><span class="line">  | 20%-|                                           |                                      |</span><br><span class="line">  | 15%-|                                           |                                      |</span><br><span class="line">  | 10%-|              ss                           |                                      |</span><br><span class="line">  |  5%-|UUUUsUUUUsUUsUUUUwUUssUssUUssUUUsUUsUUUUUsU|                                      |</span><br><span class="line">  |     +--------------------User---------System----+----Wait---------------------+        |</span><br><span class="line">  | Memory Stats --------------------------------------------------------------------------|</span><br><span class="line">  |                RAM     High       Low     Swap    Page Size=4 KB                       |</span><br><span class="line">  | Total MB    129013.3     -0.0     -0.0  10240.0                                        |</span><br><span class="line">  | Free  MB     584.1     -0.0     -0.0  10240.0                                          |</span><br><span class="line">  | Free Percent     0.5%   100.0%   100.0%   100.0%                                       |</span><br><span class="line">  |             MB                  MB                  MB                                 |</span><br><span class="line">  |                      Cached= 76656.7     Active= 54649.3                               |</span><br><span class="line">  | Buffers=  4908.1 Swapcached=     0.0  Inactive = 68809.5                               |</span><br><span class="line">  | Dirty  =   131.6 Writeback =     0.0  Mapped   =    75.1                               |</span><br><span class="line">  | Slab   =  4059.3 Commit_AS = 47663.8 PageTables=    96.6                               |</span><br><span class="line">  | Network I/O ---------------------------------------------------------------------------|</span><br><span class="line">  |I/F Name Recv=KB/s Trans=KB/s packin packout insize outsize Peak-&gt;Recv Trans            |</span><br><span class="line">  |      lo  1044.0  1044.0     335.5    335.5  3186.8 3186.8     8639.4  8639.4           |</span><br><span class="line">  |    eth0  5262.7  1168.7    5999.0   2762.1   898.3  433.3    10531.6 43312.1           |</span><br><span class="line">  |    eth1     0.0     0.0    0.0     0.0     0.0    0.0        0.0     0.0               |</span><br><span class="line">  |---------Warning: Some Statistics may not shown-----------------------------------------|</span><br></pre></td></tr></tbody></table></figure>
<h3 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动一个后台进程</span></span><br><span class="line">$ nohup sleep 1000 &amp;</span><br><span class="line">  [1] 30408</span><br><span class="line"><span class="comment"># 列出所有的后台进程</span></span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line">  [1]+  Running                 nohup sleep 1000 &amp;</span><br><span class="line"><span class="comment"># 将后台进程 [1] 提到前台，并 Ctrl+C 停止进程</span></span><br><span class="line">$ <span class="built_in">fg</span> %1</span><br><span class="line">  nohup sleep 1000</span><br><span class="line"><span class="comment"># 检查后台进程已经被停止</span></span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line"><span class="comment"># 不输出任何内容</span></span><br><span class="line">$ nohup bash yuzhouwan.sh &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="make"><a href="#make" class="headerlink" title="make"></a>make</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make -j&lt;thread_num&gt;</span><br><span class="line"><span class="comment"># 查看 CPU 核数</span></span><br><span class="line">$ cat /proc/cpuinfo | grep processor | wc -l</span><br><span class="line"><span class="comment"># 如果是两个处理器的话，一般 `-j2` 可以达到最高效率（某些进程主要耗时是在 I/O 上，并不能充分利用单个 cpu 的时间，则可以考虑 -j4）</span></span><br><span class="line"><span class="comment"># 一般的，使用 `thread_num = number_of_cores + 1` 公式来计算即可</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="locale"><a href="#locale" class="headerlink" title="locale"></a>locale</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ locale </span><br><span class="line">  LANG=en_US.UTF-8                    <span class="comment"># 未设置任何 LC_xxx 变量时所使用的默认值</span></span><br><span class="line">  LC_CTYPE=zh_CN.UTF-8                <span class="comment"># 指定使用某区域的字符分类及处理方式</span></span><br><span class="line">  LC_NUMERIC=<span class="string">"en_US.UTF-8"</span>            <span class="comment"># 指定使用某区域的非货币的数字格式</span></span><br><span class="line">  LC_TIME=<span class="string">"en_US.UTF-8"</span>               <span class="comment"># 指定使用某区域的日期和时间格式</span></span><br><span class="line">  LC_COLLATE=<span class="string">"en_US.UTF-8"</span>            <span class="comment"># 指定使用某区域的排序规则</span></span><br><span class="line">  LC_MONETARY=<span class="string">"en_US.UTF-8"</span>           <span class="comment"># 指定使用某区域的货币格式</span></span><br><span class="line">  LC_MESSAGES=<span class="string">"en_US.UTF-8"</span>           <span class="comment"># 指定使用某区域的响应与信息的格式</span></span><br><span class="line">  LC_PAPER=<span class="string">"en_US.UTF-8"</span>              <span class="comment"># 指定使用某区域的纸张大小</span></span><br><span class="line">  LC_NAME=<span class="string">"en_US.UTF-8"</span>               <span class="comment"># 指定使用某区域的姓名书写方式</span></span><br><span class="line">  LC_ADDRESS=<span class="string">"en_US.UTF-8"</span>            <span class="comment"># 指定使用某区域的地址格式和位置信息</span></span><br><span class="line">  LC_TELEPHONE=<span class="string">"en_US.UTF-8"</span>          <span class="comment"># 指定使用某区域的电话号码格式</span></span><br><span class="line">  LC_MEASUREMENT=<span class="string">"en_US.UTF-8"</span>        <span class="comment"># 指定使用某区域的度量衡规则</span></span><br><span class="line">  LC_IDENTIFICATION=<span class="string">"en_US.UTF-8"</span>     <span class="comment"># 对 locale 自身信息的概述</span></span><br><span class="line">  LC_ALL=                             <span class="comment"># 用来覆盖掉所有其他 LC_xxx 变量的值</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 压缩</span></span><br><span class="line">$ tar zcvf gc.tar.gz gc</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">$ tar zxvf gc.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 top 展示页面中</span></span><br><span class="line"><span class="comment"># 按 CPU 排序：Shift + P</span></span><br><span class="line"><span class="comment"># 按内存排序：Shift + M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程内，各线程的资源消耗</span></span><br><span class="line">$ top -Hp &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进一步，可以根据线程 pid 在 jstack 中定位出对应的线程栈</span></span><br><span class="line"><span class="comment"># 拿到 thread_pid 对应的 16 进制数</span></span><br><span class="line">$ <span class="built_in">printf</span> <span class="string">'%x\n'</span> &lt;thread_pid&gt;</span><br><span class="line">$ jstack &lt;pid&gt; | less</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 batch 模式（-b），并控制命令执行迭代次数为 1 次（-n），达到生成一次 CPU 使用情况的快照</span></span><br><span class="line">$ top -b -n 1</span><br></pre></td></tr></tbody></table></figure>
<h3 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ yum install tree -y</span><br><span class="line">$ tree -L 1 /</span><br><span class="line">  /</span><br><span class="line">  ├── bin</span><br><span class="line">  ├── usr</span><br><span class="line">  └── var</span><br></pre></td></tr></tbody></table></figure>
<h3 id="rpm"><a href="#rpm" class="headerlink" title="rpm"></a>rpm</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -i --badreloc --relocate /usr/java=/home/eagle/software/java jdk-7u80-linux-x64.rpm</span><br></pre></td></tr></tbody></table></figure>
<h3 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Rolling_hash">rsync</a></h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 软链接、隐藏文件等特殊文件的复制，需要用 `rsync` 命令而不能用 `scp`</span></span><br><span class="line">$ rsync -avuz -e ssh eagle/ root@eagle:/home/eagle</span><br></pre></td></tr></tbody></table></figure>
<h3 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接修改文件</span></span><br><span class="line">$ sed -<span class="keyword">in</span>-place -e <span class="string">'s/blog/yuzhouwan.com/g'</span> yuzhouwan.json</span><br></pre></td></tr></tbody></table></figure>
<h3 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后台运行 scp 传输任务</span></span><br><span class="line">$ scp yuzhouwan root@192.168.1.1:/</span><br><span class="line">  root@192.168.1.1<span class="string">'s password: </span></span><br><span class="line"><span class="string">  yuzhouwan  0%   11MB   1.3MB/s 5:24:10 ETA^Z</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Ctrl+Z 暂停 scp 任务</span></span><br><span class="line"><span class="string">  [1]+  Stopped    scp yuzhouwan root@192.168.1.1:/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查看任务已经被暂停</span></span><br><span class="line"><span class="string">$ jobs</span></span><br><span class="line"><span class="string">  [1]+  Stopped    scp yuzhouwan root@192.168.1.1:/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使得其在后台恢复运行</span></span><br><span class="line"><span class="string">$ bg %1</span></span><br><span class="line"><span class="string">  [1]+ scp yuzhouwan root@192.168.1.1:/ &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 已恢复运行</span></span><br><span class="line"><span class="string">$ jobs</span></span><br><span class="line"><span class="string">  [1]+  Running    scp yuzhouwan root@192.168.1.1:/ &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 忽略 HUP 信号（终端断线的中断信号）</span></span><br><span class="line"><span class="string">$ disown -h %1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 退出</span></span><br><span class="line"><span class="string">$ exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 重新登录后，查看 scp 后台任务是否正常运行</span></span><br><span class="line"><span class="string">$ ps -ef | grep scp</span></span><br><span class="line"><span class="string">  root  6189     1  0 18:04 ?        00:00:00 scp yuzhouwan root@192.168.1.1:/</span></span><br><span class="line"><span class="string">  root  6190  6189  0 18:04 ?        00:00:00 /usr/bin/ssh -x -oForwardAgent=no -oPermitLocalCommand=no -oClearAllForwardings=yes -l root -- 192.168.1.1 scp -t /</span></span><br><span class="line"><span class="string">  root  7723  7643  0 18:05 pts/3    00:00:00 grep --color=auto scp</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="split"><a href="#split" class="headerlink" title="split"></a>split</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入三行数据</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"1"</span> &gt;&gt; yuzhouwan</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"2"</span> &gt;&gt; yuzhouwan</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"3"</span> &gt;&gt; yuzhouwan</span><br><span class="line">$ cat yuzhouwan</span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">  3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照数据行数切分</span></span><br><span class="line">$ split -l 1 yuzhouwan tmp_</span><br><span class="line"><span class="comment"># 按照数据大小切分</span></span><br><span class="line"><span class="comment"># 默认不指定单位是 B，支持 K, M, G, T, P, E, Z, Y</span></span><br><span class="line">$ split -b 2 yuzhouwan tmp_</span><br><span class="line"></span><br><span class="line"><span class="comment"># 成功切分</span></span><br><span class="line">$ ll tmp_*</span><br><span class="line">-rw-r--r-- 1 root root 2 Aug  2 19:35 tmp_aa</span><br><span class="line">-rw-r--r-- 1 root root 2 Aug  2 19:35 tmp_ab</span><br><span class="line">-rw-r--r-- 1 root root 2 Aug  2 19:35 tmp_ac</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两种切分方式，得到的结果应该是一样的</span></span><br><span class="line">$ cat tmp_aa</span><br><span class="line">  1</span><br><span class="line">$ cat tmp_ab</span><br><span class="line">  2</span><br><span class="line">$ cat tmp_ac</span><br><span class="line">  3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并为新文件</span></span><br><span class="line">$ cat tmp_* &gt; yuzhouwan_new</span><br><span class="line">$ cat yuzhouwan_new</span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">  3</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录远程机器，执行命令</span></span><br><span class="line">$ ssh bj@192.168.1.101 <span class="string">"df -h"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用逗号分隔多个执行命令</span></span><br><span class="line">$ ssh bj@192.168.1.101 <span class="string">"pwd; ls"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="sz"><a href="#sz" class="headerlink" title="sz"></a>sz</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">$ yum install lrzsz -y</span><br><span class="line"><span class="comment"># 将服务器上文件，拉取到本机</span></span><br><span class="line">$ sz &lt;file name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果下载出现乱码，可以增加 `-e` 参数，同理 `rz` 也可以通过这个参数来解决乱码问题</span></span><br><span class="line">-e, --escape</span><br><span class="line">  Force sender to escape all control characters; normally XON, XOFF, DLE, CR-@-CR, and Ctrl-X are escaped.</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果遇到 ZooKeeper 报警网络延迟，不能只看延迟，还需要关注丢包率（packet loss）</span></span><br><span class="line"><span class="comment"># 如果出现网络丢包率过高，可能是交换机的负载过大，接口松动，或者是网线质量问题</span></span><br><span class="line">$ ping yuzhouwan01</span><br><span class="line">  PING yuzhouwan01.com (192.168.1.101) 56(84) bytes of data.</span><br><span class="line">  64 bytes from yuzhouwan01.com (192.168.1.101): icmp_seq=1 ttl=64 time=0.055 ms</span><br><span class="line">  64 bytes from yuzhouwan01.com (192.168.1.101): icmp_seq=2 ttl=64 time=0.066 ms</span><br><span class="line">  64 bytes from yuzhouwan01.com (192.168.1.101): icmp_seq=3 ttl=64 time=0.064 ms</span><br><span class="line">  64 bytes from yuzhouwan01.com (192.168.1.101): icmp_seq=4 ttl=64 time=0.083 ms</span><br><span class="line">  ^C</span><br><span class="line">  --- yuzhouwan01.com ping statistics ---</span><br><span class="line">  4 packets transmitted, 4 received, 0% packet loss, time 3443ms</span><br><span class="line">  rtt min/avg/max/mdev = 0.055/0.067/0.083/0.010 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制 ping 的次数 和 timeout 时间（单位：秒）</span></span><br><span class="line">$ ping -c 4 yuzhouwan01 -W 5</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看进程的 “启动时间” 和 “已运行时长”</span></span><br><span class="line">$ ps -eo pid,lstart,etime | grep &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程分配内存大小</span></span><br><span class="line"><span class="comment"># RSS（Resident Set Size）常驻内存集，表示该进程分配的内存大小</span></span><br><span class="line">$ ps -e -o pid,rss</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a>ulimit</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当进程报错 `java.io.IOException: Too many open files` 时，可以检查是不是没有修改默认的打开文件数（1024）</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -n</span><br><span class="line">  1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过下面这行命令进行修改</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -HSn 4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># 想要重启系统后，保证修改仍然生效，则可以把上面的命令，添加到 ~/.bash_profile 或者 /etc/profile</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">  Linux yuzhouwan 2.6.32-504.3.3.el6.centos.plus.x86_64 <span class="comment">#1 SMP Wed Dec 17 01:21:03 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kernel version</span></span><br><span class="line">$ uname -r</span><br><span class="line">  2.6.32-504.3.3.el6.centos.plus.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体含义：&lt;内核主版本&gt;.&lt;偶数:稳定版本/奇数:开发中版本&gt;.&lt;错误修补的次数&gt;-&lt;?&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="umask"><a href="#umask" class="headerlink" title="umask"></a>umask</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umask 全称 user file-creatiopn mode mask，用来控制用户权限的</span></span><br><span class="line"><span class="comment"># 查看 umask</span></span><br><span class="line">$ <span class="built_in">umask</span></span><br><span class="line">  0022</span><br><span class="line">$ <span class="built_in">umask</span> -S</span><br><span class="line">  u=rwx,g=rx,o=rx</span><br><span class="line"><span class="comment"># 修改 umask</span></span><br><span class="line">$ <span class="built_in">umask</span> 0022</span><br><span class="line"><span class="comment"># 存在 umask 之后，会减少用户的 umask 权限（例如，0777 - 0022 = 0755）</span></span><br><span class="line"><span class="comment"># 所以，部署安装包的时候，如果 *.sh / *.py 脚本的执行权限分配不足的话，同时 umask 设置较大时，解压安装包后，会出现文件执行权限不足的情况</span></span><br><span class="line"><span class="comment"># 这时候，需要考虑分配适当的文件和文件夹权限</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h3><h4 id="按照单词跳转"><a href="#按照单词跳转" class="headerlink" title="按照单词跳转"></a>按照单词跳转</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># w       跳到下一个单词的开头</span></span><br><span class="line"><span class="comment"># get     跳到上一个单词的开头</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># u       撤销上一步的操作</span></span><br><span class="line"><span class="comment"># U       恢复当前行（即一次撤销对当前行的全部操作）</span></span><br><span class="line"><span class="comment"># Ctrl+r  恢复上一步被撤销的操作</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="翻页"><a href="#翻页" class="headerlink" title="翻页"></a>翻页</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ctrl+U   向上翻半页</span></span><br><span class="line"><span class="comment"># Ctrl+D   向下翻半页</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="退出并保存"><a href="#退出并保存" class="headerlink" title="退出并保存"></a>退出并保存</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># esc + ZZ   （esc 是确保 vim 已经退出了编辑模式）</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h3><h4 id="从-ftp-服务器下载文件"><a href="#从-ftp-服务器下载文件" class="headerlink" title="从 ftp 服务器下载文件"></a>从 ftp 服务器下载文件</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -nd -m --ftp-user=&lt;user&gt; --ftp-password=&lt;password&gt; ftp://&lt;ftp_server&gt;/zookeeper/zookeeper-3.4.6.4.tar.gz</span><br></pre></td></tr></tbody></table></figure>
<h4 id="输出到控制台"><a href="#输出到控制台" class="headerlink" title="输出到控制台"></a>输出到控制台</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -q：quiet 模式，屏蔽 request header 信息的回显</span></span><br><span class="line"><span class="comment"># -O：指定输出文件，后面加 - 横杠，就定向为 console</span></span><br><span class="line">$ wget -q -O- &lt;url&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简写</span></span><br><span class="line">$ wget -qO- &lt;url&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>Tips: 另外还有一个好处，wget 可以实现跳转。以 <a href="https://yuzhouwan.com/posts/5845/">Apache Druid</a> 为例，用 <code>curl 命令去访问 http://standby-overlord:8090/druid/indexer/v1/runningTasks</code> 会因为 overlord 是 standby 结点，导致调用接口失败。而如果用 wget 命令则可以自动跳转到 active 结点，同时再配合使用 <code>-qO-</code> 命令，就能达到和 <code>curl</code> 命令一样，将接口调用结果直接输出到控制台的效果（当然 <code>curl -L</code> 也可以实现）</p>
<h3 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 Java 进程的 PID，并使用 jstat 命令观察 GC 情况</span></span><br><span class="line">$ jps -ml | grep yuzhouwan | awk <span class="string">'{print $1}'</span> | xargs -i jstat -gcutil {} 1000</span><br></pre></td></tr></tbody></table></figure>
<h3 id="标准-I-O"><a href="#标准-I-O" class="headerlink" title="标准 I/O"></a>标准 I/O</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只输出 “脚本执行异常信息”</span></span><br><span class="line">$ ./commands.sh 1&gt;/dev/null 2&gt;./error.log</span><br><span class="line"><span class="comment"># 完全不作输出</span></span><br><span class="line">$ ./commands.sh 1&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Shell-编程"><a href="#Shell-编程" class="headerlink" title="Shell 编程"></a>Shell 编程</h2><h3 id="bashrc"><a href="#bashrc" class="headerlink" title=".bashrc"></a>.bashrc</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在执行脚本开始的时候，载入环境变量</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></tbody></table></figure>
<h3 id="dirname"><a href="#dirname" class="headerlink" title="dirname"></a>dirname</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跳转到，当前脚本的文件目录</span></span><br><span class="line"><span class="built_in">cd</span> `dirname <span class="variable">$0</span>`</span><br></pre></td></tr></tbody></table></figure>
<h3 id="cut-string"><a href="#cut-string" class="headerlink" title="cut string"></a>cut string</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 string 的前后各删除一个字符</span></span><br><span class="line">arr=<span class="string">"[leader, election, zookeeper]"</span></span><br><span class="line">arr=`<span class="built_in">echo</span> <span class="variable">${arr:1:${#arr}</span>-2}`    <span class="comment"># leader, election, zookeeper</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 `command` 命令，可以在脚本开始执行前，对需要的命令进行 check</span></span><br><span class="line"><span class="built_in">command</span> -v nc &gt;/dev/null 2&gt;&amp;1 || {</span><br><span class="line">    <span class="built_in">echo</span> &gt;&amp;2 <span class="string">"I require nc but it's not installed!"</span>; <span class="built_in">exit</span> 1;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="for-loop"><a href="#for-loop" class="headerlink" title="for loop"></a>for loop</h3><h4 id="遍历文件"><a href="#遍历文件" class="headerlink" title="遍历文件"></a>遍历文件</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> `cat yuzhouwan.txt`; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="进阶用法"><a href="#进阶用法" class="headerlink" title="进阶用法"></a>进阶用法</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">arr=<span class="string">"leader, election, zookeeper"</span></span><br><span class="line">OLD_IFS=<span class="string">"<span class="variable">$IFS</span>"</span></span><br><span class="line">IFS=$<span class="string">", "</span></span><br><span class="line">arr=(<span class="variable">${arr}</span>)</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="variable">${arr[@]}</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">${a}</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="string">"<span class="variable">$OLD_IFS</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 IFS，前文 "实战技巧 - IFS 设置" 部分已经提到了</span></span><br><span class="line"><span class="comment"># 下面介绍一种 `fori` 的遍历方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0	/election</span></span><br><span class="line"><span class="comment"># 0	/leader</span></span><br><span class="line"><span class="comment"># 2	/zookeeper</span></span><br><span class="line">sorted_num=`<span class="built_in">echo</span> <span class="variable">${sorted}</span> | wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">${sorted_num}</span> -gt <span class="variable">${top_n}</span> ]; <span class="keyword">then</span></span><br><span class="line">    sorted_num=<span class="variable">${top_n}</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">json=<span class="string">"{"</span></span><br><span class="line"><span class="keyword">for</span> (( i=1; i&lt;=<span class="variable">${sorted_num}</span>; i++ )); <span class="keyword">do</span></span><br><span class="line">    line=`<span class="built_in">echo</span> <span class="string">"<span class="variable">${sorted}</span>"</span> | sed -n <span class="string">"<span class="variable">${i}</span> p"</span>`</span><br><span class="line">    json=<span class="string">"<span class="variable">${json}</span>`echo <span class="variable">${line}</span> | awk '{print <span class="variable">$1</span>}'`: `echo <span class="variable">${line}</span> | awk '{print <span class="variable">$2</span>}'`"</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">${i}</span> -lt <span class="variable">${sorted_num}</span> ]; <span class="keyword">then</span></span><br><span class="line">        json=<span class="string">"<span class="variable">${json}</span>, "</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">json=<span class="string">"<span class="variable">${json}</span>}"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当然，也有其他的实现方法，比如下面 `seq` 这种</span></span><br><span class="line"><span class="comment"># 但是，`seq` 这种方式需要注意两点</span></span><br><span class="line"><span class="comment"># 第一点，$(seq 1 1 10) 里面的 初始值、步长、最大值 都必须要是 Integer 类型的，如果是通过 shell 外部传参进来的，需要做类型转换</span></span><br><span class="line"><span class="comment"># 第二点，`seq` 方式在 console 里面执行没问题，但是，写在 shell 脚本里面，可能会失效（原因尚不明确）</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 1 2 10); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"skip by 2 step, value is <span class="variable">$i</span>"</span>; <span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义函数的时候，不需要表示入参，直接用 $1 / $2 获取入参的值</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f</span></span>() {</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>.<span class="variable">$2</span>"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数定义需要在调用逻辑之前</span></span><br><span class="line"><span class="comment"># 多个入参，依次空格隔开传入，即可</span></span><br><span class="line">f <span class="string">"yuzhouwan"</span> <span class="string">"com"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断字符串是否一致</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">${context}</span>_x == <span class="string">"_x"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"OK"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数值比较大小(这种写法还支持浮点数，而 `lt` / `gt` 的写法则不行)</span></span><br><span class="line"><span class="keyword">if</span> [[ $(<span class="built_in">echo</span> <span class="string">"<span class="variable">${origin_cost_time}</span> &gt;= <span class="variable">${compact_cost_time}</span>"</span>|bc) -eq 1 ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"True"</span> &gt;&gt; time.txt</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"False"</span> &gt;&gt; time.txt</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="paste"><a href="#paste" class="headerlink" title="paste"></a>paste</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 针对某一列进行 sum 求和</span></span><br><span class="line">$ cat c | awk <span class="string">'{print $1}'</span>  | paste -sd+ - | bc</span><br><span class="line">  160</span><br></pre></td></tr></tbody></table></figure>
<h3 id="readlink"><a href="#readlink" class="headerlink" title="readlink"></a>readlink</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取到文件</span></span><br><span class="line">$ readlink -f logs/zookeeper.log</span><br><span class="line">  /home/zookeeper/logs/zookeeper.log</span><br></pre></td></tr></tbody></table></figure>
<h3 id="sed-1"><a href="#sed-1" class="headerlink" title="sed"></a>sed</h3><h4 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先后从 zk_con 里面，将 ":" 冒号后面 和 "/" 斜线之前的都删掉</span></span><br><span class="line">zk_con=<span class="string">" /192.168.1.1:35632[1](queued=0,recved=146,sent=146,sid=0x25dd0c02a0a02a7,lop=PING,est=1503994626336,to=40000,lcxid=0x0,lzxid=0xffffffffffffffff,lresp=1503996561355,llat=0,minlat=0,avglat=0,maxlat=3)"</span></span><br><span class="line">zk_con=`<span class="built_in">echo</span> <span class="variable">$zk_con</span> | sed <span class="string">'s/:.*//g'</span> | sed <span class="string">'s/.*\///g'</span>`    <span class="comment"># 192.168.1.1</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="删除匹配行"><a href="#删除匹配行" class="headerlink" title="删除匹配行"></a>删除匹配行</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 txt 文件中，删除包含 yuzhouwan 字符串的行</span></span><br><span class="line">$ sed -e <span class="string">'/yuzhouwan/d'</span> txt</span><br></pre></td></tr></tbody></table></figure>
<h4 id="删除空白行"><a href="#删除空白行" class="headerlink" title="删除空白行"></a>删除空白行</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除没有任何字符的行</span></span><br><span class="line">$ sed -i <span class="string">'s/^$//g'</span> <span class="built_in">log</span></span><br><span class="line"><span class="comment"># 删除只有空格的行</span></span><br><span class="line">$ sed -i <span class="string">'/^\s*$/d'</span> <span class="built_in">log</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 `-k1` 指定 针对第一列进行排序</span></span><br><span class="line"><span class="comment"># 通过 `-n` 指定 针对数字进行排序，避免 9 排在了 10 前面</span></span><br><span class="line"><span class="comment"># 当然也可以通过增加 `-r`，使得排序变成降序</span></span><br><span class="line"><span class="comment"># 如果，列与列之间的分隔符不是默认的 \t，则需要通过 `-t` 参数进行指定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0	/election</span></span><br><span class="line"><span class="comment"># 0	/leader</span></span><br><span class="line"><span class="comment"># 2	/zookeeper</span></span><br><span class="line">sorted=`<span class="built_in">echo</span> <span class="variable">${result}</span> | sort -k1 -n`</span><br></pre></td></tr></tbody></table></figure>
<h3 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计数</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"1\n1\n0"</span> | uniq -c</span><br><span class="line"><span class="comment"># 2 1</span></span><br><span class="line"><span class="comment"># 1 0</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="exit-0"><a href="#exit-0" class="headerlink" title="exit 0"></a>exit 0</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 养成一个，脚本结尾，添加 `exit 0` 的好习惯</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></tbody></table></figure>
<h2 id="实用技巧"><a href="#实用技巧" class="headerlink" title="实用技巧"></a>实用技巧</h2><h3 id="IFS-设置"><a href="#IFS-设置" class="headerlink" title="IFS 设置"></a>IFS 设置</h3><p>　Shell 脚本中 IFS 变量全称 <strong>I</strong>nternal <strong>F</strong>ield <strong>S</strong>eprator，内部域分隔符</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$IFS</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"<span class="variable">$IFS</span>"</span> | od -b</span><br><span class="line">  0000000 040 011 012 012</span><br><span class="line">  0000004</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历多行文本之前，设置 IFS 为 \n</span></span><br><span class="line">pids=`ps -ef | grep <span class="string">"<span class="variable">${PROCESS_NAME}</span>"</span> | grep -v grep | grep -v <span class="string">"<span class="variable">${SELF_NAME}</span>"</span> | awk <span class="string">'{print $2}'</span>`</span><br><span class="line">IFS=$<span class="string">'\n'</span> <span class="built_in">read</span> -rd <span class="string">''</span> -a pids &lt;&lt;&lt;<span class="string">"<span class="variable">$pids</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"pids: <span class="variable">${pids}</span>"</span></span><br><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> <span class="string">"<span class="variable">${pids}</span>"</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"kill -9 <span class="variable">${pid}</span>"</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="string">"<span class="variable">${pid}</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="每秒执行一次"><a href="#每秒执行一次" class="headerlink" title="每秒执行一次"></a>每秒执行一次</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> sleep 1; &lt;<span class="built_in">command</span>&gt;; <span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="自启动"><a href="#自启动" class="headerlink" title="自启动"></a>自启动</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 OpenTSDB 为例</span></span><br><span class="line">$ vim keep_alive.sh</span><br><span class="line">  <span class="comment">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">      process_num=`ps -ef | grep -v grep | grep opentsdb | wc -l`</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">${process_num}</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="variable">${process_num}</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">"health"</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/opentsdb</span><br><span class="line">          nohup ./build/tsdb tsd &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      sleep 10;</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ nohup sh keep_alive.sh &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="获得当前机器的资源使用情况"><a href="#获得当前机器的资源使用情况" class="headerlink" title="获得当前机器的资源使用情况"></a>获得当前机器的资源使用情况</h3><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">idle_cpu_percent=`top -b -n 1 | grep Cpu | awk <span class="string">'{print $5}'</span> | cut -f 1 -d <span class="string">"."</span>`</span><br><span class="line">used_cpu_percent=$(<span class="built_in">echo</span> <span class="string">"100-<span class="variable">${idle_cpu_percent}</span>"</span> | bc)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">free_m=`free -m`</span><br><span class="line">free_m_detail=`<span class="built_in">echo</span> <span class="variable">${free_m}</span> | sed <span class="string">'s/.*Mem://g'</span> | sed <span class="string">'s/-\/+.*//g'</span>`</span><br><span class="line">total_mem=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">${free_m_detail}</span>"</span> | awk <span class="string">'{print $1}'</span>)</span><br><span class="line">used_mem=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">${free_m_detail}</span>"</span> | awk <span class="string">'{print $2}'</span>)</span><br><span class="line">used_mem_percent=$[<span class="variable">${used_mem}</span> * 100 / <span class="variable">${total_mem}</span>]</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Disk"><a href="#Disk" class="headerlink" title="Disk"></a>Disk</h4><h5 id="空间使用率"><a href="#空间使用率" class="headerlink" title="空间使用率"></a>空间使用率</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">used_disk_percent=`df -P | grep <span class="string">"home"</span> | awk <span class="string">'{print $5}'</span>`</span><br></pre></td></tr></tbody></table></figure>
<h5 id="I-O-使用率"><a href="#I-O-使用率" class="headerlink" title="I/O 使用率"></a>I/O 使用率</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virtual_device=`df -h | grep <span class="string">"home"</span> | awk <span class="string">'{print $1}'</span> | cut -f 4 -d <span class="string">'/'</span>`</span><br><span class="line">device=`ls -trl /dev/mapper/ | grep <span class="variable">${virtual_device}</span> | sed <span class="string">'s/.*\///g'</span>`</span><br><span class="line">device_io=`iostat -x 1 1 | grep <span class="variable">${device}</span> | awk <span class="string">'{print $12}'</span>`</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h4><h5 id="获得当前机器的-IP"><a href="#获得当前机器的-IP" class="headerlink" title="获得当前机器的 IP"></a>获得当前机器的 IP</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">now_ip=`ifconfig | grep <span class="string">"inet addr"</span> | grep -v <span class="string">"127.0.0.1"</span> | awk <span class="string">'{print $2}'</span> | sed <span class="string">'s/.*://g'</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">${now_ip}</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">    now_ip=`hostname -i | awk <span class="string">'{print $1}'</span>`</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="从机器列表中获取目标-IP"><a href="#从机器列表中获取目标-IP" class="headerlink" title="从机器列表中获取目标 IP"></a>从机器列表中获取目标 IP</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里以 ZooKeeper 为例</span></span><br><span class="line">aim_ip=`cat <span class="variable">${zk_home}</span>/conf/zoo.cfg | grep server | sed <span class="string">'s/.*=//g'</span> | cut -d <span class="string">':'</span> -f 1 | grep -v <span class="variable">${now_ip}</span> | tail -1`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">${aim_ip}</span>"</span> == <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">    aim_ip=<span class="string">"127.0.0.1"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="网络延迟和丢包率"><a href="#网络延迟和丢包率" class="headerlink" title="网络延迟和丢包率"></a>网络延迟和丢包率</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ping_result=`ping -c 4 <span class="variable">${aim_ip}</span> -W 5`</span><br><span class="line">ping_packet_loss=`<span class="built_in">echo</span> <span class="variable">${ping_result}</span> | sed <span class="string">'s/.*received, //g'</span> | sed <span class="string">'s/ packet loss.*//g'</span>`</span><br><span class="line">ping_avg_ms=`<span class="built_in">echo</span> <span class="variable">${ping_result}</span> | sed <span class="string">'s/.*rtt //g'</span> | awk <span class="string">'{print $3}'</span> | cut -d <span class="string">'/'</span> -f 2`</span><br></pre></td></tr></tbody></table></figure>
<h4 id="通用工具"><a href="#通用工具" class="headerlink" title="通用工具"></a>通用工具</h4><h5 id="tsar"><a href="#tsar" class="headerlink" title="tsar"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/alibaba/tsar">tsar</a></h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">$ wget -O tsar.zip https://github.com/alibaba/tsar/archive/master.zip --no-check-certificate</span><br><span class="line">$ unzip tsar.zip</span><br><span class="line">$ <span class="built_in">cd</span> tsar-master/</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="comment"># 指标含义</span></span><br><span class="line"><span class="comment"># cpu - util:        CPU 总使用的时间百分比</span></span><br><span class="line"><span class="comment"># mem - util:        内存使用率</span></span><br><span class="line"><span class="comment"># tcp - retran:      系统的重传率</span></span><br><span class="line"><span class="comment"># traffic - bytin:   入口流量 Byte/s</span></span><br><span class="line"><span class="comment"># traffic - bytout:  出口流量 Byte/s</span></span><br><span class="line"><span class="comment"># vda - util:        虚拟磁盘 vda 的 I/O</span></span><br><span class="line"><span class="comment"># vda1 - util:       虚拟磁盘 vda1 的 I/O</span></span><br><span class="line"><span class="comment"># load - load1:      一分钟的系统平均负载</span></span><br><span class="line">$ tsar -l -i 1</span><br><span class="line">  Time              ---cpu-- ---mem-- ---tcp-- -----traffic---- --vda--- --vda1--  ---load-</span><br><span class="line">  Time                util     util   retran    bytin  bytout     util     util     load1</span><br><span class="line">  09/04/19-19:59:44   0.00     0.71     0.00   126.00  222.00     0.00     0.00      0.16</span><br><span class="line">  09/04/19-19:59:45   0.02     0.71     0.00    66.00  338.00     0.00     0.00      0.16</span><br><span class="line">  09/04/19-19:59:46   0.00     0.71     0.00    66.00  242.00     0.00     0.00      0.16</span><br></pre></td></tr></tbody></table></figure>
<h3 id="从-JVM-进程中，找到占用-CPU-最高的-Java-线程"><a href="#从-JVM-进程中，找到占用-CPU-最高的-Java-线程" class="headerlink" title="从 JVM 进程中，找到占用 CPU 最高的 Java 线程"></a>从 JVM 进程中，找到占用 CPU 最高的 Java 线程</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用命令 top -p &lt;pid&gt;，显示 Java 进程的内存情况</span></span><br><span class="line">$ top -p 15108</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按大写的 H，获取每个线程的内存情况</span></span><br><span class="line"><span class="comment"># 找到内存和 CPU 占用最高的线程 pid</span></span><br><span class="line">PID   USER      PR  NI  VIRT   RES   SHR   S  %CPU   %MEM  TIME+    COMMAND</span><br><span class="line">15133 druid     20   0  24.9g  1.1g  7776  S  244.9  0.9   0:07.36  java</span><br><span class="line">15108 druid     20   0  24.9g  1.1g  7776  S  0.0    0.9   0:00.57  java</span><br><span class="line">15114 druid     20   0  24.9g  1.1g  7776  S  0.0    0.9   0:08.96  java</span><br><span class="line">15115 druid     20   0  24.9g  1.1g  7776  S  0.0    0.9   0:07.26  java</span><br><span class="line">15116 druid     20   0  24.9g  1.1g  7776  S  0.0    0.9   0:07.25  java</span><br><span class="line">15117 druid     20   0  24.9g  1.1g  7776  S  0.0    0.9   0:07.19  java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得线程 pid 的十六进制</span></span><br><span class="line">$ <span class="built_in">printf</span> 0x%x 15133</span><br><span class="line">  0x3b1d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从线程堆栈信息中找到 3b1d 这个线程，并展示所在行的后面 10 行</span></span><br><span class="line">$ jstack 15108 | grep -A 10 3b1d</span><br><span class="line">  <span class="string">"qtp2028042905-211-acceptor-3@41374390-ServerConnector@2faa55bb{HTTP/1.1}{0.0.0.0:8090}"</span> <span class="comment">#211 daemon prio=4 os_prio=0 tid=0x00007f789bc47800 nid=0x3b1d runnable [0x00007f74e29ec000]</span></span><br><span class="line">     java.lang.Thread.State: RUNNABLE</span><br><span class="line">          at sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)</span><br><span class="line">          at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)</span><br><span class="line">          at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)</span><br><span class="line">          - locked &lt;0x00000007122b1fa0&gt; (a java.lang.Object)</span><br><span class="line">          at org.eclipse.jetty.server.ServerConnector.accept(ServerConnector.java:377)</span><br><span class="line">          at org.eclipse.jetty.server.AbstractConnector<span class="variable">$Acceptor</span>.run(AbstractConnector.java:500)</span><br><span class="line">          at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:620)</span><br><span class="line">          at org.eclipse.jetty.util.thread.QueuedThreadPool<span class="variable">$3</span>.run(QueuedThreadPool.java:540)</span><br><span class="line">          at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"><span class="comment"># 查看对应的堆栈信息，找出可能存在问题的代码</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Windows-相关"><a href="#Windows-相关" class="headerlink" title="Windows 相关"></a>Windows 相关</h3><h4 id="Windows-下执行-shell-脚本"><a href="#Windows-下执行-shell-脚本" class="headerlink" title="Windows 下执行 shell 脚本"></a>Windows 下执行 shell 脚本</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 git</span></span><br><span class="line">$ doskey bash=<span class="string">"%GIT_HOME%\bin\bash.exe"</span> $*</span><br><span class="line">$ doskey sh=<span class="string">"%GIT_HOME%\bin\sh.exe"</span> $*</span><br><span class="line">$ bash shell.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似的可以设置 `np` 为 `notepad++` 的快捷启动命令</span></span><br><span class="line">$ doskey np=D:\apps\Notepad++\notepad++.exe $*</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Cmd-设置-Proxy"><a href="#Cmd-设置-Proxy" class="headerlink" title="Cmd 设置 Proxy"></a>Cmd 设置 Proxy</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">set</span> http_proxy=http://your_proxy:your_port</span><br><span class="line">$ <span class="built_in">set</span> http_proxy=http://username:password@your_proxy:your_port</span><br><span class="line">$ <span class="built_in">set</span> https_proxy=https://your_proxy:your_port</span><br><span class="line">$ <span class="built_in">set</span> https_proxy=https://username:password@your_proxy:your_port</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Cygwin"><a href="#Cygwin" class="headerlink" title="Cygwin"></a>Cygwin</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>　在<a target="_blank" rel="external nofollow noopener noreferrer" href="https://cygwin.com/">官网</a>找到 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://cygwin.com/setup-x86_64.exe">setup-x86_64.exe</a> 安装包，下载并执行（安装的过程中，如果提示有冲突，选择 <code>contiune</code> 而不能是 <code>retry</code>，否则，将会全部重新开始）</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到想要的盘符下</span></span><br><span class="line">$ <span class="built_in">cd</span> /cygdrive/e</span><br><span class="line">$ <span class="built_in">cd</span> e:/</span><br></pre></td></tr></tbody></table></figure>
<h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><h4 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h4><h5 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">$ service iptable status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line">$ servcie iptables stop</span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line">$ chkconfig iptables off</span><br></pre></td></tr></tbody></table></figure>
<h5 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认防火墙状态（CentOS 7.0）</span></span><br><span class="line">$ firewall-cmd --state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看默认防火墙状态（CentOS 7.x）</span></span><br><span class="line">$ systemctl list-unit-files | grep firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 firewall</span></span><br><span class="line">$ systemctl start firewalld.service</span><br><span class="line"><span class="comment"># 重启 firewall</span></span><br><span class="line">$ systemctl restart firewalld.service</span><br><span class="line"><span class="comment"># 停止 firewall</span></span><br><span class="line">$ systemctl stop firewalld.service</span><br><span class="line"><span class="comment"># 查看 firewall 状态</span></span><br><span class="line">$ systemctl status firewalld.service</span><br><span class="line"><span class="comment"># 是否 / 开启 / 禁止 firewall 的开机自启</span></span><br><span class="line">$ systemctl is-enabled/<span class="built_in">enable</span>/<span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启防火墙</span></span><br><span class="line">$ ufw <span class="built_in">enable</span></span><br><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">$ ufw <span class="built_in">disable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载 iptables 服务</span></span><br><span class="line">$ apt-get remove iptables</span><br></pre></td></tr></tbody></table></figure>
<h2 id="优化实战"><a href="#优化实战" class="headerlink" title="优化实战"></a>优化实战</h2><h3 id="关闭-Swappiness"><a href="#关闭-Swappiness" class="headerlink" title="关闭 Swappiness"></a>关闭 Swappiness</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/sys/vm/swappiness</span><br><span class="line">  <span class="comment"># default: 60</span></span><br><span class="line">  <span class="comment"># memory first: 0</span></span><br><span class="line">  <span class="comment"># swap first: 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使得 swappiness 设置永久生效</span></span><br><span class="line">$ vim /etc/sysctl.conf</span><br><span class="line">  vm.swappiness=10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以配合 JVM 中的 `-XX:+AlwaysPreTouch` 参数，在进程启动的时候，让 jvm 通过 demand-zeroed 方式将内存一次分配到位，提高 daemon 常驻进程性能</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="控制-Overcommit"><a href="#控制-Overcommit" class="headerlink" title="控制 Overcommit"></a>控制 Overcommit</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/sys/vm/overcommit_memory</span><br><span class="line">  <span class="comment"># 0: 表示内核将检查是否有足够的可用内存供应用进程使用</span></span><br><span class="line">  <span class="comment">#    如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程</span></span><br><span class="line">  <span class="comment"># 1: 表示内核允许分配所有的物理内存，而不管当前的内存状态如何</span></span><br><span class="line">  <span class="comment"># 2: 表示内核允许分配超过所有物理内存和交换空间总和的内存</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="禁用透明巨页"><a href="#禁用透明巨页" class="headerlink" title="禁用透明巨页"></a>禁用透明巨页</h3><h4 id="Page-Size"><a href="#Page-Size" class="headerlink" title="Page Size"></a>Page Size</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ getconf PAGE_SIZE</span><br><span class="line">  4096</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Huge-Page-Size"><a href="#Huge-Page-Size" class="headerlink" title="Huge Page Size"></a>Huge Page Size</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/meminfo | grep Hugepagesize</span><br><span class="line">  Hugepagesize:       2048 kB</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Transparent-Huge-Pages"><a href="#Transparent-Huge-Pages" class="headerlink" title="Transparent Huge Pages"></a>Transparent Huge Pages</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">  [always] madvise never</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">$ <span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redhat 的相关目录: /sys/kernel/mm/redhat_transparent_hugepage/</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="清理-Cache"><a href="#清理-Cache" class="headerlink" title="清理 Cache"></a>清理 Cache</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ free -g &amp;&amp; sync &amp;&amp; <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches &amp;&amp; free -g</span><br><span class="line">  <span class="comment"># before</span></span><br><span class="line">                 total       used       free     shared    buffers     cached</span><br><span class="line">    Mem:          3833       3726        106          0        107        272</span><br><span class="line">    -/+ buffers/cache:       3346        486</span><br><span class="line">    Swap:        10239          0      10239</span><br><span class="line">  <span class="comment"># after</span></span><br><span class="line">                 total       used       free     shared    buffers     cached</span><br><span class="line">    Mem:          3833       3345        487          0          1         31</span><br><span class="line">    -/+ buffers/cache:       3312        520</span><br><span class="line">    Swap:        10239          0      10239</span><br><span class="line"></span><br><span class="line"><span class="comment"># To free pagecache:</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"><span class="comment"># To free dentries and inodes:</span></span><br><span class="line">$ <span class="built_in">echo</span> 2 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"><span class="comment"># To free pagecache, dentries and inodes:</span></span><br><span class="line">$ <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行完清空 Cache 的命令之后，需要重新设置为 0，否则 Cache 机制就相当于被 disable 了</span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></tbody></table></figure>
<h3 id="增大预留空闲内存"><a href="#增大预留空闲内存" class="headerlink" title="增大预留空闲内存"></a>增大预留空闲内存</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统默认预留内存空间，只有 88 MB</span></span><br><span class="line">$ cat /proc/sys/vm/min_free_kbytes</span><br><span class="line">  90112</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了系统稳定性，可以增加到 1 GB</span></span><br><span class="line">$ vim /proc/sys/vm/min_free_kbytes</span><br><span class="line">  1048576</span><br></pre></td></tr></tbody></table></figure>
<h2 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h2><h3 id="Cache-amp-Buffer"><a href="#Cache-amp-Buffer" class="headerlink" title="Cache &amp; Buffer"></a>Cache &amp; Buffer</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>　在 Linux 的内存管理中，<strong>Cache</strong>（Page Cache）属于 页面缓存，<strong>Buffer</strong>（Buffer Cache）则属于 缓冲区缓存。前者，针对 页（Page）内存进行管理，后者，则针对 块（Block）内存进行管理</p>
<h4 id="分析-Cache"><a href="#分析-Cache" class="headerlink" title="分析 Cache"></a>分析 Cache</h4><h5 id="fincore"><a href="#fincore" class="headerlink" title="fincore"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/david415/linux-ftools">fincore</a></h5><h6 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装两个 perl 依赖包（大小仅 336 KB）</span></span><br><span class="line">$ yum install perl-Inline perl-Parse-RecDescent -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载编译 fincore</span></span><br><span class="line">$ wget https://github.com/david415/linux-ftools/archive/master.zip</span><br><span class="line">$ unzip linux-ftools-master.zip</span><br><span class="line">$ <span class="built_in">cd</span> linux-ftools-master</span><br><span class="line">$ chmod 777 configure</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span>/ &amp;&amp; make -j2 &amp;&amp; make -j2 install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果报错 WARNING: `automake-1.10` is missing on your system.</span></span><br><span class="line">$ ln -sf /usr/bin/aclocal /usr/bin/aclocal-1.10</span><br><span class="line">$ ln -sf /usr/bin/automake /usr/bin/automake-1.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要在线上环境，进行离线安装</span></span><br><span class="line">$ mkdir -p /tmp/fincore</span><br><span class="line">$ yum reinstall --downloadonly --downloaddir=/tmp/fincore perl-Inline perl-Parse-RecDescent -y</span><br><span class="line">$ ll /tmp/fincore</span><br><span class="line">  -rw-r--r-- 1 root root 151484 Jul 22  2010 perl-Inline-0.46-1.el6.noarch.rpm</span><br><span class="line">  -rw-r--r-- 1 root root 193348 Sep 25  2011 perl-Parse-RecDescent-1.965-1.el6.noarch.rpm</span><br></pre></td></tr></tbody></table></figure>
<h6 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span> -v fincore &gt;/dev/null 2&gt;&amp;1 || {</span><br><span class="line">    <span class="built_in">echo</span> &gt;&amp;2 <span class="string">"I require fincore but it's not installed. Try install..."</span> ; <span class="built_in">exit</span> 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">pids_tmp=/tmp/cache.pids</span><br><span class="line">cache_tmp=/tmp/cache.files</span><br><span class="line">fincore_tmp=/tmp/cache.fincore</span><br><span class="line">result_tmp=/tmp/result.fincore</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The top 3 cache pid:"</span></span><br><span class="line">ps -e -o pid,rss | sort -nk2 -r | grep -vw 1 | head -3 | awk <span class="string">'{print $1}'</span> &gt; <span class="variable">${pids_tmp}</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"`cat <span class="variable">${pids_tmp}</span>`\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> `cat <span class="variable">${pids_tmp}</span>`; <span class="keyword">do</span></span><br><span class="line">    ps -ef | grep <span class="variable">${pid}</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">${cache_tmp}</span> ]; <span class="keyword">then</span></span><br><span class="line">    rm -f <span class="variable">${cache_tmp}</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Pid: <span class="variable">${line}</span>, Files:"</span></span><br><span class="line">    file=`lsof -p <span class="variable">${line}</span> 2&gt;/dev/null | awk <span class="string">'{print $9}'</span>`</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">${file}</span>"</span> &gt;&gt; <span class="variable">${cache_tmp}</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"<span class="variable">${file}</span>\n"</span> | grep -vw <span class="string">"NAME"</span></span><br><span class="line"><span class="keyword">done</span>&lt;<span class="variable">${pids_tmp}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">${fincore_tmp}</span> ]; <span class="keyword">then</span></span><br><span class="line">    rm -f <span class="variable">${fincore_tmp}</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat <span class="variable">${cache_tmp}</span>`; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="variable">${i}</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">${i}</span> &gt;&gt; <span class="variable">${fincore_tmp}</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">fincore --pages=<span class="literal">false</span> `cat <span class="variable">${fincore_tmp}</span> | grep -v /usr/sbin/sshd | grep -v /lib64/ld-2.12.so | grep -v /bin/bash | grep -v /bin/login` &gt; <span class="variable">${result_tmp}</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"filename size	total pages	cached pages    cached size	cached percentage"</span></span><br><span class="line"></span><br><span class="line">len=`cat <span class="variable">${result_tmp}</span> | wc -l`</span><br><span class="line">cat <span class="variable">${result_tmp}</span> | tail -$(<span class="built_in">echo</span> <span class="string">"<span class="variable">${len}</span>-1"</span> | bc) | sort -nk4 -r</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></tbody></table></figure>
<p>Tips: Full code is <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/asdf2014/yuzhouwan/blob/master/yuzhouwan-common/src/main/resources/shell/max_cache.sh">here</a>.</p>
<h5 id="System-Tap"><a href="#System-Tap" class="headerlink" title="System Tap"></a>System Tap</h5><p>　依赖包太多，线上环境不适合</p>
<h5 id="pcstat"><a href="#pcstat" class="headerlink" title="pcstat"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/tobert/pcstat">pcstat</a></h5><p>　卡在了安装的第一步 <code>go get golang.org/x/sys/unix</code> …</p>
<h4 id="回收-Cache"><a href="#回收-Cache" class="headerlink" title="回收 Cache"></a>回收 Cache</h4><h5 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h5><p>　具体操作，请看上文 “优化实战 - <a href="https://yuzhouwan.com/posts/15691/#清理-Cache">清理 Cache</a>” 部分</p>
<h5 id="成本"><a href="#成本" class="headerlink" title="成本"></a>成本</h5><p>　清理 Cache 之前，需要保证 Cache 中的数据，和对应文件中的数据一致，才能对 Cache 进行释放。因此，清除 Cache 之前，内核会检查 Cache 数据与对应磁盘文件数据一致性，并将不一致的 Cache 写回磁盘。这一过程，将消耗大量的磁盘 I/O 资源</p>
<h5 id="无法被回收的情况"><a href="#无法被回收的情况" class="headerlink" title="无法被回收的情况"></a>无法被回收的情况</h5><h6 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tmtpost.com/43815.html">tmpfs</a></h6><p>　Linux 提供一种 “临时”文件系统（重启之后数据不会被保存），拿出一部分的内存空间当做文件系统使用，可以动态调整文件系统的大小，并且相比磁盘文件系统的读写速度，会快上很多倍。在 <strong>tmpfs</strong> 系统里面的内存，是不会被回收的，除非 tmpfs 里面的文件被删除</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 操作系统默认就创建了一个 `/dev/shm` 的 tmpfs 目录，可以用来做缓存，进行提速（Automatic Memory Management、Web 缓存等）</span></span><br><span class="line">$ ll -h /dev/shm</span><br><span class="line">  total 76K</span><br><span class="line">  -rw-r--r-- 1 root root  46 Aug 13 11:05 10694</span><br><span class="line">  -r-------- 1 root root 65M May 25 14:43 pulse-shm-17791060</span><br><span class="line">  -r-------- 1 root root 65M May 25 14:43 pulse-shm-31652098</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当然，也可以创建自己的 tmpfs</span></span><br><span class="line">$ mkdir /tmp/tmpfs</span><br><span class="line">$ mount -t tmpfs -o size=3G none /tmp/tmpfs/</span><br><span class="line">$ df -h</span><br><span class="line">  Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">  tmpfs            63G     0   63G   0% /dev/shm</span><br><span class="line">  none            3.0G     0  3.0G   0% /tmp/tmpfs</span><br><span class="line"></span><br><span class="line">$ free -g</span><br><span class="line">               total       used       free     shared    buffers     cached</span><br><span class="line">  Mem:           125         79         46          0          0          0</span><br><span class="line">  -/+ buffers/cache:         79         46</span><br><span class="line">  Swap:            0          0          0</span><br><span class="line"></span><br><span class="line">$ dd <span class="keyword">if</span>=/dev/zero of=/tmp/tmpfs/yuzhouwan bs=1G</span><br><span class="line">  dd: writing <span class="string">'/tmp/tmpfs/yuzhouwan'</span>: No space left on device</span><br><span class="line">  4+0 records <span class="keyword">in</span></span><br><span class="line">  3+0 records out</span><br><span class="line">  3221225472 bytes (3.2 GB) copied, 2.57476 s, 1.3 GB/s</span><br><span class="line"></span><br><span class="line">$ free -g</span><br><span class="line">               total       used       free     shared    buffers     cached</span><br><span class="line">  Mem:           125         83         42          0          0          3</span><br><span class="line">  -/+ buffers/cache:         80         45</span><br><span class="line">  Swap:            0          0          0</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ free -g</span><br><span class="line">               total       used       free     shared    buffers     cached</span><br><span class="line">  Mem:           125         84         41          0          0          3</span><br><span class="line">  -/+ buffers/cache:         80         44</span><br><span class="line">  Swap:            0          0          0</span><br><span class="line"></span><br><span class="line">$ rm /tmp/tmpfs/yuzhouwan</span><br><span class="line">$ free -g</span><br><span class="line">               total       used       free     shared    buffers     cached</span><br><span class="line">  Mem:           125         86         39          0          0          0</span><br><span class="line">  -/+ buffers/cache:         85         40</span><br><span class="line">  Swap:            0          0          0</span><br></pre></td></tr></tbody></table></figure>
<h6 id="ipcs"><a href="#ipcs" class="headerlink" title="ipcs"></a>ipcs</h6><p>　进程间通信（IPC）方式，只需要在 “输入文件” 到 “共享内存区” 之间进行两次数据的拷贝。但是，如果通过 <code>shmget</code> 创建完共享内存之后，没有在结束的时候，使用 <code>shmctl</code> 删除共享内存，那么，这块内存将一直无法被清理出去</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以通过以下两个命令，查看共享内存空间，并删除</span></span><br><span class="line">$ ipcs -m</span><br><span class="line">$ ipcrm -m &lt;shmid&gt;</span><br></pre></td></tr></tbody></table></figure>
<h6 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h6><p>　进程之间还可以通过 <code>mmap</code> 方法，映射同一个普通文件，来实现共享内存。普通文件被映射到进程地址空间后，进程可以像访问普通内存一样对文件进行访问，不必再调用 <code>read</code> / <code>write</code> 方法。同样地，如果没有在进程退出时，使用 <code>munmap</code> 方法解除映射关系，也会存在共享内存无法被清除的情况</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><h3 id="Book"><a href="#Book" class="headerlink" title="Book"></a>Book</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://fifilyu.github.io/halcpgb/">高可用负载均衡集群实践</a></li>
</ul>
<h3 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.memtest86.com/">MemTest86</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://pyropus.ca/software/memtester/">MemTester 4</a></li>
</ul>
<h2 id="欢迎加入我们的技术群，一起交流学习"><a href="#欢迎加入我们的技术群，一起交流学习" class="headerlink" title="欢迎加入我们的技术群，一起交流学习"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/asdf2014/yuzhouwan#technical-discussion-group">欢迎加入我们的技术群，一起交流学习</a></h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">群名称</th>
<th style="text-align:center">群号</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">人工智能（高级）</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=71c6bd3fb0ff01d93abca654140387d99d3be752f92a53c1fbfd27f2dd4b4247"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1020982-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">人工智能（进阶）</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=deb268f65589a1a0a1dbaf7b72c849ed45298697805bef81e0c613dea40cd05e"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1217710-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">BigData</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=f86b3c8de20da1658a3bb42df17a2fc4eee0d75c4a130a63585fdd257e3565ed"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1670647-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">算法</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=bfbcf1453371a0810fd6be235ace47147f6fb9d262fb768b497c861f50af0af4"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-5366753-blue.svg" alt></a></td>
</tr>
</tbody>
</table>
</div>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/190101/" rel="bookmark">程序员的 Mac 高效手册</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Benedict Jin
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://yuzhouwan.com/posts/15691/" title="Linux 实战技巧">https://yuzhouwan.com/posts/15691/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/Shell/" rel="tag"># Shell</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/39683/" rel="prev" title="Apache Eagle 深度调研">
      <i class="fa fa-chevron-left"></i> Apache Eagle 深度调研
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/2254/" rel="next" title="Maven 高级玩法">
      Maven 高级玩法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-gitalk">Gitalk：可用 Github 账号登录</a></li>
            <li class="tab"><a href="#comment-disqus">Disqus：海外</a></li>
            <li class="tab"><a href="#comment-valine">Valine：匿名</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments" id="gitalk-container"></div>
            </div>
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.</span> <span class="nav-text">常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#adduser"><span class="nav-number">1.1.</span> <span class="nav-text">adduser</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk"><span class="nav-number">1.2.</span> <span class="nav-text">awk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bash"><span class="nav-number">1.3.</span> <span class="nav-text">bash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cat"><span class="nav-number">1.4.</span> <span class="nav-text">cat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chown"><span class="nav-number">1.5.</span> <span class="nav-text">chown</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cp"><span class="nav-number">1.6.</span> <span class="nav-text">cp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crontab"><span class="nav-number">1.7.</span> <span class="nav-text">crontab</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#curl"><span class="nav-number">1.8.</span> <span class="nav-text">curl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#date"><span class="nav-number">1.9.</span> <span class="nav-text">date</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#df"><span class="nav-number">1.10.</span> <span class="nav-text">df</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#diff"><span class="nav-number">1.11.</span> <span class="nav-text">diff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#du"><span class="nav-number">1.12.</span> <span class="nav-text">du</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#echo"><span class="nav-number">1.13.</span> <span class="nav-text">echo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#find"><span class="nav-number">1.14.</span> <span class="nav-text">find</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#firefox"><span class="nav-number">1.15.</span> <span class="nav-text">firefox</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#grep"><span class="nav-number">1.16.</span> <span class="nav-text">grep</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hostname"><span class="nav-number">1.17.</span> <span class="nav-text">hostname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iostat"><span class="nav-number">1.18.</span> <span class="nav-text">iostat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jq"><span class="nav-number">1.19.</span> <span class="nav-text">jq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jstack"><span class="nav-number">1.20.</span> <span class="nav-text">jstack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jstat"><span class="nav-number">1.21.</span> <span class="nav-text">jstat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lsblk"><span class="nav-number">1.22.</span> <span class="nav-text">lsblk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lsof"><span class="nav-number">1.23.</span> <span class="nav-text">lsof</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nc"><span class="nav-number">1.24.</span> <span class="nav-text">nc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nmon"><span class="nav-number">1.25.</span> <span class="nav-text">nmon</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90-nmon-%E6%96%87%E4%BB%B6"><span class="nav-number">1.25.1.</span> <span class="nav-text">生成 nmon 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7"><span class="nav-number">1.25.2.</span> <span class="nav-text">系统资源实时监控</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nohup"><span class="nav-number">1.26.</span> <span class="nav-text">nohup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#make"><span class="nav-number">1.27.</span> <span class="nav-text">make</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#locale"><span class="nav-number">1.28.</span> <span class="nav-text">locale</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tar"><span class="nav-number">1.29.</span> <span class="nav-text">tar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#top"><span class="nav-number">1.30.</span> <span class="nav-text">top</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tree"><span class="nav-number">1.31.</span> <span class="nav-text">tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rpm"><span class="nav-number">1.32.</span> <span class="nav-text">rpm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rsync"><span class="nav-number">1.33.</span> <span class="nav-text">rsync</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sed"><span class="nav-number">1.34.</span> <span class="nav-text">sed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scp"><span class="nav-number">1.35.</span> <span class="nav-text">scp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#split"><span class="nav-number">1.36.</span> <span class="nav-text">split</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ssh"><span class="nav-number">1.37.</span> <span class="nav-text">ssh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sz"><span class="nav-number">1.38.</span> <span class="nav-text">sz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ping"><span class="nav-number">1.39.</span> <span class="nav-text">ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ps"><span class="nav-number">1.40.</span> <span class="nav-text">ps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ulimit"><span class="nav-number">1.41.</span> <span class="nav-text">ulimit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uname"><span class="nav-number">1.42.</span> <span class="nav-text">uname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#umask"><span class="nav-number">1.43.</span> <span class="nav-text">umask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim"><span class="nav-number">1.44.</span> <span class="nav-text">vim</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%89%E7%85%A7%E5%8D%95%E8%AF%8D%E8%B7%B3%E8%BD%AC"><span class="nav-number">1.44.1.</span> <span class="nav-text">按照单词跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%92%A4%E9%94%80"><span class="nav-number">1.44.2.</span> <span class="nav-text">撤销</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BF%BB%E9%A1%B5"><span class="nav-number">1.44.3.</span> <span class="nav-text">翻页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E5%B9%B6%E4%BF%9D%E5%AD%98"><span class="nav-number">1.44.4.</span> <span class="nav-text">退出并保存</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wget"><span class="nav-number">1.45.</span> <span class="nav-text">wget</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E-ftp-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="nav-number">1.45.1.</span> <span class="nav-text">从 ftp 服务器下载文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="nav-number">1.45.2.</span> <span class="nav-text">输出到控制台</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xargs"><span class="nav-number">1.46.</span> <span class="nav-text">xargs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E5%87%86-I-O"><span class="nav-number">1.47.</span> <span class="nav-text">标准 I&#x2F;O</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shell-%E7%BC%96%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">Shell 编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bashrc"><span class="nav-number">2.1.</span> <span class="nav-text">.bashrc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dirname"><span class="nav-number">2.2.</span> <span class="nav-text">dirname</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cut-string"><span class="nav-number">2.3.</span> <span class="nav-text">cut string</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#command"><span class="nav-number">2.4.</span> <span class="nav-text">command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for-loop"><span class="nav-number">2.5.</span> <span class="nav-text">for loop</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6"><span class="nav-number">2.5.1.</span> <span class="nav-text">遍历文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E7%94%A8%E6%B3%95"><span class="nav-number">2.5.2.</span> <span class="nav-text">进阶用法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function"><span class="nav-number">2.6.</span> <span class="nav-text">function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if"><span class="nav-number">2.7.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#paste"><span class="nav-number">2.8.</span> <span class="nav-text">paste</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#readlink"><span class="nav-number">2.9.</span> <span class="nav-text">readlink</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sed-1"><span class="nav-number">2.10.</span> <span class="nav-text">sed</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2"><span class="nav-number">2.10.1.</span> <span class="nav-text">替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%8C%B9%E9%85%8D%E8%A1%8C"><span class="nav-number">2.10.2.</span> <span class="nav-text">删除匹配行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%A9%BA%E7%99%BD%E8%A1%8C"><span class="nav-number">2.10.3.</span> <span class="nav-text">删除空白行</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sort"><span class="nav-number">2.11.</span> <span class="nav-text">sort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uniq"><span class="nav-number">2.12.</span> <span class="nav-text">uniq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exit-0"><span class="nav-number">2.13.</span> <span class="nav-text">exit 0</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="nav-number">3.</span> <span class="nav-text">实用技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IFS-%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">IFS 设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%8F%E7%A7%92%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1"><span class="nav-number">3.2.</span> <span class="nav-text">每秒执行一次</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="nav-number">3.3.</span> <span class="nav-text">自启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%BE%97%E5%BD%93%E5%89%8D%E6%9C%BA%E5%99%A8%E7%9A%84%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-number">3.4.</span> <span class="nav-text">获得当前机器的资源使用情况</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CPU"><span class="nav-number">3.4.1.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Memory"><span class="nav-number">3.4.2.</span> <span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Disk"><span class="nav-number">3.4.3.</span> <span class="nav-text">Disk</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">空间使用率</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#I-O-%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">I&#x2F;O 使用率</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Network"><span class="nav-number">3.4.4.</span> <span class="nav-text">Network</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%BE%97%E5%BD%93%E5%89%8D%E6%9C%BA%E5%99%A8%E7%9A%84-IP"><span class="nav-number">3.4.4.1.</span> <span class="nav-text">获得当前机器的 IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8E%E6%9C%BA%E5%99%A8%E5%88%97%E8%A1%A8%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%9B%AE%E6%A0%87-IP"><span class="nav-number">3.4.4.2.</span> <span class="nav-text">从机器列表中获取目标 IP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E5%92%8C%E4%B8%A2%E5%8C%85%E7%8E%87"><span class="nav-number">3.4.4.3.</span> <span class="nav-text">网络延迟和丢包率</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">3.4.5.</span> <span class="nav-text">通用工具</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tsar"><span class="nav-number">3.4.5.1.</span> <span class="nav-text">tsar</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E-JVM-%E8%BF%9B%E7%A8%8B%E4%B8%AD%EF%BC%8C%E6%89%BE%E5%88%B0%E5%8D%A0%E7%94%A8-CPU-%E6%9C%80%E9%AB%98%E7%9A%84-Java-%E7%BA%BF%E7%A8%8B"><span class="nav-number">3.5.</span> <span class="nav-text">从 JVM 进程中，找到占用 CPU 最高的 Java 线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-%E7%9B%B8%E5%85%B3"><span class="nav-number">3.6.</span> <span class="nav-text">Windows 相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows-%E4%B8%8B%E6%89%A7%E8%A1%8C-shell-%E8%84%9A%E6%9C%AC"><span class="nav-number">3.6.1.</span> <span class="nav-text">Windows 下执行 shell 脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cmd-%E8%AE%BE%E7%BD%AE-Proxy"><span class="nav-number">3.6.2.</span> <span class="nav-text">Cmd 设置 Proxy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cygwin"><span class="nav-number">3.6.3.</span> <span class="nav-text">Cygwin</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">3.6.3.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">3.6.3.2.</span> <span class="nav-text">使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-number">3.7.</span> <span class="nav-text">防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CentOS"><span class="nav-number">3.7.1.</span> <span class="nav-text">CentOS</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CentOS-6"><span class="nav-number">3.7.1.1.</span> <span class="nav-text">CentOS 6</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CentOS-7"><span class="nav-number">3.7.1.2.</span> <span class="nav-text">CentOS 7</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ubuntu"><span class="nav-number">3.7.2.</span> <span class="nav-text">Ubuntu</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98"><span class="nav-number">4.</span> <span class="nav-text">优化实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD-Swappiness"><span class="nav-number">4.1.</span> <span class="nav-text">关闭 Swappiness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6-Overcommit"><span class="nav-number">4.2.</span> <span class="nav-text">控制 Overcommit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E9%80%8F%E6%98%8E%E5%B7%A8%E9%A1%B5"><span class="nav-number">4.3.</span> <span class="nav-text">禁用透明巨页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Page-Size"><span class="nav-number">4.3.1.</span> <span class="nav-text">Page Size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Huge-Page-Size"><span class="nav-number">4.3.2.</span> <span class="nav-text">Huge Page Size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Transparent-Huge-Pages"><span class="nav-number">4.3.3.</span> <span class="nav-text">Transparent Huge Pages</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%90%86-Cache"><span class="nav-number">4.4.</span> <span class="nav-text">清理 Cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%A4%A7%E9%A2%84%E7%95%99%E7%A9%BA%E9%97%B2%E5%86%85%E5%AD%98"><span class="nav-number">4.5.</span> <span class="nav-text">增大预留空闲内存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="nav-number">5.</span> <span class="nav-text">系统架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cache-amp-Buffer"><span class="nav-number">5.1.</span> <span class="nav-text">Cache &amp; Buffer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">5.1.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90-Cache"><span class="nav-number">5.1.2.</span> <span class="nav-text">分析 Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fincore"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">fincore</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">5.1.2.1.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E7%A0%81"><span class="nav-number">5.1.2.1.2.</span> <span class="nav-text">编码</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#System-Tap"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">System Tap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pcstat"><span class="nav-number">5.1.2.3.</span> <span class="nav-text">pcstat</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E6%94%B6-Cache"><span class="nav-number">5.1.3.</span> <span class="nav-text">回收 Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C"><span class="nav-number">5.1.3.1.</span> <span class="nav-text">操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%88%90%E6%9C%AC"><span class="nav-number">5.1.3.2.</span> <span class="nav-text">成本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A0%E6%B3%95%E8%A2%AB%E5%9B%9E%E6%94%B6%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-number">5.1.3.3.</span> <span class="nav-text">无法被回收的情况</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#tmpfs"><span class="nav-number">5.1.3.3.1.</span> <span class="nav-text">tmpfs</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#ipcs"><span class="nav-number">5.1.3.3.2.</span> <span class="nav-text">ipcs</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mmap"><span class="nav-number">5.1.3.3.3.</span> <span class="nav-text">mmap</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90"><span class="nav-number">6.</span> <span class="nav-text">资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Book"><span class="nav-number">6.1.</span> <span class="nav-text">Book</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tool"><span class="nav-number">6.2.</span> <span class="nav-text">Tool</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E5%8A%A0%E5%85%A5%E6%88%91%E4%BB%AC%E7%9A%84%E6%8A%80%E6%9C%AF%E7%BE%A4%EF%BC%8C%E4%B8%80%E8%B5%B7%E4%BA%A4%E6%B5%81%E5%AD%A6%E4%B9%A0"><span class="nav-number">7.</span> <span class="nav-text">欢迎加入我们的技术群，一起交流学习</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Benedict Jin" src="/yuzhouwan_logo_128x128.ico">
  <p class="site-author-name" itemprop="name">Benedict Jin</p>
  <div class="site-description" itemprop="description">Benedict Jin's Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">144</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/asdf2014" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;asdf2014" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:asdf2014@apache.org" title="E-Mail → mailto:asdf2014@apache.org" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">苏 ICP 备 17032505号 </a>
  </div>

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuzhouwan.com</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">19:33</span>
</div>

        
<meta name="referrer" content="always">
<div class="busuanzi-count">
  <script async src="/lib/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.5/lib/darkmode-js.min.js"></script>
<script>
var options = {
  bottom: '32px', // default: '32px'
  right: '32px', // default: '32px'
  left: 'unset', // default: 'unset'
  time: '0.5s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: '🌓', // default: ''
  autoMatchOsTheme: false // default: true
}
const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
<style>
button.darkmode-toggle {
  z-index: 9999;
}
img, .darkmode-ignore {
  isolation: isolate;
  display: block;
}
</style>

  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<script>
  var disqus_config = function() {
    this.page.url = "https://yuzhouwan.com/posts/15691/";
    this.page.identifier = "posts/15691/";
    this.page.title = "Linux 实战技巧";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://yuzhouwan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'e5da61069b94deb8ef3a',
      clientSecret: 'c60ad4e430be258b705027a036eeee3d71cb934b',
      repo        : 'gitment',
      owner       : 'asdf2014',
      admin       : ['asdf2014'],
      id          : 'f682d6748f0225d2d424976d57d1a111',
        language: '',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'BU4bnWsdAliFfk3fz7iMcFUU-gzGzoHsz',
      appKey     : '1xVLNFSy1qGCda3wt4GiGzHG',
      placeholder: "上述信息都不是必填的，可以直接提交评论",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
