<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/yuzhouwan_logo_with_copyright.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/yuzhouwan_logo_32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/yuzhouwan_logo_16x16.ico">
  <link rel="mask-icon" href="/yuzhouwan_logo_with_copyright.jpg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yuzhouwan.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":5,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":{"valine":{"text":"Valine：匿名","order":-1},"disqus":{"text":"Disqus：海外","order":-2},"gitalk":{"text":"Gitalk：可用 Github 账号登录","order":-3}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="基本概念　Apache Eagle 是一个高度可扩展的监控警报平台，采用了设计灵活的应用框架和经过实践考验的大数据技术，如 Kafka，Spark 和 Storm。它提供了丰富的大数据平台监控程序，例如 HDFS &#x2F; HBase &#x2F; YARN 服务运行状况检查，JMX 指标，守护进程日志，审核日志 和 Yarn 应用程序。外部 Eagle 开发人员可以自定义应用来监视其 NoSQL 数据库或 We">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache Eagle 深度调研">
<meta property="og:url" content="https://yuzhouwan.com/posts/39683/">
<meta property="og:site_name" content="宇宙湾">
<meta property="og:description" content="基本概念　Apache Eagle 是一个高度可扩展的监控警报平台，采用了设计灵活的应用框架和经过实践考验的大数据技术，如 Kafka，Spark 和 Storm。它提供了丰富的大数据平台监控程序，例如 HDFS &#x2F; HBase &#x2F; YARN 服务运行状况检查，JMX 指标，守护进程日志，审核日志 和 Yarn 应用程序。外部 Eagle 开发人员可以自定义应用来监视其 NoSQL 数据库或 We">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_eagle_overview.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_architecture.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_alert_engine.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_storage_engine.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_sites_default.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_hbase_data_classification.png">
<meta property="og:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_hbase_policy_detail.png">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1020982-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1217710-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-1670647-blue.svg">
<meta property="og:image" content="https://img.shields.io/badge/QQ%E7%BE%A4-5366753-blue.svg">
<meta property="article:published_time" content="2017-04-05T13:38:04.000Z">
<meta property="article:modified_time" content="2020-09-30T14:20:11.903Z">
<meta property="article:author" content="Benedict Jin">
<meta property="article:tag" content="Apache Storm">
<meta property="article:tag" content="Apache Kafka">
<meta property="article:tag" content="Apache Hadoop">
<meta property="article:tag" content="Apache ZooKeeper">
<meta property="article:tag" content="ElasticSearch">
<meta property="article:tag" content="Apache Eagle">
<meta property="article:tag" content="Apache HBase">
<meta property="article:tag" content="Apache Yarn">
<meta property="article:tag" content="LogStash">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yuzhouwan.com/picture/eagle/apache_eagle_eagle_overview.png">

<link rel="canonical" href="https://yuzhouwan.com/posts/39683/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Apache Eagle 深度调研 | 宇宙湾</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97020848-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-97020848-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.null { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .null > span { position: relative; z-index: 10; }  .null img, .null .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .null img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .null-fallback { color: inherit; } .null-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
<link rel="alternate" href="/atom.xml" title="宇宙湾" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">宇宙湾</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">厚积薄发</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">147</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">54</span></a>

  </li>
        <li class="menu-item menu-item-书单">

    <a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i>书单</a>

  </li>
        <li class="menu-item menu-item-影视">

    <a href="/movies/" rel="section"><i class="fa fa-film fa-fw"></i>影视</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yuzhouwan.com/posts/39683/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/yuzhouwan_logo_128x128.ico">
      <meta itemprop="name" content="Benedict Jin">
      <meta itemprop="description" content="Benedict Jin's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇宙湾">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Apache Eagle 深度调研
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-04-05 21:38:04" itemprop="dateCreated datePublished" datetime="2017-04-05T21:38:04+08:00">2017-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-30 22:20:11" itemprop="dateModified" datetime="2020-09-30T22:20:11+08:00">2020-09-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>42k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>39 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>　<a href="https://yuzhouwan.com/posts/39683/">Apache Eagle</a> 是一个<code>高度可扩展</code>的监控警报平台，采用了<code>设计灵活</code>的应用框架和<code>经过实践考验</code>的大数据技术，如 <a href="https://yuzhouwan.com/posts/26002/">Kafka</a>，<a href="https://yuzhouwan.com/posts/4735/">Spark</a> 和 <a href="https://yuzhouwan.com/posts/13977/">Storm</a>。它提供了丰富的大数据平台监控程序，例如 <a href="https://yuzhouwan.com/posts/60504/">HDFS</a> / <a href="https://yuzhouwan.com/posts/45888/">HBase</a> / YARN 服务<code>运行状况检查</code>，<code>JMX 指标</code>，<code>守护进程日志</code>，<code>审核日志</code> 和 <code>Yarn</code> 应用程序。外部 Eagle 开发人员可以<code>自定义应用</code>来监视其 NoSQL 数据库或 Web 服务器，可以自己决定是否共享到 <code>Eagle 应用程序存储库</code>。它还提供最先进的<code>警报引擎</code>来报告<code>安全漏洞</code>，<code>服务故障</code>和<code>应用程序异常</code>，由警报策略定义<code>高度可定制</code>。</p>
<h3 id="Site"><a href="#Site" class="headerlink" title="Site"></a>Site</h3><p>　管理一组<code>应用程序</code>实例，用来区别某些被多次安装的应用程序</p>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>　应用程序（或监控应用程序）是 Apache Eagle 中的一级公民，它代表<code>端到端</code>的<code>监控</code> / <code>警报</code>解决方案，通常包含<code>监控源</code>入站，源的 <code>schema</code>规范，<code>警报策略</code>和 <code>仪表板定义</code></p>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>　Stream 是 Alert Engine 的输入，每个<code>应用程序</code>应该有自己的由开发人员定义的流。通常，流定义里面包含了一个类似 <code>POJO</code> 的结构。一旦定义完成，<code>应用程序</code>就有了将数据写入<code>Kafka</code> 的逻辑</p>
<a id="more"></a>
<h3 id="Data-Activity-Monitoring"><a href="#Data-Activity-Monitoring" class="headerlink" title="Data Activity Monitoring"></a>Data Activity Monitoring</h3><p>　内置监控应用程序，用于监控 <code>HDFS</code> / <code>HBase</code> / <code>Hive</code> 操作，并允许用户定义某些策略来实时检测<code>敏感数据访问</code>和<code>恶意数据操作</code></p>
<h3 id="Alert-Engine"><a href="#Alert-Engine" class="headerlink" title="Alert Engine"></a>Alert Engine</h3><p>　被所有其他<code>监控应用程序</code>所共享的特定<code>内置</code>应用程序，它从 Kafka 读取数据，并通过<code>实时应用策略</code>来处理数据，并<code>生成报警通知</code></p>
<h3 id="Policy"><a href="#Policy" class="headerlink" title="Policy"></a>Policy</h3><p>　Alert Engine 使用<code>规则</code>来匹配 Kafka 的数据输入（策略以 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wso2/siddhi">SiddhiQL</a> 格式定义）</p>
<h3 id="Alert"><a href="#Alert" class="headerlink" title="Alert"></a>Alert</h3><p>　如果输入到 <code>Alert Engine</code> 的任何数据符合该策略，则 Alert Engine 将生成一条消息并通过<code>警报发布者（Alert Publisher）</code>进行发布。这些消息我们称之为警报</p>
<h3 id="Alert-Publisher"><a href="#Alert-Publisher" class="headerlink" title="Alert Publisher"></a>Alert Publisher</h3><p>　它会将<code>警报</code>发布到可以是 <code>SMTP 通道</code>、<code>Kafka 通道</code>、<code>Slack 通道</code>或 其他<code>存储系统的外部通道</code></p>
<h2 id="核心架构"><a href="#核心架构" class="headerlink" title="核心架构"></a>核心架构</h2><h3 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h3><p><img data-src="/picture/eagle/apache_eagle_eagle_overview.png" alt></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/latest/underlying-design/">架构</a></h3><p><img data-src="/picture/eagle/apache_eagle_architecture.png" alt></p>
<h3 id="告警"><a href="#告警" class="headerlink" title="告警"></a>告警</h3><p><img data-src="/picture/eagle/apache_eagle_alert_engine.png" alt></p>
<h3 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h3><p><img data-src="/picture/eagle/apache_eagle_storage_engine.png" alt></p>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><h3 id="数据流接入和存储"><a href="#数据流接入和存储" class="headerlink" title="数据流接入和存储"></a>数据流接入和存储</h3><h4 id="Metrics-存储"><a href="#Metrics-存储" class="headerlink" title="Metrics 存储"></a>Metrics 存储</h4><ul>
<li>Eagle 为 HBase / RDMBS 提供了轻量级的 <code>ORM 框架</code>，支持使用 Java 注释便于定义<code>持久化数据模型</code></li>
<li>Eagle 在 NoSQL Model 上提供类似 SQL 的 REST 查询语言（List / Aggregation / Bucket / Rowkey / Rowkey  Query、Pagination、Sorting、Union、Join）</li>
<li>针对<code>时间序列数据</code>优化的 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/latest/underlying-design/#hbase-rowkey-design">Rowkey 设计</a>，针对<code>度量</code>/<code>实体</code>/<code>日志</code>等进行了优化，不同的存储类型</li>
</ul>
<h3 id="数据实时处理"><a href="#数据实时处理" class="headerlink" title="数据实时处理"></a>数据实时处理</h3><h4 id="流处理-API"><a href="#流处理-API" class="headerlink" title="流处理 API"></a>流处理 API</h4><p>　Eagle Alert Engine 是基于开源实时流处理框架的，如 Apache Storm 作为默认执行引擎，Apache Kafka 作为默认的<code>消息总线（Messaging Bus）</code></p>
<h4 id="告警框架"><a href="#告警框架" class="headerlink" title="告警框架"></a>告警框架</h4><ul>
<li>可伸缩的 Eagle 策略执行框架</li>
</ul>
<p>　　机器学习模块</p>
<ul>
<li>用户 Profile 离线训练以及异常监测架构</li>
</ul>
<p>　　核密度估计算法（Kernel Density Estimation）</p>
<ul>
<li>单一维度上用户行为直方图</li>
</ul>
<p>　　特征值分解算法（Eigen-Value Decomposition）</p>
<ul>
<li>展示重要的用户行为模式成分</li>
</ul>
<h3 id="Eagle-服务"><a href="#Eagle-服务" class="headerlink" title="Eagle 服务"></a>Eagle 服务</h3><h4 id="策略管理器"><a href="#策略管理器" class="headerlink" title="策略管理器"></a>策略管理器</h4><p>　Eagle 策略管理器 提供<code>交互友好的用户界面</code>和 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/latest/reference/#rest-apis">REST API</a> 供用户轻松地定义和管理策略<br>　Eagle 的用户界面 使得<code>策略的管理</code>、<code>敏感元数据的标识和导入</code>、<code>HDFS 或 Hive 的资源浏览</code>以及<code>预警仪表</code>等功能<br>　Eagle 策略引擎 默认支持 <code>WSO2 的 Siddhi CEP 引擎</code>和 <code>机器学习引擎</code>，以下是几个基于 <code>Siddi CEP</code> 的策略示例</p>
<h4 id="查询服务"><a href="#查询服务" class="headerlink" title="查询服务"></a>查询服务</h4><h5 id="单一事件执行策略（用户访问-Hive-中的敏感数据列）"><a href="#单一事件执行策略（用户访问-Hive-中的敏感数据列）" class="headerlink" title="单一事件执行策略（用户访问 Hive 中的敏感数据列）"></a>单一事件执行策略（用户访问 Hive 中的敏感数据列）</h5><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from hiveAccessLogStream[sensitivityType=='PHONE_NUMBER'] <span class="keyword">select</span> * <span class="keyword">insert</span> <span class="keyword">into</span> outputStream;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="基于窗口的策略（用户在-10-分钟内访问目录-tmp-private-多于-inverted-5-次）"><a href="#基于窗口的策略（用户在-10-分钟内访问目录-tmp-private-多于-inverted-5-次）" class="headerlink" title="基于窗口的策略（用户在 10 分钟内访问目录 /tmp/private 多于 inverted 5 次）"></a>基于窗口的策略（用户在 10 分钟内访问目录 /tmp/private 多于 inverted 5 次）</h5><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfsAuditLogEventStream[(src == '/tmp/private')]<span class="comment">#window.externalTime(timestamp,10 min) select user, count(timestamp) as aggValue group by user having aggValue &gt;= 5 insert into outputStream;</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><h3 id="数据活动监控"><a href="#数据活动监控" class="headerlink" title="数据活动监控"></a>数据活动监控</h3><p>　分析数据活动和提醒不安全访问是保护企业数据的基本要求。随着 Hadoop、Hive、Spark 技术的数据量<code>呈指数级增长</code>，了解<code>每个用户的数据活动</code>变得非常困难，更不用说每天在 <code>PB 级的数据流</code>中，<code>实时</code>地警告单个恶意事件<br>　保护企业数据从了解每个用户的数据活动开始。 Apache Eagle 已与许多流行的大数据平台集成，例如 Hadoop、Hive、Spark、Cassandra 等。Eagle 用户可以浏览<code>数据层次结构</code>，标记<code>敏感数据</code>，然后制定<code>全面的策略</code>，告警不安全的数据访问</p>
<h3 id="任务性能分析"><a href="#任务性能分析" class="headerlink" title="任务性能分析"></a>任务性能分析</h3><p>　运行 <code>MapReduce</code> 任务是人们用来分析 Hadoop 系统中数据的最流行的方式。分析<code>任务的性能</code>和<code>提供调优建议</code>对于 <code>Hadoop 系统稳定性</code>、<code>作业 SLA</code> 和 <code>资源使用情况</code>至关重要<br>　Eagle 通过两种方法来分析 <code>Job 的性能</code>。 首先，Eagle 定期用 <code>Yarn API</code> 为所有正在运行的作业<code>拍摄快照</code>；其次，Eagle 在作业完成后立即读取<code>作业生命周期事件</code>。通过这两种方法，Eagle 可以分析<code>单个 Job 的趋势</code>，<code>数据倾斜问题</code>，<code>失败原因</code>等。更进一步地，Eagle 可以通过考虑所有工作来分析整个 Hadoop 集群的性能</p>
<h3 id="集群性能分析"><a href="#集群性能分析" class="headerlink" title="集群性能分析"></a>集群性能分析</h3><p>　了解<code>为什么集群性能会下降</code>是至关重要的。那是因为最近一些<code>不正常的工作</code>被提交，还是存在大量的小文件，还是 <code>NameNode</code> 的性能降级了？<br>　Eagle 实时计算单个作业中每分钟的资源使用量，例如 CPU、内存、HDFS IO 字节、HDFS IO numOps 等，还可以收集 NameNode JMX 指标。将它们相关在一起，将有效地帮助系统管理员，找到集群缓慢的根本原因</p>
<h3 id="Ebay（2015）"><a href="#Ebay（2015）" class="headerlink" title="Ebay（2015）"></a>Ebay（2015）</h3><ul>
<li>Eagle 的数据行为监控系统已经部署到一个拥有 10000 多个节点的 Hadoop 集群之上，用以保护数百 PB 数据的安全</li>
<li>已针对 HDFS、Hive 等集群中的数据<code>内置了一些基础的安全策略</code>，并将不断引入更多的策略，以确保重要数据的绝对安全</li>
<li>Eagle 的策略涵盖多种模式，包括从访问模式、频繁访问数据集，预定义查询类型、Hive 表和列、HBase 表，以及基于机器学习模型生成的<code>用户 Profile</code> 相关的所有策略等</li>
<li>有广泛的策略来防止<code>数据的丢失</code>、数据被<code>拷贝到不安全地点</code>、<code>敏感数据被未授权区域访问</code>等</li>
<li>Eagle 策略定义上极大的<code>灵活性</code>和<code>扩展性</code>，使得未来可以轻易地继续扩展更多更复杂的策略，以支持更多<code>多元化</code>的用例场景</li>
</ul>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><h4 id="高拓展性"><a href="#高拓展性" class="headerlink" title="高拓展性"></a>高拓展性</h4><p>　Apache Eagle 围绕 <code>application</code> 概念构建了其核心框架，<code>application</code> 本身包括用于<code>监视源数据收集</code>，<code>预处理</code>和<code>归一化</code>的逻辑。开发人员可以使用 Eagle 的应用程序框架轻松开发自己的<code>开箱（out-of-box）</code>监控应用程序，并部署到 Eagle 中</p>
<h4 id="可伸缩"><a href="#可伸缩" class="headerlink" title="可伸缩"></a>可伸缩</h4><p>　Eagle 核心团队选择了<code>经过考验的大数据技术</code>来构建其基本运行时，并应用可扩展内核，根据<code>数据流的吞吐量</code>以及<code>受监控应用程序的数量</code>进行自适应</p>
<h4 id="实时性"><a href="#实时性" class="headerlink" title="实时性"></a>实时性</h4><p>　基于 <code>Storm</code> 或 <code>Spark Streaming</code> 的计算引擎使我们能够将<code>策略</code>应用于<code>数据流</code>，并实时生成警报。确保能在<code>亚秒级别</code>的时间内产生告警，一旦综合多种因素确定为危险操作，立即采取措施进行阻止</p>
<h4 id="动态配置"><a href="#动态配置" class="headerlink" title="动态配置"></a>动态配置</h4><p>　用户可以自由<code>启用</code>或<code>禁用</code>监控应用程序，而无需重新启动服务。还可以动态<code>添加</code>/<code>删除</code>/<code>更改</code>其警报策略，而不会对底层运行时造成任何影响</p>
<h4 id="简单易用"><a href="#简单易用" class="headerlink" title="简单易用"></a>简单易用</h4><p>　用户可以通过选择相应的<code>监控应用程序</code>并为服务配置<code>少量</code>参数，在几分钟内实现对服务的监控</p>
<h4 id="无侵入性"><a href="#无侵入性" class="headerlink" title="无侵入性"></a>无侵入性</h4><p>　Apache Eagle 使用<code>开箱即用（out-of-box）</code>的应用程序来监控服务，不需要对现有服务进行任何更改</p>
<h4 id="用户Profile"><a href="#用户Profile" class="headerlink" title="用户Profile"></a>用户Profile</h4><p>　Eagle 内置提供基于<code>机器学习算法</code>，对监控平台中的用户行为习惯建立<code>用户 Profile</code>，实现实时地用户行为告警</p>
<h4 id="开源"><a href="#开源" class="headerlink" title="开源"></a>开源</h4><p>　Apache Eagle 一直都是根据开源的标准来进行开发的</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><h4 id="目前流行度较差"><a href="#目前流行度较差" class="headerlink" title="目前流行度较差"></a>目前流行度较差</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Watch</th>
<th>Star</th>
<th>Fork</th>
<th>Commit</th>
<th>Contributors</th>
<th>Current Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>53</td>
<td>291</td>
<td>158</td>
<td>1047</td>
<td>27</td>
<td>2018-6-1</td>
</tr>
</tbody>
</table>
</div>
<h4 id="稳定性略不足"><a href="#稳定性略不足" class="headerlink" title="稳定性略不足"></a>稳定性略不足</h4><p>　最新 release 版本为 <code>eagle-0.5.0</code>，刚从 <code>0.4.0-incubating</code> 版本中孵化出来</p>
<p>　单元测试覆盖率过低：<strong>39%</strong></p>
<p>　另外，CI 系统方面，目前只有 <code>Jenkins</code> 在用，而 <code>Travis</code> 并未真实在用，在 fork 的私有分支下开启后，发现每次 build 过程需要一小时之久</p>
<h4 id="代码质量相对较差"><a href="#代码质量相对较差" class="headerlink" title="代码质量相对较差"></a>代码质量相对较差</h4><p>　由于 <code>check-in</code> 系统的不完善，没有对 代码质量、代码风格、测试覆盖率 等方面进行考量（Apache Eagle 暂定在 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://cwiki.apache.org/confluence/display/EAG/Eagle+Version+0.5.0">v0.5.0</a> 之后进行完善）</p>
<h2 id="对-HBase-的支持度"><a href="#对-HBase-的支持度" class="headerlink" title="对 HBase 的支持度"></a>对 HBase 的支持度</h2><h3 id="比对表"><a href="#比对表" class="headerlink" title="比对表"></a>比对表</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Version</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>v0.4.0</td>
<td>只支持 用户行为分析</td>
</tr>
<tr>
<td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cwiki.apache.org/confluence/display/EAG/Eagle+Version+0.5.0">v0.5.0</a></td>
<td>开始支持 JMX（Metric 不支持）、Add HBase master metric dashboard、Add HBase RegionServer metric dashboard、Integrate hbase metric to basic panel 等功能</td>
</tr>
</tbody>
</table>
</div>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.apache.org/jira/browse/EAGLE-866">Refactor HBase JMX Metric with appropriate navigation path</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.apache.org/jira/browse/EAGLE-845">HBase JMX Monitoring Dashboard</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.apache.org/jira/browse/EAGLE-651">HBase JMX Metric Monitoring Application</a></li>
</ul>
<h2 id="Eagle-环境搭建"><a href="#Eagle-环境搭建" class="headerlink" title="Eagle 环境搭建"></a>Eagle 环境搭建</h2><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="流式平台依赖"><a href="#流式平台依赖" class="headerlink" title="流式平台依赖"></a>流式平台依赖</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
<th style="text-align:center">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Storm</td>
<td>0.9.3 or later</td>
<td style="text-align:center">0.9.7</td>
</tr>
<tr>
<td>Kafka</td>
<td>0.8.x or later</td>
<td style="text-align:center">kafka_2.11-0.10.1.1</td>
</tr>
<tr>
<td>Java</td>
<td>1.7.x</td>
<td style="text-align:center">jdk-1.7.0_80（v0.4 不支持 JDK1.8）</td>
</tr>
<tr>
<td>NPM</td>
<td>3.x</td>
<td style="text-align:center">3.10.10（On MAC OS try <code>brew install node</code>）</td>
</tr>
<tr>
<td>LogStash</td>
<td>2.3.4</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>Maven</td>
<td>3.3.9</td>
</tr>
</tbody>
</table>
</div>
<h4 id="数据库依赖（Choose-one-of-them）"><a href="#数据库依赖（Choose-one-of-them）" class="headerlink" title="数据库依赖（Choose one of them）"></a>数据库依赖（Choose one of them）</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
<th style="text-align:center">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>HBase</td>
<td>0.98 or later</td>
<td style="text-align:center">2.7.3 （Hadoop 2.6.x is required）</td>
</tr>
<tr>
<td>MySQL</td>
<td></td>
<td style="text-align:center">5.5.18（Eagle v0.4 建议使用 MySQL）</td>
</tr>
<tr>
<td>Derby</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h4 id="沙箱"><a href="#沙箱" class="headerlink" title="沙箱"></a>沙箱</h4><div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
<th style="text-align:center">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hortonworks Sandbox</td>
<td>2.2.4</td>
</tr>
</tbody>
</table>
</div>
<h3 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h3><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><h5 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加用户，并赋予其密码</span></span><br><span class="line">$ adduser eagle</span><br><span class="line">$ passwd eagle            <span class="comment"># ur password for eagle user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋予用户可以 sudo 的权限</span></span><br><span class="line">$ chmod u+w /etc/sudoers</span><br><span class="line">$ vim /etc/sudoers</span><br><span class="line">  <span class="comment"># 找到 `root ALL=(ALL) ALL` 这行，并在下面添加 eagle 用户</span></span><br><span class="line">  eagle    ALL=(ALL)    ALL</span><br><span class="line">$ chmod u-w /etc/sudoers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到 eagle 用户</span></span><br><span class="line">$ su - eagle</span><br></pre></td></tr></tbody></table></figure>
<h5 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/eagle</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放软件目录 &amp; 安装目录 &amp; 日志目录</span></span><br><span class="line">$ mkdir install &amp;&amp; mkdir software &amp;&amp; mkdir logs</span><br></pre></td></tr></tbody></table></figure>
<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><h5 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h5><p>Download from <a target="_blank" rel="external nofollow noopener noreferrer" href="http://download.oracle.com/otn/java/jdk/7u80-b15/jdk-7u80-linux-x64.rpm">jdk-7u80-linux-x64.rpm</a><br>（现在需要注册登录 Oracle 账户才可下载）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x install/jdk-7u80-linux-x64.rpm</span><br><span class="line">$ sudo rpm -ivh install/jdk-7u80-linux-x64.rpm</span><br><span class="line">$ java -version</span><br><span class="line">  java version <span class="string">"1.7.0_80"</span></span><br><span class="line">  Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</span><br><span class="line">  Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">which</span> java</span><br><span class="line">  /usr/bin/java</span><br><span class="line"></span><br><span class="line">$ ln -s /usr/java/jdk1.7.0_80 software/jdk1.7.0_80</span><br><span class="line">$ ln -s /home/eagle/software/jdk1.7.0_80 software/java</span><br><span class="line">$ vim ~/.bash_profile</span><br><span class="line">  <span class="comment"># User specific environment and startup programs</span></span><br><span class="line">  JAVA_HOME=/home/eagle/software/java</span><br><span class="line">  CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">  PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME CLASSPATH PATH</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></tbody></table></figure>
<p>　如果需要清除之前的低版本 JDK，或者重装，可以参照（没有这个需求，可跳过）<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -qa | grep -E <span class="string">'jdk|java'</span></span><br><span class="line">  jdk-1.7.0_80-fcs.x86_64</span><br><span class="line"></span><br><span class="line">$ sudo rpm -e --nodeps jdk-1.7.0_80-fcs.x86_64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h5><h6 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh</span></span><br><span class="line">$ sudo yum install openssh-clients openssh-server -y</span><br><span class="line">$ ssh localhost</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/.ssh/</span><br><span class="line">$ ssh-keygen -t rsa</span><br><span class="line">$ cat id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">$ chmod 600 ./authorized_keys</span><br></pre></td></tr></tbody></table></figure>
<h6 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载安装包</span></span><br><span class="line">$ <span class="built_in">cd</span> /home/eagle/install/</span><br><span class="line">$ wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.7.3/hadoop-2.7.3.tar.gz</span><br><span class="line">$ wget http://mirror.bit.edu.cn/apache/hadoop/common/hadoop-2.7.3/hadoop-2.7.3.tar.gz.mds</span><br><span class="line">$ head -n 6 hadoop-2.7.3.tar.gz.mds</span><br><span class="line">  hadoop-2.7.3.tar.gz:    MD5 = 34 55 BB 57 E4 B4 90 6B  BE A6 7B 58 CC A7 8F A8</span><br><span class="line">  hadoop-2.7.3.tar.gz:   SHA1 = B84B 8989 3426 9C68 753E  4E03 6D21 395E 5A4A B5B1</span><br><span class="line">  hadoop-2.7.3.tar.gz: RMD160 = 8FE4 A91E 8C67 2A33 C4E9  61FB 607A DBBD 1AE5 E03A</span><br><span class="line">  hadoop-2.7.3.tar.gz: SHA224 = 23AB1EAB B7648921 7101671C DCF9D774 7B84AD50</span><br><span class="line">                                6A74E300 AE6617FA</span><br><span class="line">  hadoop-2.7.3.tar.gz: SHA256 = D489DF38 08244B90 6EB38F4D 081BA49E 50C4603D</span><br><span class="line">$ md5sum hadoop-2.7.3.tar.gz | tr <span class="string">"a-z"</span> <span class="string">"A-Z"</span></span><br><span class="line">  3455BB57E4B4906BBEA67B58CCA78FA8  HADOOP-2.7.3.TAR.GZ</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对比 MD5 码一致后进行解压安装</span></span><br><span class="line">$ tar zxvf hadoop-2.7.3.tar.gz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software/</span><br><span class="line">$ ln -s hadoop-2.7.3/ hadoop</span><br><span class="line">$ <span class="built_in">cd</span> hadoop/</span><br><span class="line">$ bin/hadoop version</span><br><span class="line">  Hadoop 2.7.3</span><br><span class="line"><span class="comment"># Trouble Shooting</span></span><br><span class="line">$ mkdir -p ~/input</span><br><span class="line">$ rm -r ~/output</span><br><span class="line">$ cp etc/hadoop/*.xml ~/input</span><br><span class="line">$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.3.jar grep ~/input ~/output <span class="string">'dfs[a-z.]+'</span></span><br><span class="line">$ cat  ~/output/*</span><br><span class="line">  1	dfsadmin</span><br></pre></td></tr></tbody></table></figure>
<h6 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.bashrc</span><br><span class="line">  <span class="comment"># .bashrc</span></span><br><span class="line">  <span class="comment"># Source global definitions</span></span><br><span class="line">  <span class="keyword">if</span> [ -f /etc/bashrc ]; <span class="keyword">then</span></span><br><span class="line">          . /etc/bashrc</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># User specific aliases and functions</span></span><br><span class="line">  <span class="comment"># Hadoop Environment Variables</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_HOME=~/software/hadoop</span><br><span class="line">  <span class="built_in">export</span> HADOOP_INSTALL=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_MAPRED_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_COMMON_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_HDFS_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> YARN_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=~/software/java</span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># 也可以通过 vim ~/software/hadoop/etc/hadoop/hadoop-env.sh 进行配置</span></span><br><span class="line"></span><br><span class="line">$ mkdir -p ~/data/hadoop/tmp</span><br><span class="line">$ vim ~/software/hadoop/etc/hadoop/core-site.xml</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;file:/home/eagle/data/hadoop/tmp&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">  &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">$ vim ~/software/hadoop/etc/hadoop/hdfs-site.xml</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;file:/home/eagle/data/hadoop/tmp/dfs/name&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;file:/home/eagle/data/hadoop/tmp/dfs/data&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">  &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启审计日志</span></span><br><span class="line">$ vim ~/software/hadoop/etc/hadoop/hadoop-env.sh</span><br><span class="line">  <span class="comment"># export HADOOP_NAMENODE_OPTS="-Dhadoop.security.logger=${HADOOP_SECURITY_LOGGER:-INFO,RFAS} -Dhdfs.audit.logger=${HDFS_AUDIT_LOGGER:-INFO,NullAppender} $HADOOP_NAMENODE_OPTS"</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_NAMENODE_OPTS=<span class="string">"-Dhadoop.security.logger=<span class="variable">${HADOOP_SECURITY_LOGGER:-INFO,RFAS}</span> -Dhdfs.audit.logger=<span class="variable">${HDFS_AUDIT_LOGGER:-INFO,RFAAUDIT}</span> <span class="variable">$HADOOP_NAMENODE_OPTS</span>"</span></span><br><span class="line"></span><br><span class="line">$ mkdir -p /home/eagle/logs/hadoop-hdfs/</span><br><span class="line">$ vim ~/software/hadoop/etc/hadoop/log4j.properties</span><br><span class="line">  <span class="comment"># log4j.appender.RFAAUDIT.File=${hadoop.log.dir}/hdfs-audit.log</span></span><br><span class="line">  log4j.appender.RFAAUDIT.File=/home/eagle/logs/hadoop-hdfs/hdfs-audit.log</span><br><span class="line">$ ps auxwww | grep NameNode | grep <span class="string">'hdfs.audit.logger'</span>  <span class="comment"># 检查是否生效</span></span><br><span class="line">$ tail -f ~/logs/hadoop-hdfs/hdfs-audit.log</span><br><span class="line"></span><br><span class="line">$ bin/hdfs namenode -format</span><br><span class="line">  17/04/07 16:27:17 INFO util.ExitUtil: Exiting with status 0</span><br></pre></td></tr></tbody></table></figure>
<h6 id="伪分布式"><a href="#伪分布式" class="headerlink" title="伪分布式"></a>伪分布式</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/software/hadoop/</span><br><span class="line">$ bin/hdfs dfs -mkdir -p /user/hadoop</span><br><span class="line"><span class="comment"># bin/hdfs dfs -rm -r /home    # 如果有脏数据，可以先清除</span></span><br><span class="line"><span class="comment"># bin/hdfs dfs -ls /user       # 执行 mkdir 命令后，检查是否成功</span></span><br><span class="line">$ bin/hdfs dfs -mkdir /user/hadoop/input</span><br><span class="line">$ bin/hdfs dfs -put etc/hadoop/*.xml /user/hadoop/input</span><br><span class="line">$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-*.jar grep /user/hadoop/input /user/hadoop/output <span class="string">'dfs[a-z.]+'</span></span><br><span class="line"><span class="comment"># 查看输出目录</span></span><br><span class="line">$ bin/hdfs dfs -ls /user/hadoop/output/</span><br><span class="line">  -rw-r--r--   1 eagle supergroup          0 2017-04-10 10:26 /user/hadoop/output/_SUCCESS</span><br><span class="line">  -rw-r--r--   1 eagle supergroup         97 2017-04-10 10:26 /user/hadoop/output/part-r-00000</span><br><span class="line"><span class="comment"># 查看统计结果</span></span><br><span class="line">$ bin/hdfs dfs -cat /user/hadoop/output/part-r-00000</span><br><span class="line">  1    dfsadmin</span><br><span class="line">  1    dfs.replication</span><br><span class="line">  1    dfs.namenode.name.dir</span><br><span class="line">  1    dfs.namenode.http</span><br><span class="line">  1    dfs.datanode.data.dir</span><br><span class="line"><span class="comment"># 取回统计结果</span></span><br><span class="line">$ bin/hdfs dfs -get /user/hadoop/output ~/output</span><br><span class="line"><span class="comment"># cat ~/output/*                # 本地查看统计结果</span></span><br></pre></td></tr></tbody></table></figure>
<h6 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/software/hadoop/</span><br><span class="line">$ mv etc/hadoop/mapred-site.xml.template etc/hadoop/mapred-site.xml</span><br><span class="line">$ vim etc/hadoop/mapred-site.xml</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">  &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">$ vim etc/hadoop/yarn-site.xml</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">  &lt;/configuration&gt;</span><br></pre></td></tr></tbody></table></figure>
<h6 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 `NaneNode` 和 `DataNode` 守护进程</span></span><br><span class="line">$ sbin/start-dfs.sh</span><br><span class="line">$ jps -ml | grep -v jps</span><br><span class="line">  13196 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">  13503 org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</span><br><span class="line">  13329 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">  31639 org.apache.catalina.startup.Bootstrap start</span><br><span class="line">  13685 sun.tools.jps.Jps -ml</span><br><span class="line"><span class="comment"># 如果没有正常启动，可以在 `/home/eagle/software/hadoop-2.7.3/logs/hadoop-eagle-namenode-federation02.log` 中排查</span></span><br><span class="line"><span class="comment"># 正常启动后，可访问 http://eagle01:50071</span></span><br><span class="line"></span><br><span class="line">$ sbin/start-yarn.sh            <span class="comment"># 需要确保已经启动好 HDFS</span></span><br><span class="line"><span class="comment"># 开启历史服务器，可在 Web UI 中查看任务运行状况</span></span><br><span class="line">$ sbin/mr-jobhistory-daemon.sh start historyserver</span><br><span class="line">$ jps -ml | grep -v jps</span><br><span class="line">  3691 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">  3995 org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</span><br><span class="line">  3821 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">  4271 org.apache.hadoop.yarn.server.nodemanager.NodeManager</span><br><span class="line">  4175 org.apache.hadoop.yarn.server.resourcemanager.ResourceManager</span><br><span class="line">  4671 org.apache.hadoop.mapreduce.v2.hs.JobHistoryServer</span><br><span class="line">  31639 org.apache.catalina.startup.Bootstrap start</span><br><span class="line"><span class="comment"># 正常启动后，可访问 http://eagle01:8088</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="LogStash"><a href="#LogStash" class="headerlink" title="LogStash"></a>LogStash</h5><h6 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址 https://www.elastic.co/downloads/past-releases/logstash-2-3-4</span></span><br><span class="line">$ tar zxvf logstash-2.3.4.tar.gz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software</span><br><span class="line">$ ln -s logstash-2.3.4/ logstash</span><br><span class="line">$ <span class="built_in">cd</span> logstash</span><br><span class="line">$ bin/logstash-plugin list | grep output-kafka</span><br><span class="line">  logstash-output-kafka</span><br><span class="line"><span class="comment"># 如果没有默认安装，需要执行 `bin/logstash-plugin install logstash-output-kafka`</span></span><br><span class="line"><span class="comment"># 如需配置代理，则先执行 `export HTTP_PROXY=http://10.10.10.10:9999`</span></span><br></pre></td></tr></tbody></table></figure>
<h6 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /home/eagle/logs/hadoop-hdfs</span><br><span class="line">$ mkdir -p /home/eagle/logs/logstash</span><br><span class="line">$ mkdir conf</span><br><span class="line">$ vim conf/hdfs-audit.conf</span><br><span class="line">  input {</span><br><span class="line">    file {</span><br><span class="line">      <span class="built_in">type</span> =&gt; <span class="string">"cdh-nn-audit"</span></span><br><span class="line">      <span class="comment"># 这里需要需要和 etc/hadoop/log4j.properties 中配置的 log4j.appender.RFAAUDIT.File 一致</span></span><br><span class="line">      path =&gt; <span class="string">"/home/eagle/logs/hadoop-hdfs/hdfs-audit.log"</span></span><br><span class="line">      start_position =&gt; end</span><br><span class="line">      sincedb_path =&gt; <span class="string">"/home/eagle/logs/logstash/logstash.log"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  filter{</span><br><span class="line">    <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"cdh-nn-audit"</span> {</span><br><span class="line">      grok {</span><br><span class="line">        match =&gt; [<span class="string">"message"</span>, <span class="string">"ugi=(?&lt;user&gt;([\w\d\-]+))@|ugi=(?&lt;user&gt;([\w\d\-]+))/[\w\d\-.]+@|ugi=(?&lt;user&gt;([\w\d.\-_]+))[\s(]+"</span>]</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  output {</span><br><span class="line">    <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"cdh-nn-audit"</span> {</span><br><span class="line">        kafka {</span><br><span class="line">        codec =&gt; plain {</span><br><span class="line">          format =&gt; <span class="string">"%{message}"</span></span><br><span class="line">        }</span><br><span class="line">        bootstrap_servers =&gt; <span class="string">"localhost:9092"</span></span><br><span class="line">        topic_id =&gt; <span class="string">"hdfs_audit_log"</span></span><br><span class="line">        timeout_ms =&gt; 10000</span><br><span class="line">        retries =&gt; 3</span><br><span class="line">        client_id =&gt; <span class="string">"cdh-nn-audit"</span></span><br><span class="line">      }</span><br><span class="line">      <span class="comment"># stdout { codec =&gt; rubydebug }</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<h6 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ nohup bin/logstash -f conf/hdfs-audit.conf &gt; ~/logs/logstash/hdfs-audit.log 2&gt;&amp;1 &amp;</span><br><span class="line">  Settings: Default pipeline workers: 2</span><br><span class="line">  Pipeline main started</span><br><span class="line">$ tail -f ~/logs/logstash/hdfs-audit.log</span><br></pre></td></tr></tbody></table></figure>
<h5 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h5><h6 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/install/</span><br><span class="line">$ wget http://archive.apache.org/dist/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz</span><br><span class="line"><span class="comment"># MD5 校验，参照上文 “Hadoop-安装” 部分</span></span><br><span class="line">$ tar zxvf zookeeper-3.4.10.tar.gz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software</span><br><span class="line">$ ln -s zookeeper-3.4.10 zookeeper</span><br></pre></td></tr></tbody></table></figure>
<h6 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> zookeeper</span><br><span class="line">$ mkdir tmp</span><br><span class="line">$ cp conf/zoo_sample.cfg conf/zoo.cfg</span><br><span class="line">$ mkdir -p /home/eagle/data/zookeeper</span><br><span class="line">$ mkdir -p /home/eagle/logs/zookeeper</span><br><span class="line">$ vim conf/zoo.cfg</span><br><span class="line">  dataDir=/home/eagle/data/zookeeper</span><br><span class="line">  dataLogDir=/home/eagle/logs/zookeeper</span><br></pre></td></tr></tbody></table></figure>
<h6 id="启动-2"><a href="#启动-2" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bin/zkServer.sh start</span><br><span class="line">$ bin/zkServer.sh status</span><br><span class="line">  ZooKeeper JMX enabled by default</span><br><span class="line">  Using config: /home/eagle/software/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">  Mode: standalone</span><br><span class="line">$ bin/zkCli.sh</span><br></pre></td></tr></tbody></table></figure>
<h5 id="Storm"><a href="#Storm" class="headerlink" title="Storm"></a>Storm</h5><h6 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/install/</span><br><span class="line">$ wget http://archive.apache.org/dist/storm/apache-storm-0.9.7/apache-storm-0.9.7.tar.gz</span><br><span class="line"><span class="comment"># MD5 校验，参照上文 “Hadoop-安装” 部分</span></span><br><span class="line">$ tar zxvf apache-storm-0.9.7.tar.gz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software</span><br><span class="line">$ ln -s apache-storm-0.9.7 storm</span><br><span class="line">$ <span class="built_in">cd</span> storm</span><br><span class="line">$ vim ~/.bashrc</span><br><span class="line">  <span class="keyword">if</span> [ -f /etc/bashrc ]; <span class="keyword">then</span></span><br><span class="line">          . /etc/bashrc</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_HOME=~/software/hadoop</span><br><span class="line">  <span class="built_in">export</span> HADOOP_INSTALL=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_MAPRED_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_COMMON_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_HDFS_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> YARN_HOME=<span class="variable">$HADOOP_HOME</span></span><br><span class="line">  <span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$HADOOP_HOME</span>/lib/native</span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=~/software/java</span><br><span class="line">  <span class="built_in">export</span> STORM_HOME=~/software/storm</span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$STORM_HOME</span>/bin</span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line">$ storm version</span><br><span class="line">  0.9.7</span><br></pre></td></tr></tbody></table></figure>
<h6 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/storm.yaml</span><br><span class="line">  storm.zookeeper.servers:</span><br><span class="line">    - <span class="string">"127.0.0.1"</span></span><br><span class="line">  storm.zookeeper.port: 2181</span><br><span class="line">  nimbus.host: <span class="string">"127.0.0.1"</span></span><br><span class="line">  ui.host: 0.0.0.0</span><br><span class="line">  ui.port: 8081              <span class="comment"># default: 8080</span></span><br></pre></td></tr></tbody></table></figure>
<h6 id="启动-3"><a href="#启动-3" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/logs/storm</span><br><span class="line">$ nohup bin/storm nimbus &gt; ~/logs/storm/nimbus.log 2&gt;&amp;1 &amp;</span><br><span class="line">$ nohup bin/storm supervisor &gt; ~/logs/storm/supervisor.log 2&gt;&amp;1 &amp;</span><br><span class="line">$ nohup bin/storm ui &gt; ~/logs/storm/ui.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># 查看 UI http://eagle01:8081/index.html</span></span><br><span class="line"></span><br><span class="line">$ jps -ml | grep -v jps</span><br><span class="line">  17557 backtype.storm.daemon.nimbus</span><br><span class="line">  17675 backtype.storm.daemon.supervisor</span><br><span class="line">  20403 backtype.storm.ui.core</span><br><span class="line">  17043 org.apache.zookeeper.server.quorum.QuorumPeerMain /home/eagle/software/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">  3691 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">  3995 org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</span><br><span class="line">  3821 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">  4271 org.apache.hadoop.yarn.server.nodemanager.NodeManager</span><br><span class="line">  4175 org.apache.hadoop.yarn.server.resourcemanager.ResourceManager</span><br><span class="line">  4671 org.apache.hadoop.mapreduce.v2.hs.JobHistoryServer</span><br><span class="line">  15515 org.jruby.Main --1.9 /home/eagle/software/logstash/lib/bootstrap/environment.rb logstash/runner.rb agent -f conf/hdfs-audit.conf</span><br><span class="line">  7212 org.apache.catalina.startup.Bootstrap start</span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">$ bin/storm jar examples/storm-starter/storm-starter-topologies-0.9.7.jar storm.starter.WordCountTopology | grep <span class="string">'Thread-[0-9]*-count'</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h5><h6 id="Scala依赖"><a href="#Scala依赖" class="headerlink" title="Scala依赖"></a>Scala依赖</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/install/</span><br><span class="line">$ wget https://downloads.lightbend.com/scala/2.11.8/scala-2.11.8.tgz --no-check-certificate</span><br><span class="line">$ tar zxvf scala-2.11.8.tgz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software/</span><br><span class="line">$ ln -s scala-2.11.8/ scala</span><br><span class="line">$ vim ~/.bash_profile</span><br><span class="line">  JAVA_HOME=/home/eagle/software/java</span><br><span class="line">  SCALA_HOME=/home/eagle/software/scala</span><br><span class="line">  CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">  PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$SCALA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME CLASSPATH PATH</span><br><span class="line"></span><br><span class="line">$ bash ~/.bash_profile</span><br></pre></td></tr></tbody></table></figure>
<h6 id="安装-4"><a href="#安装-4" class="headerlink" title="安装"></a>安装</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/install/</span><br><span class="line">$ wget http://archive.apache.org/dist/kafka/0.10.1.1/kafka_2.11-0.10.1.1.tgz</span><br><span class="line"><span class="comment"># MD5 校验，参照上文 “Hadoop-安装” 部分</span></span><br><span class="line">$ tar zxvf kafka_2.11-0.10.1.1.tgz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software</span><br><span class="line">$ ln -s kafka_2.11-0.10.1.1 kafka</span><br></pre></td></tr></tbody></table></figure>
<h6 id="配置-4"><a href="#配置-4" class="headerlink" title="配置"></a>配置</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> kafka</span><br><span class="line">$ mkdir -p ~/logs/kafka</span><br><span class="line">$ vim config/zookeeper.properties</span><br><span class="line">  dataDir=/home/eagle/data/zookeeper</span><br><span class="line">  clientPort=2181</span><br><span class="line">  maxClientCnxns=0</span><br><span class="line"></span><br><span class="line">$ vim config/server.properties</span><br><span class="line">  log.dirs=/home/eagle/logs/kafka</span><br></pre></td></tr></tbody></table></figure>
<h6 id="启动-4"><a href="#启动-4" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ nohup bin/kafka-server-start.sh config/server.properties &gt; ~/logs/kafka/kafka.server.log 2&gt;&amp;1 &amp;</span><br><span class="line">$ tail -f /home/eagle/software/hbase/logs/hbase-eagle-master-federation01.out</span><br><span class="line">$ bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic hdfs_audit_log</span><br><span class="line">  Created topic <span class="string">"hdfs_audit_log"</span>.</span><br><span class="line"></span><br><span class="line">$ bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class="line">  hdfs_audit_log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否能成功消费到 LogStash 发送的 audit 日志</span></span><br><span class="line">$ bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic hdfs_audit_log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 offset</span></span><br><span class="line">$ ~/software/zookeeper/bin/zkCli.sh</span><br><span class="line">  [zk: localhost:2181(CONNECTED) 19] get /consumers/console-consumer-51054/offsets/hdfs_audit_log/0 </span><br><span class="line">    0</span><br><span class="line">    cZxid = 0x396</span><br><span class="line">    ctime = Tue Apr 11 15:59:22 CST 2017</span><br><span class="line">    mZxid = 0x396</span><br><span class="line">    mtime = Tue Apr 11 15:59:22 CST 2017</span><br><span class="line">    pZxid = 0x396</span><br><span class="line">    cversion = 0</span><br><span class="line">    dataVersion = 0</span><br><span class="line">    aclVersion = 0</span><br><span class="line">    ephemeralOwner = 0x0</span><br><span class="line">    dataLength = 1</span><br><span class="line">    numChildren = 0</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Eagle"><a href="#Eagle" class="headerlink" title="Eagle"></a>Eagle</h4><h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> install</span><br><span class="line">$ wget http://archive.apache.org/dist/eagle/apache-eagle-0.4.0-incubating/apache-eagle-0.4.0-incubating-src.tar.gz</span><br><span class="line">$ tar zxvf apache-eagle-0.4.0-incubating-src.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> apache-eagle-0.4.0-incubating-src</span><br><span class="line">$ curl -O https://patch-diff.githubusercontent.com/raw/apache/eagle/pull/268.patch</span><br><span class="line">$ git apply 268.patch</span><br><span class="line">$ mvn clean package -T 1C -DskipTests</span><br><span class="line"><span class="comment"># build 成功之后，会得到一个 tar 包 eagle-assembly/target/apache-eagle-0.4.0-incubating-bin.tar.gz</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="安装-5"><a href="#安装-5" class="headerlink" title="安装"></a>安装</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/eagle/install/</span><br><span class="line">$ tar zxvf apache-eagle-0.4.0-incubating-bin.tar.gz -C /home/eagle/software/</span><br><span class="line">$ <span class="built_in">cd</span> /home/eagle/software/</span><br><span class="line">$ ln -s apache-eagle-0.4.0-incubating/ eagle</span><br><span class="line">$ <span class="built_in">cd</span> eagle</span><br><span class="line">$ bin/eagle-service.sh start</span><br><span class="line">  Starting eagle service ...</span><br><span class="line">  Existing PID file found during start.</span><br><span class="line">  Removing/clearing stale PID file.</span><br><span class="line">  Eagle service started.</span><br><span class="line"><span class="comment"># 访问 http://eagle01:9099/eagle-service # default: admin/secret</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="配置-Eagle"><a href="#配置-Eagle" class="headerlink" title="配置 Eagle"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/latest/reference/#configuration">配置 Eagle</a></h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/software/eagle</span><br><span class="line">$ vim bin/eagle-env.sh</span><br><span class="line">  <span class="comment"># set EAGLE_HOME</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_HOME=$(dirname <span class="variable">$0</span>)/..</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The java implementation to use. please use jdk 1.7 or later</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=<span class="variable">${JAVA_HOME}</span></span><br><span class="line">  <span class="comment"># export JAVA_HOME=/usr/java/jdk1.7.0_80/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># nimbus.host, default is localhost</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_NIMBUS_HOST=localhost</span><br><span class="line"></span><br><span class="line">  <span class="comment"># EAGLE_SERVICE_HOST, default is `hostname -f`</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_SERVICE_HOST=localhost</span><br><span class="line"></span><br><span class="line">  <span class="comment"># EAGLE_SERVICE_PORT, default is 9099</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_SERVICE_PORT=9099</span><br><span class="line"></span><br><span class="line">  <span class="comment"># EAGLE_SERVICE_USER</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_SERVICE_USER=admin</span><br><span class="line"></span><br><span class="line">  <span class="comment"># EAGLE_SERVICE_PASSWORD</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_SERVICE_PASSWD=secret</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> EAGLE_CLASSPATH=<span class="variable">$EAGLE_HOME</span>/conf</span><br><span class="line">  <span class="comment"># Add eagle shared library jars</span></span><br><span class="line">  <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$EAGLE_HOME</span>/lib/share/*;<span class="keyword">do</span></span><br><span class="line">          EAGLE_CLASSPATH=<span class="variable">$EAGLE_CLASSPATH</span>:<span class="variable">$file</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Add eagle storm library jars</span></span><br><span class="line">  <span class="comment"># Separate out of share directory because of asm version conflict</span></span><br><span class="line">  <span class="built_in">export</span> EAGLE_STORM_CLASSPATH=<span class="variable">$EAGLE_CLASSPATH</span></span><br><span class="line">  <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$EAGLE_HOME</span>/lib/storm/*;<span class="keyword">do</span></span><br><span class="line">          EAGLE_STORM_CLASSPATH=<span class="variable">$EAGLE_STORM_CLASSPATH</span>:<span class="variable">$file</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ vim conf/eagle-scheduler.conf</span><br><span class="line">  <span class="comment">### scheduler propertise</span></span><br><span class="line">  appCommandLoaderEnabled = <span class="literal">false</span></span><br><span class="line">  appCommandLoaderIntervalSecs = 1</span><br><span class="line">  appHealthCheckIntervalSecs = 5</span><br><span class="line"></span><br><span class="line">  <span class="comment">### execution platform properties</span></span><br><span class="line">  envContextConfig.env = <span class="string">"storm"</span></span><br><span class="line">  envContextConfig.url = <span class="string">"http://localhost:8081"</span></span><br><span class="line">  envContextConfig.nimbusHost = <span class="string">"localhost"</span></span><br><span class="line">  envContextConfig.nimbusThriftPort = 6627</span><br><span class="line">  envContextConfig.jarFile = <span class="string">"/home/eagle/software/eagle/lib/topology/eagle-topology-0.4.0-incubating-assembly.jar"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">### default topology properties</span></span><br><span class="line">  eagleProps.mailHost = <span class="string">"mailHost.com"</span></span><br><span class="line">  eagleProps.mailSmtpPort = <span class="string">"25"</span></span><br><span class="line">  eagleProps.mailDebug = <span class="string">"true"</span></span><br><span class="line">  eagleProps.eagleService.host = <span class="string">"localhost"</span></span><br><span class="line">  eagleProps.eagleService.port = 9099</span><br><span class="line">  eagleProps.eagleService.username = <span class="string">"admin"</span></span><br><span class="line">  eagleProps.eagleService.password = <span class="string">"secret"</span></span><br><span class="line">  eagleProps.dataJoinPollIntervalSec = 30</span><br><span class="line"></span><br><span class="line">  dynamicConfigSource.enabled = <span class="literal">true</span></span><br><span class="line">  dynamicConfigSource.initDelayMillis = 0</span><br><span class="line">  dynamicConfigSource.delayMillis = 30000</span><br><span class="line"></span><br><span class="line">$ vim conf/sandbox-hdfsAuditLog-application.conf</span><br><span class="line">{</span><br><span class="line">  <span class="string">"envContextConfig"</span> : {</span><br><span class="line">    <span class="string">"env"</span> : <span class="string">"storm"</span>,</span><br><span class="line">    <span class="string">"mode"</span> : <span class="string">"cluster"</span>,</span><br><span class="line">    <span class="string">"topologyName"</span> : <span class="string">"sandbox-hdfsAuditLog-topology"</span>,</span><br><span class="line">    <span class="string">"stormConfigFile"</span> : <span class="string">"security-auditlog-storm.yaml"</span>,</span><br><span class="line">    <span class="string">"parallelismConfig"</span> : {</span><br><span class="line">      <span class="string">"kafkaMsgConsumer"</span> : 1,</span><br><span class="line">      <span class="string">"hdfsAuditLogAlertExecutor*"</span> : 1</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"dataSourceConfig"</span>: {</span><br><span class="line">    <span class="string">"topic"</span> : <span class="string">"hdfs_audit_log"</span>,</span><br><span class="line">    <span class="string">"zkConnection"</span> : <span class="string">"127.0.0.1:2181"</span>,</span><br><span class="line">    <span class="string">"brokerZkPath"</span> : <span class="string">"/brokers"</span>,</span><br><span class="line">    <span class="string">"zkConnectionTimeoutMS"</span> : 15000,</span><br><span class="line">    <span class="string">"fetchSize"</span> : 1048586,</span><br><span class="line">    <span class="string">"deserializerClass"</span> : <span class="string">"org.apache.eagle.security.auditlog.HdfsAuditLogKafkaDeserializer"</span>,</span><br><span class="line">    <span class="string">"transactionZKServers"</span> : <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"transactionZKPort"</span> : 2181,</span><br><span class="line">    <span class="string">"transactionZKRoot"</span> : <span class="string">"/consumers"</span>,</span><br><span class="line">    <span class="string">"consumerGroupId"</span> : <span class="string">"eagle.hdfsaudit.consumer"</span>,</span><br><span class="line">    <span class="string">"transactionStateUpdateMS"</span> : 2000</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"alertExecutorConfigs"</span> : {</span><br><span class="line">     <span class="string">"hdfsAuditLogAlertExecutor"</span> : {</span><br><span class="line">       <span class="string">"parallelism"</span> : 1,</span><br><span class="line">       <span class="string">"partitioner"</span> : <span class="string">"org.apache.eagle.policy.DefaultPolicyPartitioner"</span>,</span><br><span class="line">       <span class="string">"needValidation"</span> : <span class="string">"true"</span></span><br><span class="line">     }</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"eagleProps"</span> : {</span><br><span class="line">    <span class="string">"site"</span> : <span class="string">"sandbox"</span>,</span><br><span class="line">    <span class="string">"application"</span>: <span class="string">"hdfsAuditLog"</span>,</span><br><span class="line">        <span class="string">"dataJoinPollIntervalSec"</span> : 30,</span><br><span class="line">    <span class="string">"mailHost"</span> : <span class="string">"mailHost.com"</span>,</span><br><span class="line">    <span class="string">"mailSmtpPort"</span>:<span class="string">"25"</span>,</span><br><span class="line">    <span class="string">"mailDebug"</span> : <span class="string">"true"</span>,</span><br><span class="line">    <span class="string">"eagleService"</span>: {</span><br><span class="line">      <span class="string">"host"</span>: <span class="string">"localhost"</span>,</span><br><span class="line">      <span class="string">"port"</span>: 9099</span><br><span class="line">      <span class="string">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">      <span class="string">"password"</span>: <span class="string">"secret"</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"dynamicConfigSource"</span> : {</span><br><span class="line">        <span class="string">"enabled"</span> : <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"initDelayMillis"</span> : 0,</span><br><span class="line">        <span class="string">"delayMillis"</span> : 30000</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="元数据存储"><a href="#元数据存储" class="headerlink" title="元数据存储"></a>元数据存储</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ su - mysql</span><br><span class="line">$ mysql -uroot -p -S /home/mysql/data/mysql.sock</span><br><span class="line">  create database eagle;</span><br><span class="line">  <span class="comment"># 用户创建 &amp; 赋权，详见下文 “踩过的坑 - MySQL” 部分</span></span><br><span class="line"></span><br><span class="line">$ su - eagle</span><br><span class="line">$ vim /home/eagle/software/eagle/conf/eagle-service.conf</span><br><span class="line">eagle {</span><br><span class="line">  service {</span><br><span class="line">    storage-type=<span class="string">"jdbc"</span></span><br><span class="line">    storage-adapter=<span class="string">"mysql"</span></span><br><span class="line">    storage-username=<span class="string">"eagle"</span></span><br><span class="line">    storage-password=eagle</span><br><span class="line">    storage-database=eagle</span><br><span class="line">    storage-connection-url=<span class="string">"jdbc:mysql://mysql01:3306/eagle"</span></span><br><span class="line">    storage-connection-props=<span class="string">"encoding=UTF-8"</span></span><br><span class="line">    storage-driver-class=<span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line">    storage-connection-max=30</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment"># eagle {</span></span><br><span class="line"><span class="comment">#   service {</span></span><br><span class="line"><span class="comment">#     storage-type="jdbc"</span></span><br><span class="line"><span class="comment">#     storage-adapter="derby"</span></span><br><span class="line"><span class="comment">#     storage-username="eagle"</span></span><br><span class="line"><span class="comment">#     storage-password=eagle</span></span><br><span class="line"><span class="comment">#     storage-database=eagle</span></span><br><span class="line"><span class="comment">#     storage-connection-url="jdbc:derby:/tmp/eagle-db-dev;create=true"</span></span><br><span class="line"><span class="comment">#     storage-connection-props="encoding=UTF-8"</span></span><br><span class="line"><span class="comment">#     storage-driver-class="org.apache.derby.jdbc.EmbeddedDriver"</span></span><br><span class="line"><span class="comment">#     storage-connection-max=8</span></span><br><span class="line"><span class="comment">#   }</span></span><br><span class="line"><span class="comment"># }</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="启动-5"><a href="#启动-5" class="headerlink" title="启动"></a>启动</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ bin/eagle-service.sh start</span><br><span class="line">$ bin/eagle-service.sh status</span><br><span class="line">  Eagle service is running 17789</span><br><span class="line">$ bin/eagle-topology-init.sh</span><br><span class="line">$ bin/eagle-topology.sh start</span><br><span class="line">$ bin/eagle-topology.sh status</span><br><span class="line">  Checking topology sandbox-hdfsAuditLog-topology status ...</span><br><span class="line">  Topology is alive: sandbox-hdfsAuditLog-topology ACTIVE     7          1            18        </span><br><span class="line"><span class="comment"># 访问 http://eagle01:9099/eagle-service/ui/#/landing</span></span><br><span class="line"><span class="comment"># tail -f logs/eagle-service.out</span></span><br></pre></td></tr></tbody></table></figure>
<p>　至此大功告成~</p>
<p><img data-src="/picture/eagle/apache_eagle_sites_default.png" alt></p>
<h2 id="Eagle-高级玩法"><a href="#Eagle-高级玩法" class="headerlink" title="Eagle 高级玩法"></a>Eagle 高级玩法</h2><h3 id="HBase-Security-Log"><a href="#HBase-Security-Log" class="headerlink" title="HBase Security Log"></a>HBase Security Log</h3><h4 id="HBase-部署"><a href="#HBase-部署" class="headerlink" title="HBase 部署"></a>HBase 部署</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://archive.apache.org/dist/hbase/hbase-0.98.8/hbase-0.98.8-hadoop2-bin.tar.gz</span><br><span class="line">$ tar zxvf hbase-0.98.8-hadoop2-bin.tar.gz -C ~/software/</span><br><span class="line">$ <span class="built_in">cd</span> ~/software</span><br><span class="line">$ ln -s hbase-0.98.8-hadoop2 hbase</span><br><span class="line">$ vim ~/.bashrc</span><br><span class="line">  HBASE_HOME=~/software/hbase</span><br><span class="line">  PATH=<span class="variable">$HBASE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line">$ hbase version</span><br><span class="line">  2017-04-14 16:19:24,992 INFO  [main] util.VersionInfo: HBase 0.98.8-hadoop2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh 免密</span></span><br><span class="line">$ ssh-keygen -t dsa -P <span class="string">''</span> -f /home/eagle/.ssh/id_dsa</span><br><span class="line">$ <span class="built_in">cd</span> /home/eagle/.ssh</span><br><span class="line">$ cat id_rsa.pub &gt; authorized_keys</span><br><span class="line">$ scp /home/eagle/.ssh/authorized_keys eagle@eagle02:/home/eagle/.ssh/</span><br><span class="line">$ chmod 700 -R ~/.ssh</span><br><span class="line">$ chmod 600 ~/.ssh/authorized_keys</span><br><span class="line"><span class="comment"># 配置双向 ssh，则重复上述步骤</span></span><br><span class="line"></span><br><span class="line">$ vim conf/hbase-env.sh</span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=~/software/java</span><br><span class="line">  <span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">$ mkdir -p /home/eagle/data/hbase/tmp</span><br><span class="line">$ vim conf/hbase-site.sh</span><br><span class="line">  &lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;hdfs://eagle01:9000/hbase&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;2181&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;eagle01&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      <span class="comment"># 参考 `~/software/zookeeper/config/zookeeper.properties`</span></span><br><span class="line">      &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;/home/eagle/data/zookeeper&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;zookeeper.znode.parent&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;/hbase&lt;/value&gt; </span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;hbase.tmp.dir&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;/home/eagle/data/hbase/tmp&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">  &lt;/configuration&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="开启-Security-日志"><a href="#开启-Security-日志" class="headerlink" title="开启 Security 日志"></a>开启 Security 日志</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ su - hbase</span><br><span class="line">$ <span class="built_in">cd</span> ~/software/hbase/</span><br><span class="line">$ vim conf/hbase-site.xml</span><br><span class="line">  <span class="comment"># 增加如下配置</span></span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.security.authentication&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;simple&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.security.authorization&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.coprocessor.regionserver.classes&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.hadoop.hbase.security.access.AccessController&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">$ sudo mkdir -p /opt/hbase/logs/security/</span><br><span class="line">$ sudo chown -R eagle:eagle /opt/hbase/</span><br><span class="line">$ vim conf/log4j.properties</span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># Security audit appender</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  hbase.security.log.file=SecurityAuth.audit</span><br><span class="line">  hbase.security.log.maxfilesize=256MB</span><br><span class="line">  hbase.security.log.maxbackupindex=20</span><br><span class="line">  log4j.appender.RFAS=org.apache.log4j.RollingFileAppender</span><br><span class="line">  log4j.appender.RFAS.File=/opt/hbase/logs/security/security.log</span><br><span class="line">  log4j.appender.RFAS.MaxFileSize=<span class="variable">${hbase.security.log.maxfilesize}</span></span><br><span class="line">  log4j.appender.RFAS.MaxBackupIndex=<span class="variable">${hbase.security.log.maxbackupindex}</span></span><br><span class="line">  log4j.appender.RFAS.layout=org.apache.log4j.PatternLayout</span><br><span class="line">  log4j.appender.RFAS.layout.ConversionPattern=%d{ISO8601} %p %c: %m%n</span><br><span class="line">  log4j.category.SecurityLogger=<span class="variable">${hbase.security.logger}</span></span><br><span class="line">  log4j.additivity.SecurityLogger=<span class="literal">false</span></span><br><span class="line">  log4j.logger.SecurityLogger.org.apache.hadoop.hbase.security.access.AccessController=TRACE</span><br><span class="line"></span><br><span class="line">$ bin/start-hbase.sh</span><br><span class="line">$ tail -f /opt/hbase/logs/security/security.log</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Kafka-1"><a href="#Kafka-1" class="headerlink" title="Kafka"></a>Kafka</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 `hbase_security_log` topic</span></span><br><span class="line"><span class="comment"># 如果之前存在可以删除，bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic hbase_security_log（需要先在 config/server.properties 中配置 delete.topic.enable=true）</span></span><br><span class="line">$ bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic hbase_security_log</span><br><span class="line">  Created topic <span class="string">"hbase_security_log"</span>.</span><br><span class="line">$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic hbase_security_log</span><br></pre></td></tr></tbody></table></figure>
<h4 id="LogStash-1"><a href="#LogStash-1" class="headerlink" title="LogStash"></a>LogStash</h4><h5 id="安装-6"><a href="#安装-6" class="headerlink" title="安装"></a>安装</h5><p>　参照上文 <code>Eagle环境搭建</code> - <code>LogStash</code> 部分</p>
<h5 id="配置-5"><a href="#配置-5" class="headerlink" title="配置"></a>配置</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/software/logstash/</span><br><span class="line">$ mkdir -p /data03/hbase/logs/logstash</span><br><span class="line">$ vim conf/hbase-security.conf</span><br><span class="line">  input {</span><br><span class="line">    file {</span><br><span class="line">      <span class="built_in">type</span> =&gt; <span class="string">"hbase-security-log"</span></span><br><span class="line">      path =&gt; <span class="string">"/data03/hbase/logs/security/security.log"</span></span><br><span class="line">      start_position =&gt; end</span><br><span class="line">      sincedb_path =&gt; <span class="string">"/data03/hbase/logs/security/security_monitor.log"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  output {</span><br><span class="line">    <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"hbase-security-log"</span> {</span><br><span class="line">      kafka {</span><br><span class="line">        codec =&gt; plain {</span><br><span class="line">          format =&gt; <span class="string">"%{message}"</span></span><br><span class="line">        }</span><br><span class="line">        bootstrap_servers =&gt; <span class="string">"eagle01:9092"</span></span><br><span class="line">        topic_id =&gt; <span class="string">"hbase_security_log"</span></span><br><span class="line">        timeout_ms =&gt; 10000</span><br><span class="line">        batch_size =&gt; 1000</span><br><span class="line">        retries =&gt; 3</span><br><span class="line">        client_id =&gt; <span class="string">"hbase-security-log"</span></span><br><span class="line">      }</span><br><span class="line">      <span class="comment"># stdout {codec =&gt; rubydebug}</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">$ nohup bin/logstash -f conf/hbase-security.conf &gt; /home/eagle/logs/logstash/hbase_security.log 2&gt;&amp;1 &amp;</span><br><span class="line">$ tail -f /data03/hbase/logs/logstash/hbase_security.log</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Eagle-配置"><a href="#Eagle-配置" class="headerlink" title="Eagle 配置"></a>Eagle 配置</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/sandbox-hbaseSecurityLog-application.conf</span><br><span class="line">  <span class="string">"dataSourceConfig"</span>: {</span><br><span class="line">    <span class="string">"topic"</span> : <span class="string">"hbase_security_log"</span>,    <span class="comment"># 修改 topic</span></span><br><span class="line">    // ...</span><br><span class="line">  },</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Eagle-提交-Topology"><a href="#Eagle-提交-Topology" class="headerlink" title="Eagle 提交 Topology"></a>Eagle 提交 Topology</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bin/eagle-topology.sh --topology sandbox-hbaseSecurityLog-topology --config conf/sandbox--application.conf start</span></span><br><span class="line">$ bin/eagle-topology.sh --main org.apache.eagle.security.hbase.HbaseAuditLogProcessorMain --config conf/sandbox-hbaseSecurityLog-application.conf start</span><br><span class="line">$ bin/eagle-topology.sh --topology sandbox-hbaseSecurityLog-topology status</span><br><span class="line">  Checking topology sandbox-hbaseSecurityLog-topology status ...</span><br><span class="line">  Topology is alive: sandbox-hbaseSecurityLog-topology ACTIVE     7          1            131</span><br><span class="line"><span class="comment"># 关闭 topology</span></span><br><span class="line">$ bin/eagle-topology.sh --topology sandbox-hbaseSecurityLog-topology stop</span><br></pre></td></tr></tbody></table></figure>
<h4 id="配置告警"><a href="#配置告警" class="headerlink" title="配置告警"></a>配置告警</h4><p>　在 <code>Site</code> 中配置好 HBase 的 <code>hbaseSecurityLog</code> <code>application</code> 之后，可以在 <code>Data Classification</code> 中看到如下界面<br><img data-src="/picture/eagle/apache_eagle_hbase_data_classification.png" alt><br>　之后，新建 <code>Policy</code><br><img data-src="/picture/eagle/apache_eagle_hbase_policy_detail.png" alt></p>
<p>参考</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hbase.apache.org/1.1/book.html#_server_side_configuration_for_simple_user_access_operation">Server-side Configuration for Simple User Access Operation</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hbase.apache.org/book.html#security.example.config">Security Configuration Example</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.elastic.co/guide/en/logstash/2.3/plugins-inputs-file.html">Input plugins » file</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.elastic.co/guide/en/logstash/2.3/plugins-outputs-kafka.html">Output plugins » kafka</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/tutorial/topologymanagement.html">Apache Eagle Topology Management</a></li>
</ul>
<h2 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h2><h3 id="RPM"><a href="#RPM" class="headerlink" title="RPM"></a>RPM</h3><h4 id="error-can’t-create-transaction-lock-on-var-lib-rpm-rpm-lock-Permission-denied"><a href="#error-can’t-create-transaction-lock-on-var-lib-rpm-rpm-lock-Permission-denied" class="headerlink" title="error: can’t create transaction lock on /var/lib/rpm/.rpm.lock (Permission denied)"></a>error: can’t create transaction lock on /var/lib/rpm/.rpm.lock (Permission denied)</h4><h5 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h5><p>　增加 sudo<br>　同时，需要保证 user 是在 /etc/sudoers 中的</p>
<h5 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://unix.stackexchange.com/questions/125706/why-cant-i-install-packages-with-rpm-i-get-transaction-lock">why can not I install packages with rpm? I get “transaction lock”[closed]</a></li>
</ul>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><h4 id="zookeeper-jar-3-4-6-2-2-0-0-2041-无法从-Maven-中央仓库下载到"><a href="#zookeeper-jar-3-4-6-2-2-0-0-2041-无法从-Maven-中央仓库下载到" class="headerlink" title="zookeeper:jar:3.4.6.2.2.0.0-2041 无法从 Maven 中央仓库下载到"></a><code>zookeeper:jar:3.4.6.2.2.0.0-2041</code> 无法从 Maven 中央仓库下载到</h4><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p>　后面小版本说明并不是官方提供的 release 版本，是由 hortonworks 之类的第三方平台提供</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean package -T 1C -DskipTests</span><br><span class="line"></span><br><span class="line">　Failed to execute goal on project eagle-log4jkafka: Could not resolve dependencies <span class="keyword">for</span> project org.apache.eagle:eagle-log4jkafka:jar:0.4.0-incubating: The following artifacts could not be resolved: org.apache.kafka:kafka_2.10:jar:0.8.1.2.2.0.0-2041, org.apache.zookeeper:zookeeper:jar:3.4.6.2.2.0.0-2041: Could not transfer artifact org.apache.kafka:kafka_2.10:jar:0.8.1.2.2.0.0-2041 from/to HDP Release Repository (http://repo.hortonworks.com/content/repositories/releases/): GET request of: org/apache/kafka/kafka_2.10/0.8.1.2.2.0.0-2041/kafka_2.10-0.8.1.2.2.0.0-2041.jar from HDP Release Repository failed: Connection reset -&gt; [Help 1]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h5><ul>
<li>检查是否是因为 Maven 没有配置代理<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux (bash)</span></span><br><span class="line">$ <span class="built_in">export</span> MAVEN_OPTS=<span class="string">"-DsocksProxyHost=&lt;proxy host&gt; -DsocksProxyPort=&lt;proxy port&gt;"</span></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">$ <span class="built_in">set</span> MAVEN_OPTS=<span class="string">"-DsocksProxyHost=&lt;proxy host&gt; -DsocksProxyPort=&lt;proxy port&gt;"</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>Maven 中央仓库是否没有提供对应可下载的 Jar</li>
</ul>
<p>　　通过 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://mvnrepository.com/">mvnrepository.com</a> 进行查找，<a target="_blank" rel="external nofollow noopener noreferrer" href="https://mvnrepository.com/artifact/org.apache.kafka/kafka_2.10/0.8.1.2.2.0.0-2041">kafka_2.10-0.8.1.2.2.0.0-2041.jar</a> 的确是存在可以下载，但是 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper/3.4.6.2.2.0.0-2041">zookeeper_3.4.6.2.2.0.0-2041.jar</a> 并没有提供出来<br>　　Apache 官方提供的 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://archive.apache.org">archive.apache.org</a> 中，也只有标准的 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://archive.apache.org/dist/zookeeper/">Stable Release</a></p>
<ul>
<li>自己编译 zookeeper_3.4.6.2.2.0.0-2041.jar</li>
</ul>
<p>　　在 Hortonworks 的 github 分支中并没有提供源码，并且在 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/hortonworks/zookeeper-release/releases">Release</a> 中也找不到对应的版本</p>
<ul>
<li>直接用已经编译好的 Eagle</li>
</ul>
<p>　　<a target="_blank" rel="external nofollow noopener noreferrer" href="http://archive.apache.org/dist/eagle/apache-eagle-0.4.0-incubating/">Apache Archive</a> 中提供了 apache-eagle-0.4.0-incubating-src.tar.gz 源码</p>
<ul>
<li>修改 hadoop.version 使得其依赖的 zookeeper 版本也跟着改变</li>
</ul>
<p>　　<code>-Dhadoop.version=&lt;hadoop version&gt; -Dhbase.version=&lt;hbase version&gt;</code><br>　　例如：<code>mvn clean package -T 1C -DskipTests -Dhadoop.version=2.7.3</code></p>
<p>　已提交 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.apache.org/jira/browse/EAGLE-990">EAGLE-990</a>，欢迎参与讨论</p>
<h5 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://stackoverflow.com/questions/1251192/how-do-i-use-maven-through-a-proxy">How do I use Maven through a proxy?</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://stackoverflow.com/questions/33130388/replace-maven-properties-in-pom-xml-via-command-line">Replace Maven properties in pom.xml via command line</a></li>
</ul>
<h4 id="maven-scala-plugin-版本过低"><a href="#maven-scala-plugin-版本过低" class="headerlink" title="maven-scala-plugin 版本过低"></a>maven-scala-plugin 版本过低</h4><h5 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.scala-tools:maven-scala-plugin:2.15.0:compile</span><br><span class="line"> (default) on project eagle-log4jkafka: wrap: org.apache.commons.exec.ExecuteExc</span><br><span class="line">eption: Process exited with an error: 1(Exit value: 1) -&gt; [Help 1]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim apache-eagle-0.4.0-incubating-src/pom.xml</span><br><span class="line">　&lt;!--&lt;maven-scala.version&gt;2.15.0&lt;/maven-scala.version&gt;--&gt;</span><br><span class="line">　&lt;maven-scala.version&gt;2.15.2&lt;/maven-scala.version&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="rt-jar-is-broken"><a href="#rt-jar-is-broken" class="headerlink" title="rt.jar is broken"></a>rt.jar is broken</h4><h5 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] error: error <span class="keyword">while</span> loading AnnotatedElement, class file <span class="string">'D:\apps\Java\jd</span></span><br><span class="line"><span class="string">k1.8.0_111\jre\lib\rt.jar(java/lang/reflect/AnnotatedElement.class)'</span> is broken</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-3"><a href="#解决-3" class="headerlink" title="解决"></a>解决</h5><p>　这个问题是因为 JDK 版本过高</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># windows</span></span><br><span class="line">$ <span class="built_in">set</span> JAVA_HOME=D:\apps\Java\jdk1.7.0_67</span><br><span class="line">$ <span class="built_in">set</span> MAVEN_HOME=D:\apps\maven\apache-maven-3.3.9</span><br><span class="line">$ <span class="built_in">set</span> PATH=%JAVA_HOME%\bin;%MAVEN_HOME%\bin;%PATH%</span><br><span class="line"><span class="comment"># set 命令只是临时改动，如需应用到系统变量，可以尝试 setx</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="参考-3"><a href="#参考-3" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://stackoverflow.com/questions/26993101/switching-between-different-jdk-versions-in-windows">Switching between different JDK versions in Windows</a></li>
</ul>
<h4 id="eagle-webservice-编译失败"><a href="#eagle-webservice-编译失败" class="headerlink" title="eagle-webservice 编译失败"></a>eagle-webservice 编译失败</h4><h5 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.codehaus.mojo:<span class="built_in">exec</span>-maven-plugin:1.6.0:<span class="built_in">exec</span> (<span class="built_in">exec</span>-ui-install) on project eagle-webservice: Command execution failed. Cannot run program <span class="string">"bash"</span> (<span class="keyword">in</span> directory <span class="string">"F:\eagle\apache-eagle-0.4.0-incubating-src\eagle-webservice"</span>): CreateProcess error=2, ????????? -&gt; [Help 1]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-4"><a href="#解决-4" class="headerlink" title="解决"></a>解决</h5><p>　没有安装 NPM</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装完成后，设置环境变量</span></span><br><span class="line">$ <span class="built_in">set</span> NODE_HOME=D:\apps\nodejs\</span><br><span class="line">$ <span class="built_in">set</span> PATH=%NODE_HOME%;%PATH%</span><br></pre></td></tr></tbody></table></figure>
<h4 id="java-io-IOException-Cannot-run-program-“bash”"><a href="#java-io-IOException-Cannot-run-program-“bash”" class="headerlink" title="java.io.IOException: Cannot run program “bash”"></a>java.io.IOException: Cannot run program “bash”</h4><h5 id="解决-5"><a href="#解决-5" class="headerlink" title="解决"></a>解决</h5><p>　将 Git 的 bash.exe 目录配置到环境变量<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">set</span> PATH=D:\apps\Git\bin;%PATH%</span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="参考-4"><a href="#参考-4" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://stackoverflow.com/questions/15135771/hudson-on-windows-error-java-io-ioexception-cannot-run-program-sh">Hudson on Windows - Error: java.io.IOException: Cannot run program <code>sh</code></a></li>
</ul>
<h4 id="Npm-fetch-失败"><a href="#Npm-fetch-失败" class="headerlink" title="Npm fetch 失败"></a>Npm fetch 失败</h4><h5 id="解决-6"><a href="#解决-6" class="headerlink" title="解决"></a>解决</h5><p>　检查是否配置好代理<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> proxy <span class="string">"http://10.19.110.55:8080/"</span></span><br><span class="line">$ npm config <span class="built_in">set</span> registry <span class="string">"https://registry.npm.taobao.org"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者修改配置</span></span><br><span class="line">$ vim C:\Users\BenedictJin\.npmrc</span><br><span class="line">  proxy=http://10.19.110.55:8080/</span><br><span class="line">  registry=https://registry.npm.taobao.org</span><br></pre></td></tr></tbody></table></figure><br>　另外，如果 npm 调用了 bower 命令，仍然需要给 bower 进行代理设置<br><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ touch C:\Users\BenedictJin\.bowerrc</span><br><span class="line">$ vim C:\Users\BenedictJin\.bowerrc</span><br><span class="line">  {</span><br><span class="line">    <span class="string">"directory"</span>: <span class="string">"bower_components"</span>,</span><br><span class="line">    <span class="string">"proxy"</span>: <span class="string">"http://10.19.110.55:8080/"</span>,</span><br><span class="line">    <span class="string">"https-proxy"</span>:<span class="string">"http://10.19.110.55:8080/"</span>,</span><br><span class="line">    <span class="string">"no-proxy"</span>:<span class="string">"*.yuzhouwan.com"</span></span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p></p>
<div class="note info">默认镜像地址：https://registry.npmjs.com/</div>


<h4 id="application-conf-No-such-file-or-directory"><a href="#application-conf-No-such-file-or-directory" class="headerlink" title="application.conf: No such file or directory"></a>application.conf: No such file or directory</h4><h5 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bin/eagle-service.sh start</span><br><span class="line">cp: cannot create regular file `bin/../lib/tomcat/webapps/eagle-service/WEB-INF/classes/application.conf<span class="string">': No such file or directory</span></span><br><span class="line"><span class="string">cp: cannot create regular file `bin/../lib/tomcat/webapps/eagle-service/WEB-INF/classes/'</span>: No such file or directory</span><br><span class="line">cp: cannot create regular file `bin/../lib/tomcat/webapps/eagle-service/WEB-INF/classes/<span class="string">': No such file or directory</span></span><br><span class="line"><span class="string">Starting eagle service ...</span></span><br><span class="line"><span class="string">Eagle service started.</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-7"><a href="#解决-7" class="headerlink" title="解决"></a>解决</h5><p>　可能是没有将 <code>apache-eagle-0.4.0-incubating-src\eagle-webservice\target</code> 中的 <code>eagle-service.war</code> 正常解压<br>　考虑将 <code>eagle-service</code> 拷贝到 <code>/home/eagle/software/eagle/lib/tomcat/webapps/</code> 中</p>
<h3 id="BootStrap"><a href="#BootStrap" class="headerlink" title="BootStrap"></a>BootStrap</h3><h4 id="Invalid-message-received-with-signature-18245"><a href="#Invalid-message-received-with-signature-18245" class="headerlink" title="Invalid message received with signature 18245"></a>Invalid message received with signature 18245</h4><h5 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问 http://eagle01:9099/eagle-service</span></span><br><span class="line">$ tail -f logs/eagle-service.2017-04-07.log</span><br><span class="line">  Apr 07, 2017 10:59:25 AM org.apache.coyote.ajp.AjpMessage processHeader</span><br><span class="line">SEVERE: Invalid message received with signature 18245</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-8"><a href="#解决-8" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim /home/eagle/software/eagle/lib/tomcat/conf/server.xml</span><br><span class="line">  <span class="comment"># 如果这里没有指定 `AJP` 的 `address` 可访问地址，默认是所有机器都可访问，会报错安全问题，可以依据自己的需求配置好 `address` 来控制访问（这里因为是测试环境，直接绑定了 0.0.0.0 地址）</span></span><br><span class="line">  <span class="comment"># &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span></span><br><span class="line">  <span class="comment"># &lt;Connector port="9009" protocol="AJP/1.3" redirectPort="9443" /&gt;</span></span><br><span class="line">  &lt;Connector port=<span class="string">"9009"</span> protocol=<span class="string">"AJP/1.3"</span> address=<span class="string">"0.0.0.0"</span> redirectPort=<span class="string">"9443"</span> /&gt;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="参考-5"><a href="#参考-5" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.mobibrw.com/2016/5480">Tomcat 7 使用 AJP 协议导致 AJP 端口被意外暴露给外网</a></li>
</ul>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="Host-eagle01-is-not-allowed-to-connect-to-this-MySQL-server"><a href="#Host-eagle01-is-not-allowed-to-connect-to-this-MySQL-server" class="headerlink" title="Host eagle01 is not allowed to connect to this MySQL server"></a>Host <code>eagle01</code> is not allowed to connect to this MySQL server</h4><h5 id="解决-9"><a href="#解决-9" class="headerlink" title="解决"></a>解决</h5><p>　远程连接 MySQL 服务实例的时候，如果当前主机没有响应权限，需要对其赋权</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ su - mysql</span><br><span class="line">$ mysql -uroot -p -S /home/mysql/data/mysql.sock</span><br><span class="line">  <span class="comment"># 允许用户 eagle 从 ip 为 192.168.1.30 的主机连接到 mysql 服务器的 eagle 数据库，并使用 eagle 作为密码</span></span><br><span class="line">  CREATE USER <span class="string">'eagle'</span>@<span class="string">'192.168.1.30'</span> IDENTIFIED BY <span class="string">'eagle'</span>;</span><br><span class="line">  GRANT ALL PRIVILEGES ON eagle.* TO <span class="string">'eagle'</span>@<span class="string">'192.168.1.30'</span> IDENTIFIED BY <span class="string">'eagle'</span> WITH GRANT OPTION;</span><br><span class="line">  FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="参考-6"><a href="#参考-6" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cnblogs.com/xyzdw/archive/2011/08/11/2135227.html">报错:1130-host … is not allowed to connect to this MySql server</a></li>
</ul>
<h4 id="Table-‘eagle-eagleapplicationdesc-eagleapplicationdesc’-doesn’t-exist"><a href="#Table-‘eagle-eagleapplicationdesc-eagleapplicationdesc’-doesn’t-exist" class="headerlink" title="Table ‘eagle.eagleapplicationdesc_eagleapplicationdesc’ doesn’t exist"></a>Table ‘eagle.eagleapplicationdesc_eagleapplicationdesc’ doesn’t exist</h4><h5 id="解决-10"><a href="#解决-10" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 现有的 19 张表</span></span><br><span class="line">$ show tables;</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| Tables_in_eagle                                   |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| alertexecutor_alertexecutor                       |</span><br><span class="line">| alertstream_alertstream                           |</span><br><span class="line">| eagle_metadata_generic_resource                   |</span><br><span class="line">| eagle_metadata_topologyoperation                  |</span><br><span class="line">| eagle_metric                                      |</span><br><span class="line">| eaglefeaturedesc_eaglefeaturedesc                 |</span><br><span class="line">| eaglesiteapplication_eaglesiteapplication         |</span><br><span class="line">| eaglesitedesc_eaglesitedesc                       |</span><br><span class="line">| filesensitivity_filesensitivity                   |</span><br><span class="line">| hbaseresourcesensitivity_hbaseresourcesensitivity |</span><br><span class="line">| hdfsusercommandpattern_hdfsusercommandpattern     |</span><br><span class="line">| hiveresourcesensitivity_hiveresourcesensitivity   |</span><br><span class="line">| ipzone_ipzone                                     |</span><br><span class="line">| mlmodel_mlmodel                                   |</span><br><span class="line">| oozieresourcesensitivity_oozieresourcesensitivity |</span><br><span class="line">| serviceaudit_serviceaudit                         |</span><br><span class="line">| unittest_entityut                                 |</span><br><span class="line">| unittest_testtsentity                             |</span><br><span class="line">| userprofile_schedule_command                      |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发现 `eagle-examples/eagle-cassandra-example/bin/init.sh` 中存在该表</span></span><br><span class="line">$ cp eagle-examples/eagle-cassandra-example/bin/init.sh /home</span><br><span class="line"></span><br><span class="line">$ su - mysql</span><br><span class="line">$ mysql -uroot -p -S /home/mysql/data/mysql.sock</span><br><span class="line">  use eagle;</span><br><span class="line">  <span class="comment"># 创建 缺失的几张表</span></span><br><span class="line">  create table alertnotifications_alertnotifications(</span><br><span class="line">    `uuid` varchar(254) COLLATE utf8_bin NOT NULL,</span><br><span class="line">    `timestamp` bigint(20) DEFAULT NULL,</span><br><span class="line">    `notificationType` varchar(30000),</span><br><span class="line">    `enabled` tinyint(1) DEFAULT NULL,</span><br><span class="line">    `description` mediumtext,</span><br><span class="line">    `className` mediumtext,</span><br><span class="line">    `fields` mediumtext,</span><br><span class="line">    PRIMARY KEY (`uuid`),</span><br><span class="line">    UNIQUE KEY `uuid_UNIQUE` (`uuid`)</span><br><span class="line">  )ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br><span class="line"></span><br><span class="line">  create table eagle_metadata_topologydescription(</span><br><span class="line">    `uuid` varchar(254) COLLATE utf8_bin NOT NULL,</span><br><span class="line">    `timestamp` bigint(20) DEFAULT NULL,</span><br><span class="line">    `topology` varchar(30000),</span><br><span class="line">    `description` mediumtext,</span><br><span class="line">    `exeClass` mediumtext,</span><br><span class="line">    `<span class="built_in">type</span>` mediumtext,</span><br><span class="line">    `version` mediumtext,</span><br><span class="line">    PRIMARY KEY (`uuid`),</span><br><span class="line">    UNIQUE KEY `uuid_UNIQUE` (`uuid`)</span><br><span class="line">  )ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br><span class="line"></span><br><span class="line">  create table eagle_metadata_topologyexecution(</span><br><span class="line">    `uuid` varchar(254) COLLATE utf8_bin NOT NULL,</span><br><span class="line">    `timestamp` bigint(20) DEFAULT NULL,</span><br><span class="line">    site varchar(1024),</span><br><span class="line">    application varchar(1024),</span><br><span class="line">    topology varchar(1024),</span><br><span class="line">    environment varchar(1024),</span><br><span class="line">    status varchar(1024),</span><br><span class="line">    description varchar(1024),</span><br><span class="line">    lastmodifieddate bigint(20),</span><br><span class="line">    fullname varchar(1024),</span><br><span class="line">    url varchar(1024),</span><br><span class="line">    mode varchar(1024),</span><br><span class="line">    PRIMARY KEY (`uuid`),</span><br><span class="line">    UNIQUE KEY `uuid_UNIQUE` (`uuid`)</span><br><span class="line">  )ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br><span class="line"></span><br><span class="line">  create table eagle_metric_dmeta(</span><br><span class="line">    `uuid` varchar(254) COLLATE utf8_bin NOT NULL,</span><br><span class="line">    `timestamp` bigint(20) DEFAULT NULL,</span><br><span class="line">    drillDownPaths mediumtext,</span><br><span class="line">    aggFunctions mediumtext,</span><br><span class="line">    defaultDownSamplingFunction mediumtext,</span><br><span class="line">    defaultAggregateFunction mediumtext,</span><br><span class="line">    resolutions mediumtext,</span><br><span class="line">    downSamplingFunctions mediumtext,</span><br><span class="line">    storeType mediumtext,</span><br><span class="line">    displayName mediumtext,</span><br><span class="line">    PRIMARY KEY (`uuid`),</span><br><span class="line">    UNIQUE KEY `uuid_UNIQUE` (`uuid`)</span><br><span class="line">  )ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ZooKeeper-1"><a href="#ZooKeeper-1" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h3><h4 id="Error-contacting-service-It-is-probably-not-running"><a href="#Error-contacting-service-It-is-probably-not-running" class="headerlink" title="Error contacting service. It is probably not running."></a>Error contacting service. It is probably not running.</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以通过增加 `start-foreground` 参数来排查失败原因</span></span><br><span class="line">$ bin/zkServer.sh start-foreground</span><br><span class="line">  ZooKeeper JMX enabled by default</span><br><span class="line">  Using config: /home/eagle/software/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">  Error: Could not find or load main class org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line"><span class="comment"># /home/eagle/software/zookeeper/zookeeper-3.4.10.jar 的问题，重新下载，校验 md5 正确后，再次安装即可</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Hadoop-1"><a href="#Hadoop-1" class="headerlink" title="Hadoop"></a>Hadoop</h3><h4 id="端口冲突"><a href="#端口冲突" class="headerlink" title="端口冲突"></a>端口冲突</h4><h5 id="解决-11"><a href="#解决-11" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改默认端口（Hadoop 2.7.3）</span></span><br><span class="line">$ vim ~/software/hadoop/etc/hadoop/hdfs-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.http-address&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;0.0.0.0:50070&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="参考-7"><a href="#参考-7" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://hadoop.apache.org/docs/r2.7.3/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hadoop v2.7.3 hdfs-default.xml</a></li>
</ul>
<h3 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h3><h4 id="FAILED-LOOKUP-Can’t-get-master-address-from-ZooKeeper-znode-data-null"><a href="#FAILED-LOOKUP-Can’t-get-master-address-from-ZooKeeper-znode-data-null" class="headerlink" title="FAILED LOOKUP: Can’t get master address from ZooKeeper; znode data == null"></a>FAILED LOOKUP: Can’t get master address from ZooKeeper; znode data == null</h4><h5 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; zk_dump</span><br><span class="line">HBase is rooted at /hbase</span><br><span class="line">Active master address: &lt;&lt;FAILED LOOKUP: Can<span class="string">'t get master address from ZooKeeper; znode data == null&gt;&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-12"><a href="#解决-12" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 </span></span><br><span class="line">/home/eagle/software/hbase/bin/../logs/hbase-eagle-master-federation01.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否禁用了 HBase 自带的 ZooKeeper</span></span><br><span class="line">$ vim ~/software/hbase/conf/hbase-env.sh</span><br><span class="line">  <span class="comment"># Tell HBase whether it should manage it's own instance of ZooKeeper or not.</span></span><br><span class="line">  <span class="comment"># export HBASE_MANAGES_ZK=true</span></span><br><span class="line">  <span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否正确在 `zookeeper.znode.parent` `/hbase` 目录下创建节点</span></span><br><span class="line">$ ~/software/zookeeper/bin/zkCli.sh -server eagle01:2181</span><br><span class="line">　[zk: localhost:2181(CONNECTED) 0] ls /hbase</span><br><span class="line">　[recovering-regions, splitWAL, rs, backup-masters, region-in-transition, draining, table, table-lock]</span><br></pre></td></tr></tbody></table></figure>
<h4 id="The-node-hbase-unsecure-is-not-in-ZooKeeper"><a href="#The-node-hbase-unsecure-is-not-in-ZooKeeper" class="headerlink" title="The node /hbase-unsecure is not in ZooKeeper"></a>The node /hbase-unsecure is not in ZooKeeper</h4><h5 id="解决-13"><a href="#解决-13" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/hbase-site.xml</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;zookeeper.znode.parent&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;/hbase-unsecure&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Storm-1"><a href="#Storm-1" class="headerlink" title="Storm"></a>Storm</h3><h4 id="ResourceManager-unable-to-find-resource-‘templates-ALERT-DEFAULT-vm’-in-any-resource-loader"><a href="#ResourceManager-unable-to-find-resource-‘templates-ALERT-DEFAULT-vm’-in-any-resource-loader" class="headerlink" title="ResourceManager : unable to find resource ‘templates/ALERT_DEFAULT.vm’ in any resource loader"></a>ResourceManager : unable to find resource ‘templates/ALERT_DEFAULT.vm’ in any resource loader</h4><h5 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/software/storm/logs/worker-6703.log</span><br><span class="line">  2017-04-13T11:21:36.481+0800 o.a.velocity [ERROR] ResourceManager : unable to find resource <span class="string">'templates/ALERT_DEFAULT.vm'</span> <span class="keyword">in</span> any resource loader.</span><br><span class="line">  2017-04-13T11:21:36.487+0800 o.a.e.c.e.EagleMailClient [INFO] Send mail failed, got an AddressException: Illegal whitespace <span class="keyword">in</span> address</span><br><span class="line">  javax.mail.internet.AddressException: Illegal whitespace <span class="keyword">in</span> address</span><br><span class="line">          at javax.mail.internet.InternetAddress.checkAddress(InternetAddress.java:926) ~[stormjar.jar:na]</span><br><span class="line">          at javax.mail.internet.InternetAddress.parse(InternetAddress.java:819) ~[stormjar.jar:na]</span><br><span class="line">          at javax.mail.internet.InternetAddress.parse(InternetAddress.java:555) ~[stormjar.jar:na]</span><br><span class="line">          at javax.mail.internet.InternetAddress.&lt;init&gt;(InternetAddress.java:91) ~[stormjar.jar:na]</span><br><span class="line">          at org.apache.eagle.common.email.EagleMailClient._send(EagleMailClient.java:101) [stormjar.jar:na]</span><br><span class="line">          at org.apache.eagle.common.email.EagleMailClient.send(EagleMailClient.java:171) [stormjar.jar:na]</span><br><span class="line">          at org.apache.eagle.common.email.EagleMailClient.send(EagleMailClient.java:192) [stormjar.jar:na]</span><br><span class="line">          at org.apache.eagle.common.email.EagleMailClient.send(EagleMailClient.java:198) [stormjar.jar:na]</span><br><span class="line">          at org.apache.eagle.notification.email.AlertEmailSender.run(AlertEmailSender.java:162) [stormjar.jar:na]</span><br><span class="line">          at java.util.concurrent.Executors<span class="variable">$RunnableAdapter</span>.call(Executors.java:471) [na:1.7.0_80]</span><br><span class="line">          at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_80]</span><br><span class="line">          at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_80]</span><br><span class="line">          at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:615) [na:1.7.0_80]</span><br><span class="line">          at java.lang.Thread.run(Thread.java:745) [na:1.7.0_80]</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-14"><a href="#解决-14" class="headerlink" title="解决"></a>解决</h5><p>　从编译好的 <code>eagle-core</code> 组件中，找到 <code>eagle-alert/eagle-alert-notification-plugin/target/classes</code> 目录，将 <code>ALERT_DEFAULT.vm</code> 文件 copy 到 部署环境的 <code>/home/eagle/software/eagle/lib/tomcat/webapps/eagle-service/templates</code> 目录下</p>
<h5 id="参考-8"><a href="#参考-8" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://stackoverflow.com/questions/36180753/getting-velocity-error-unable-to-find-resource-error-vm-in-any-resource-loade">Getting velocity error “unable to find resource ‘error.vm’ in any resource loader.””</a></li>
</ul>
<h3 id="LogStash-2"><a href="#LogStash-2" class="headerlink" title="LogStash"></a>LogStash</h3><h4 id="ArgumentError-The-“sincedb-path”-argument-must-point-to-a-file-received-a-directory"><a href="#ArgumentError-The-“sincedb-path”-argument-must-point-to-a-file-received-a-directory" class="headerlink" title="ArgumentError: The “sincedb_path” argument must point to a file, received a directory"></a>ArgumentError: The “sincedb_path” argument must point to a file, received a directory</h4><h5 id="解决-15"><a href="#解决-15" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改 `sincedb_path` 为一个文件</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Commit-cannot-be-completed-since-the-group-has-already-rebalanced-and-assigned-the-partitions-to-another-member"><a href="#Commit-cannot-be-completed-since-the-group-has-already-rebalanced-and-assigned-the-partitions-to-another-member" class="headerlink" title="Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member"></a>Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member</h4><h5 id="描述-8"><a href="#描述-8" class="headerlink" title="描述"></a>描述</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN Auto offset commit failed <span class="keyword">for</span> group console-consumer-87542: Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, <span class="built_in">which</span> typically implies that the poll loop is spending too much time message processing. You can address this either by increasing the session timeout or by reducing the maximum size of batches returned <span class="keyword">in</span> poll() with max.poll.records. (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)</span><br></pre></td></tr></tbody></table></figure>
<h5 id="解决-16"><a href="#解决-16" class="headerlink" title="解决"></a>解决</h5><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kafka {</span><br><span class="line">  codec =&gt; plain { format =&gt; "%{message}" }</span><br><span class="line">  bootstrap_servers =&gt; "eagle01:9092"</span><br><span class="line">  topic_id =&gt; "hbase_security_log"</span><br><span class="line">  batch_size =&gt; "1000"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="参考-9"><a href="#参考-9" class="headerlink" title="参考"></a>参考</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.elastic.co/guide/en/logstash/2.3/plugins-outputs-kafka.html#plugins-outputs-kafka-batch_size">Output plugins » kafka - batch_size</a></li>
</ul>
<h3 id="Eagle-1"><a href="#Eagle-1" class="headerlink" title="Eagle"></a>Eagle</h3><h4 id="java-lang-Exception-Exception-When-browsing-Files-in-HDFS-Message-java-net-UnknownHostException-sandbox-hortonworks-com"><a href="#java-lang-Exception-Exception-When-browsing-Files-in-HDFS-Message-java-net-UnknownHostException-sandbox-hortonworks-com" class="headerlink" title="java.lang.Exception:  Exception When browsing Files in HDFS .. Message :  java.net.UnknownHostException: sandbox.hortonworks.com"></a>java.lang.Exception:  Exception When browsing Files in HDFS .. Message :  java.net.UnknownHostException: sandbox.hortonworks.com</h4><h5 id="解决-17"><a href="#解决-17" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/sandbox-hadoopjmx-pipeline.conf</span><br><span class="line">{</span><br><span class="line">  config {</span><br><span class="line">    envContextConfig {</span><br><span class="line">      <span class="string">"topologyName"</span> : <span class="string">"sandbox-hadoopjmx-pipeline"</span></span><br><span class="line">    }</span><br><span class="line">    eagleProps {</span><br><span class="line">      <span class="string">"site"</span> : <span class="string">"sandbox"</span></span><br><span class="line">      <span class="string">"application"</span>: <span class="string">"HADOOP"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  dataflow {</span><br><span class="line">    KafkaSource.hadoopNNJmxStream {</span><br><span class="line">      parallism = 1000</span><br><span class="line">      topic = <span class="string">"nn_jmx_metric_sandbox"</span></span><br><span class="line">      zkConnection = <span class="string">"localhost:2181"</span></span><br><span class="line">      zkConnectionTimeoutMS = 15000</span><br><span class="line">      consumerGroupId = <span class="string">"Consumer"</span></span><br><span class="line">      fetchSize = 1048586</span><br><span class="line">      transactionZKServers = <span class="string">"localhost"</span></span><br><span class="line">      transactionZKPort = 2181</span><br><span class="line">      transactionZKRoot = <span class="string">"/consumers"</span></span><br><span class="line">      transactionStateUpdateMS = 2000</span><br><span class="line">      deserializerClass = <span class="string">"org.apache.eagle.datastream.storm.JsonMessageDeserializer"</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Alert.hadoopNNJmxStreamAlertExecutor {</span><br><span class="line">      upStreamNames = [hadoopNNJmxStream]</span><br><span class="line">      alertExecutorId = hadoopNNJmxStreamAlertExecutor</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    hadoopNNJmxStream -&gt; hadoopNNJmxStreamAlertExecutor{}</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment"># 修改其他配置 conf/sandbox-*</span></span><br><span class="line"><span class="comment"># 或者直接修改 /etc/hosts，添加 `127.0.0.1 sandbox.hortonworks.com`</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="sandbox-hortonworks-com-8020-failed-on-connection-exception"><a href="#sandbox-hortonworks-com-8020-failed-on-connection-exception" class="headerlink" title="sandbox.hortonworks.com:8020 failed on connection exception"></a>sandbox.hortonworks.com:8020 failed on connection exception</h4><h5 id="解决-18"><a href="#解决-18" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://eagle01:9099/eagle-service/ui/#/config/site</span></span><br><span class="line"><span class="comment"># 配置 Sites - Configuration - sandbox - Application - hdfsAuditLog</span></span><br><span class="line">classification.fs.defaultFS=hdfs://eagle01:9000</span><br><span class="line"><span class="comment"># 这里可以参考 core-site.xml 中的 fs.defaultFS 值</span></span><br><span class="line"><span class="comment"># 随后，`Save All`</span></span><br><span class="line"><span class="comment"># 访问 http://eagle01:9099/eagle-service/ui/#/classification/sensitivity，确认已生效</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Topology-with-name-sandbox-hdfsAuditLog-topology-already-exists-on-cluster"><a href="#Topology-with-name-sandbox-hdfsAuditLog-topology-already-exists-on-cluster" class="headerlink" title="Topology with name sandbox-hdfsAuditLog-topology already exists on cluster"></a>Topology with name <code>sandbox-hdfsAuditLog-topology</code> already exists on cluster</h4><h5 id="解决-19"><a href="#解决-19" class="headerlink" title="解决"></a>解决</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ bin/eagle-topology.sh stop</span><br><span class="line"><span class="comment"># wait 30s(default) for `kill` command</span></span><br><span class="line">$ bin/eagle-topology.sh start</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Error-22-38-java-程序包-org-apache-eagle-service-hbase-不存在"><a href="#Error-22-38-java-程序包-org-apache-eagle-service-hbase-不存在" class="headerlink" title="Error:(22, 38) java: 程序包 org.apache.eagle.service.hbase 不存在"></a>Error:(22, 38) java: 程序包 org.apache.eagle.service.hbase 不存在</h4><h5 id="解决-20"><a href="#解决-20" class="headerlink" title="解决"></a>解决</h5><p>　本地运行单元测试 <code>TestHBaseWriteEntitiesPerformance</code> 的时候，报错 import 的某些包不存在</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 Intellij Idea 的 Maven 配置界面，Setting - Maven - Repositeries</span></span><br><span class="line"><span class="comment"># 发现 repo.hortonworks.com &amp; repo.maven.apache.org 两个中央仓库 Update 的状态为 `Error`</span></span><br><span class="line"><span class="comment"># 点击 Update 进行更新</span></span><br></pre></td></tr></tbody></table></figure>
<p>　这里可能需要设置 Maven 的 Proxy 代理，详见我的另一篇博客《<a href="https://yuzhouwan.com/posts/2254/#Maven-Proxy">Maven 高级玩法</a>》</p>
<h2 id="社区跟进"><a href="#社区跟进" class="headerlink" title="社区跟进"></a>社区跟进</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.apache.org/jira/browse/EAGLE-981?jql=project%20%3D%20EAGLE%20AND%20reporter%20in%20(%22benedict%20jin%22)">Issues</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/apache/eagle/pulls?utf8=%E2%9C%93&amp;q=is%3Apr%20author%3Aasdf2014%20">Pull Request</a></li>
</ul>
<p>　详见：《<a href="https://yuzhouwan.com/posts/19631/">如何成为 Apache 的 PMC</a>》</p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><h3 id="Doc"><a href="#Doc" class="headerlink" title="Doc"></a>Doc</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/quick-start.html">Eagle Quick Start</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/apache/eagle/blob/master/docs/docs/getting-started.md">getting-started.md</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/deployment-env.html">Eagle Deploy Environment</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/hbase-data-activity-monitoring.html">HBase Data Activity Monitoring</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/index.html">Apache Eagle Introduction</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/latest/">Apache Eagle Document</a></li>
</ul>
<h3 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h3><h4 id="Eagle-2"><a href="#Eagle-2" class="headerlink" title="Eagle"></a>Eagle</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://blog.csdn.net/lookqlp/article/details/52355683">Apache Eagle 安装</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.csdn.net/article/2015-10-29/2826076">Apache Eagle：eBay 开源分布式实时 Hadoop 数据安全方案</a></li>
</ul>
<h4 id="Hadoop-2"><a href="#Hadoop-2" class="headerlink" title="Hadoop"></a>Hadoop</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hadoop.apache.org/docs/r2.7.3/hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">HDFS Commands Guide</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hadoop.apache.org/docs/r2.7.3/hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystemShell</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://blog.csdn.net/u011281987/article/details/30034143">Hadoop 审计日志配置</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/import-hdfs-auditLog.html">How to stream hdfs log data into Kafka</a></li>
</ul>
<h4 id="LogStash-3"><a href="#LogStash-3" class="headerlink" title="LogStash"></a>LogStash</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.cnblogs.com/hanyifeng/p/5509985.html">Centos7 之安装 Logstash ELK stack 日志管理系统</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://eagle.apache.org/docs/import-hdfs-auditLog.html">How to stream hdfs log data into Kafka</a></li>
</ul>
<h4 id="Kafka-2"><a href="#Kafka-2" class="headerlink" title="Kafka"></a>Kafka</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://my.oschina.net/golang/blog/212769">CentOS 6 安装 Kafka 及使用一</a></li>
</ul>
<h2 id="欢迎加入我们的技术群，一起交流学习"><a href="#欢迎加入我们的技术群，一起交流学习" class="headerlink" title="欢迎加入我们的技术群，一起交流学习"></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/asdf2014/yuzhouwan#technical-discussion-group">欢迎加入我们的技术群，一起交流学习</a></h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">群名称</th>
<th style="text-align:center">群号</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">人工智能（高级）</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=71c6bd3fb0ff01d93abca654140387d99d3be752f92a53c1fbfd27f2dd4b4247"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1020982-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">人工智能（进阶）</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=deb268f65589a1a0a1dbaf7b72c849ed45298697805bef81e0c613dea40cd05e"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1217710-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">BigData</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=f86b3c8de20da1658a3bb42df17a2fc4eee0d75c4a130a63585fdd257e3565ed"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-1670647-blue.svg" alt></a></td>
</tr>
<tr>
<td style="text-align:center">算法</td>
<td style="text-align:center"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://shang.qq.com/wpa/qunwpa?idkey=bfbcf1453371a0810fd6be235ace47147f6fb9d262fb768b497c861f50af0af4"><img data-src="https://img.shields.io/badge/QQ%E7%BE%A4-5366753-blue.svg" alt></a></td>
</tr>
</tbody>
</table>
</div>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/31915/" rel="bookmark">ZooKeeper 原理与优化</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/19631/" rel="bookmark">如何成为 Apache 的 PMC</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/26002/" rel="bookmark">Apache Kafka 分布式消息队列框架</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/54206/" rel="bookmark">大数据生态圈里的一致性算法</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/25015/" rel="bookmark">Apache Storm 与 Kafka 的整合应用</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Benedict Jin
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://yuzhouwan.com/posts/39683/" title="Apache Eagle 深度调研">https://yuzhouwan.com/posts/39683/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Apache-Storm/" rel="tag"># Apache Storm</a>
              <a href="/tags/Apache-Kafka/" rel="tag"># Apache Kafka</a>
              <a href="/tags/Apache-Hadoop/" rel="tag"># Apache Hadoop</a>
              <a href="/tags/Apache-ZooKeeper/" rel="tag"># Apache ZooKeeper</a>
              <a href="/tags/ElasticSearch/" rel="tag"># ElasticSearch</a>
              <a href="/tags/Apache-Eagle/" rel="tag"># Apache Eagle</a>
              <a href="/tags/Apache-HBase/" rel="tag"># Apache HBase</a>
              <a href="/tags/Apache-Yarn/" rel="tag"># Apache Yarn</a>
              <a href="/tags/LogStash/" rel="tag"># LogStash</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/743/" rel="prev" title="Apache Superset 二次开发">
      <i class="fa fa-chevron-left"></i> Apache Superset 二次开发
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/15691/" rel="next" title="Linux 实战技巧">
      Linux 实战技巧 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-gitalk">Gitalk：可用 Github 账号登录</a></li>
            <li class="tab"><a href="#comment-disqus">Disqus：海外</a></li>
            <li class="tab"><a href="#comment-valine">Valine：匿名</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments" id="gitalk-container"></div>
            </div>
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Site"><span class="nav-number">1.1.</span> <span class="nav-text">Site</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application"><span class="nav-number">1.2.</span> <span class="nav-text">Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stream"><span class="nav-number">1.3.</span> <span class="nav-text">Stream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Activity-Monitoring"><span class="nav-number">1.4.</span> <span class="nav-text">Data Activity Monitoring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alert-Engine"><span class="nav-number">1.5.</span> <span class="nav-text">Alert Engine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Policy"><span class="nav-number">1.6.</span> <span class="nav-text">Policy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alert"><span class="nav-number">1.7.</span> <span class="nav-text">Alert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alert-Publisher"><span class="nav-number">1.8.</span> <span class="nav-text">Alert Publisher</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">核心架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%86%B5"><span class="nav-number">2.1.</span> <span class="nav-text">概况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84"><span class="nav-number">2.2.</span> <span class="nav-text">架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%8A%E8%AD%A6"><span class="nav-number">2.3.</span> <span class="nav-text">告警</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8"><span class="nav-number">2.4.</span> <span class="nav-text">存储</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-number">3.</span> <span class="nav-text">主要功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E6%8E%A5%E5%85%A5%E5%92%8C%E5%AD%98%E5%82%A8"><span class="nav-number">3.1.</span> <span class="nav-text">数据流接入和存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Metrics-%E5%AD%98%E5%82%A8"><span class="nav-number">3.1.1.</span> <span class="nav-text">Metrics 存储</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E5%A4%84%E7%90%86"><span class="nav-number">3.2.</span> <span class="nav-text">数据实时处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E5%A4%84%E7%90%86-API"><span class="nav-number">3.2.1.</span> <span class="nav-text">流处理 API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%8A%E8%AD%A6%E6%A1%86%E6%9E%B6"><span class="nav-number">3.2.2.</span> <span class="nav-text">告警框架</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eagle-%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.3.</span> <span class="nav-text">Eagle 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">3.3.1.</span> <span class="nav-text">策略管理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.3.2.</span> <span class="nav-text">查询服务</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E4%B8%80%E4%BA%8B%E4%BB%B6%E6%89%A7%E8%A1%8C%E7%AD%96%E7%95%A5%EF%BC%88%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE-Hive-%E4%B8%AD%E7%9A%84%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E5%88%97%EF%BC%89"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">单一事件执行策略（用户访问 Hive 中的敏感数据列）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%AA%97%E5%8F%A3%E7%9A%84%E7%AD%96%E7%95%A5%EF%BC%88%E7%94%A8%E6%88%B7%E5%9C%A8-10-%E5%88%86%E9%92%9F%E5%86%85%E8%AE%BF%E9%97%AE%E7%9B%AE%E5%BD%95-tmp-private-%E5%A4%9A%E4%BA%8E-inverted-5-%E6%AC%A1%EF%BC%89"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">基于窗口的策略（用户在 10 分钟内访问目录 &#x2F;tmp&#x2F;private 多于 inverted 5 次）</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">4.</span> <span class="nav-text">适用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B4%BB%E5%8A%A8%E7%9B%91%E6%8E%A7"><span class="nav-number">4.1.</span> <span class="nav-text">数据活动监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">4.2.</span> <span class="nav-text">任务性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">4.3.</span> <span class="nav-text">集群性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ebay%EF%BC%882015%EF%BC%89"><span class="nav-number">4.4.</span> <span class="nav-text">Ebay（2015）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">5.</span> <span class="nav-text">优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">5.1.</span> <span class="nav-text">优点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E6%8B%93%E5%B1%95%E6%80%A7"><span class="nav-number">5.1.1.</span> <span class="nav-text">高拓展性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E4%BC%B8%E7%BC%A9"><span class="nav-number">5.1.2.</span> <span class="nav-text">可伸缩</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E6%80%A7"><span class="nav-number">5.1.3.</span> <span class="nav-text">实时性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE"><span class="nav-number">5.1.4.</span> <span class="nav-text">动态配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8"><span class="nav-number">5.1.5.</span> <span class="nav-text">简单易用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A0%E4%BE%B5%E5%85%A5%E6%80%A7"><span class="nav-number">5.1.6.</span> <span class="nav-text">无侵入性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E6%88%B7Profile"><span class="nav-number">5.1.7.</span> <span class="nav-text">用户Profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%BA%90"><span class="nav-number">5.1.8.</span> <span class="nav-text">开源</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">5.2.</span> <span class="nav-text">缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E5%89%8D%E6%B5%81%E8%A1%8C%E5%BA%A6%E8%BE%83%E5%B7%AE"><span class="nav-number">5.2.1.</span> <span class="nav-text">目前流行度较差</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%B3%E5%AE%9A%E6%80%A7%E7%95%A5%E4%B8%8D%E8%B6%B3"><span class="nav-number">5.2.2.</span> <span class="nav-text">稳定性略不足</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E7%9B%B8%E5%AF%B9%E8%BE%83%E5%B7%AE"><span class="nav-number">5.2.3.</span> <span class="nav-text">代码质量相对较差</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9-HBase-%E7%9A%84%E6%94%AF%E6%8C%81%E5%BA%A6"><span class="nav-number">6.</span> <span class="nav-text">对 HBase 的支持度</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E5%AF%B9%E8%A1%A8"><span class="nav-number">6.1.</span> <span class="nav-text">比对表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.2.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Eagle-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">7.</span> <span class="nav-text">Eagle 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6"><span class="nav-number">7.1.</span> <span class="nav-text">组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E5%BC%8F%E5%B9%B3%E5%8F%B0%E4%BE%9D%E8%B5%96"><span class="nav-number">7.1.1.</span> <span class="nav-text">流式平台依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BE%9D%E8%B5%96%EF%BC%88Choose-one-of-them%EF%BC%89"><span class="nav-number">7.1.2.</span> <span class="nav-text">数据库依赖（Choose one of them）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B2%99%E7%AE%B1"><span class="nav-number">7.1.3.</span> <span class="nav-text">沙箱</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="nav-number">7.2.</span> <span class="nav-text">基础环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux"><span class="nav-number">7.2.1.</span> <span class="nav-text">Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8%E6%88%B7"><span class="nav-number">7.2.1.1.</span> <span class="nav-text">用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">7.2.1.2.</span> <span class="nav-text">目录</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96"><span class="nav-number">7.2.2.</span> <span class="nav-text">依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JDK"><span class="nav-number">7.2.2.1.</span> <span class="nav-text">JDK</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hadoop"><span class="nav-number">7.2.2.2.</span> <span class="nav-text">Hadoop</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96-1"><span class="nav-number">7.2.2.2.1.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">7.2.2.2.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">7.2.2.2.3.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F"><span class="nav-number">7.2.2.2.4.</span> <span class="nav-text">伪分布式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Yarn"><span class="nav-number">7.2.2.2.5.</span> <span class="nav-text">Yarn</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8"><span class="nav-number">7.2.2.2.6.</span> <span class="nav-text">启动</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LogStash"><span class="nav-number">7.2.2.3.</span> <span class="nav-text">LogStash</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">7.2.2.3.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="nav-number">7.2.2.3.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-1"><span class="nav-number">7.2.2.3.3.</span> <span class="nav-text">启动</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ZooKeeper"><span class="nav-number">7.2.2.4.</span> <span class="nav-text">ZooKeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-2"><span class="nav-number">7.2.2.4.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-2"><span class="nav-number">7.2.2.4.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-2"><span class="nav-number">7.2.2.4.3.</span> <span class="nav-text">启动</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Storm"><span class="nav-number">7.2.2.5.</span> <span class="nav-text">Storm</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-3"><span class="nav-number">7.2.2.5.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-3"><span class="nav-number">7.2.2.5.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-3"><span class="nav-number">7.2.2.5.3.</span> <span class="nav-text">启动</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kafka"><span class="nav-number">7.2.2.6.</span> <span class="nav-text">Kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Scala%E4%BE%9D%E8%B5%96"><span class="nav-number">7.2.2.6.1.</span> <span class="nav-text">Scala依赖</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-4"><span class="nav-number">7.2.2.6.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-4"><span class="nav-number">7.2.2.6.3.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-4"><span class="nav-number">7.2.2.6.4.</span> <span class="nav-text">启动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Eagle"><span class="nav-number">7.2.3.</span> <span class="nav-text">Eagle</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">7.2.3.1.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-5"><span class="nav-number">7.2.3.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Eagle"><span class="nav-number">7.2.3.3.</span> <span class="nav-text">配置 Eagle</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-number">7.2.3.4.</span> <span class="nav-text">元数据存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-5"><span class="nav-number">7.2.3.5.</span> <span class="nav-text">启动</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Eagle-%E9%AB%98%E7%BA%A7%E7%8E%A9%E6%B3%95"><span class="nav-number">8.</span> <span class="nav-text">Eagle 高级玩法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HBase-Security-Log"><span class="nav-number">8.1.</span> <span class="nav-text">HBase Security Log</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HBase-%E9%83%A8%E7%BD%B2"><span class="nav-number">8.1.1.</span> <span class="nav-text">HBase 部署</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%90%AF-Security-%E6%97%A5%E5%BF%97"><span class="nav-number">8.1.2.</span> <span class="nav-text">开启 Security 日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kafka-1"><span class="nav-number">8.1.3.</span> <span class="nav-text">Kafka</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LogStash-1"><span class="nav-number">8.1.4.</span> <span class="nav-text">LogStash</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-6"><span class="nav-number">8.1.4.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-5"><span class="nav-number">8.1.4.2.</span> <span class="nav-text">配置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Eagle-%E9%85%8D%E7%BD%AE"><span class="nav-number">8.1.5.</span> <span class="nav-text">Eagle 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Eagle-%E6%8F%90%E4%BA%A4-Topology"><span class="nav-number">8.1.6.</span> <span class="nav-text">Eagle 提交 Topology</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%91%8A%E8%AD%A6"><span class="nav-number">8.1.7.</span> <span class="nav-text">配置告警</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91"><span class="nav-number">9.</span> <span class="nav-text">踩过的坑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RPM"><span class="nav-number">9.1.</span> <span class="nav-text">RPM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#error-can%E2%80%99t-create-transaction-lock-on-var-lib-rpm-rpm-lock-Permission-denied"><span class="nav-number">9.1.1.</span> <span class="nav-text">error: can’t create transaction lock on &#x2F;var&#x2F;lib&#x2F;rpm&#x2F;.rpm.lock (Permission denied)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3"><span class="nav-number">9.1.1.1.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-1"><span class="nav-number">9.1.1.2.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Maven"><span class="nav-number">9.2.</span> <span class="nav-text">Maven</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zookeeper-jar-3-4-6-2-2-0-0-2041-%E6%97%A0%E6%B3%95%E4%BB%8E-Maven-%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93%E4%B8%8B%E8%BD%BD%E5%88%B0"><span class="nav-number">9.2.1.</span> <span class="nav-text">zookeeper:jar:3.4.6.2.2.0.0-2041 无法从 Maven 中央仓库下载到</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0"><span class="nav-number">9.2.1.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-1"><span class="nav-number">9.2.1.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-2"><span class="nav-number">9.2.1.3.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#maven-scala-plugin-%E7%89%88%E6%9C%AC%E8%BF%87%E4%BD%8E"><span class="nav-number">9.2.2.</span> <span class="nav-text">maven-scala-plugin 版本过低</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-1"><span class="nav-number">9.2.2.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-2"><span class="nav-number">9.2.2.2.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rt-jar-is-broken"><span class="nav-number">9.2.3.</span> <span class="nav-text">rt.jar is broken</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-2"><span class="nav-number">9.2.3.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-3"><span class="nav-number">9.2.3.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-3"><span class="nav-number">9.2.3.3.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eagle-webservice-%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5"><span class="nav-number">9.2.4.</span> <span class="nav-text">eagle-webservice 编译失败</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-3"><span class="nav-number">9.2.4.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-4"><span class="nav-number">9.2.4.2.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-io-IOException-Cannot-run-program-%E2%80%9Cbash%E2%80%9D"><span class="nav-number">9.2.5.</span> <span class="nav-text">java.io.IOException: Cannot run program “bash”</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-5"><span class="nav-number">9.2.5.1.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-4"><span class="nav-number">9.2.5.2.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Npm-fetch-%E5%A4%B1%E8%B4%A5"><span class="nav-number">9.2.6.</span> <span class="nav-text">Npm fetch 失败</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-6"><span class="nav-number">9.2.6.1.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#application-conf-No-such-file-or-directory"><span class="nav-number">9.2.7.</span> <span class="nav-text">application.conf: No such file or directory</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-4"><span class="nav-number">9.2.7.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-7"><span class="nav-number">9.2.7.2.</span> <span class="nav-text">解决</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BootStrap"><span class="nav-number">9.3.</span> <span class="nav-text">BootStrap</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Invalid-message-received-with-signature-18245"><span class="nav-number">9.3.1.</span> <span class="nav-text">Invalid message received with signature 18245</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-5"><span class="nav-number">9.3.1.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-8"><span class="nav-number">9.3.1.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-5"><span class="nav-number">9.3.1.3.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL"><span class="nav-number">9.4.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Host-eagle01-is-not-allowed-to-connect-to-this-MySQL-server"><span class="nav-number">9.4.1.</span> <span class="nav-text">Host eagle01 is not allowed to connect to this MySQL server</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-9"><span class="nav-number">9.4.1.1.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-6"><span class="nav-number">9.4.1.2.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Table-%E2%80%98eagle-eagleapplicationdesc-eagleapplicationdesc%E2%80%99-doesn%E2%80%99t-exist"><span class="nav-number">9.4.2.</span> <span class="nav-text">Table ‘eagle.eagleapplicationdesc_eagleapplicationdesc’ doesn’t exist</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-10"><span class="nav-number">9.4.2.1.</span> <span class="nav-text">解决</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-1"><span class="nav-number">9.5.</span> <span class="nav-text">ZooKeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Error-contacting-service-It-is-probably-not-running"><span class="nav-number">9.5.1.</span> <span class="nav-text">Error contacting service. It is probably not running.</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hadoop-1"><span class="nav-number">9.6.</span> <span class="nav-text">Hadoop</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81"><span class="nav-number">9.6.1.</span> <span class="nav-text">端口冲突</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-11"><span class="nav-number">9.6.1.1.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-7"><span class="nav-number">9.6.1.2.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HBase"><span class="nav-number">9.7.</span> <span class="nav-text">HBase</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FAILED-LOOKUP-Can%E2%80%99t-get-master-address-from-ZooKeeper-znode-data-null"><span class="nav-number">9.7.1.</span> <span class="nav-text">FAILED LOOKUP: Can’t get master address from ZooKeeper; znode data &#x3D;&#x3D; null</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-6"><span class="nav-number">9.7.1.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-12"><span class="nav-number">9.7.1.2.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-node-hbase-unsecure-is-not-in-ZooKeeper"><span class="nav-number">9.7.2.</span> <span class="nav-text">The node &#x2F;hbase-unsecure is not in ZooKeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-13"><span class="nav-number">9.7.2.1.</span> <span class="nav-text">解决</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Storm-1"><span class="nav-number">9.8.</span> <span class="nav-text">Storm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ResourceManager-unable-to-find-resource-%E2%80%98templates-ALERT-DEFAULT-vm%E2%80%99-in-any-resource-loader"><span class="nav-number">9.8.1.</span> <span class="nav-text">ResourceManager : unable to find resource ‘templates&#x2F;ALERT_DEFAULT.vm’ in any resource loader</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-7"><span class="nav-number">9.8.1.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-14"><span class="nav-number">9.8.1.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-8"><span class="nav-number">9.8.1.3.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LogStash-2"><span class="nav-number">9.9.</span> <span class="nav-text">LogStash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ArgumentError-The-%E2%80%9Csincedb-path%E2%80%9D-argument-must-point-to-a-file-received-a-directory"><span class="nav-number">9.9.1.</span> <span class="nav-text">ArgumentError: The “sincedb_path” argument must point to a file, received a directory</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-15"><span class="nav-number">9.9.1.1.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Commit-cannot-be-completed-since-the-group-has-already-rebalanced-and-assigned-the-partitions-to-another-member"><span class="nav-number">9.9.2.</span> <span class="nav-text">Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0-8"><span class="nav-number">9.9.2.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-16"><span class="nav-number">9.9.2.2.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E8%80%83-9"><span class="nav-number">9.9.2.3.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eagle-1"><span class="nav-number">9.10.</span> <span class="nav-text">Eagle</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#java-lang-Exception-Exception-When-browsing-Files-in-HDFS-Message-java-net-UnknownHostException-sandbox-hortonworks-com"><span class="nav-number">9.10.1.</span> <span class="nav-text">java.lang.Exception:  Exception When browsing Files in HDFS .. Message :  java.net.UnknownHostException: sandbox.hortonworks.com</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-17"><span class="nav-number">9.10.1.1.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sandbox-hortonworks-com-8020-failed-on-connection-exception"><span class="nav-number">9.10.2.</span> <span class="nav-text">sandbox.hortonworks.com:8020 failed on connection exception</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-18"><span class="nav-number">9.10.2.1.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Topology-with-name-sandbox-hdfsAuditLog-topology-already-exists-on-cluster"><span class="nav-number">9.10.3.</span> <span class="nav-text">Topology with name sandbox-hdfsAuditLog-topology already exists on cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-19"><span class="nav-number">9.10.3.1.</span> <span class="nav-text">解决</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Error-22-38-java-%E7%A8%8B%E5%BA%8F%E5%8C%85-org-apache-eagle-service-hbase-%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="nav-number">9.10.4.</span> <span class="nav-text">Error:(22, 38) java: 程序包 org.apache.eagle.service.hbase 不存在</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-20"><span class="nav-number">9.10.4.1.</span> <span class="nav-text">解决</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BE%E5%8C%BA%E8%B7%9F%E8%BF%9B"><span class="nav-number">10.</span> <span class="nav-text">社区跟进</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90"><span class="nav-number">11.</span> <span class="nav-text">资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Doc"><span class="nav-number">11.1.</span> <span class="nav-text">Doc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blog"><span class="nav-number">11.2.</span> <span class="nav-text">Blog</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Eagle-2"><span class="nav-number">11.2.1.</span> <span class="nav-text">Eagle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hadoop-2"><span class="nav-number">11.2.2.</span> <span class="nav-text">Hadoop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LogStash-3"><span class="nav-number">11.2.3.</span> <span class="nav-text">LogStash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kafka-2"><span class="nav-number">11.2.4.</span> <span class="nav-text">Kafka</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E5%8A%A0%E5%85%A5%E6%88%91%E4%BB%AC%E7%9A%84%E6%8A%80%E6%9C%AF%E7%BE%A4%EF%BC%8C%E4%B8%80%E8%B5%B7%E4%BA%A4%E6%B5%81%E5%AD%A6%E4%B9%A0"><span class="nav-number">12.</span> <span class="nav-text">欢迎加入我们的技术群，一起交流学习</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Benedict Jin" src="/yuzhouwan_logo_128x128.ico">
  <p class="site-author-name" itemprop="name">Benedict Jin</p>
  <div class="site-description" itemprop="description">Benedict Jin's Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">147</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/asdf2014" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;asdf2014" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:asdf2014@apache.org" title="E-Mail → mailto:asdf2014@apache.org" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">苏 ICP 备 17032505号 </a>
  </div>

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuzhouwan.com</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">20:04</span>
</div>

        
<meta name="referrer" content="always">
<div class="busuanzi-count">
  <script async src="/lib/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.5/lib/darkmode-js.min.js"></script>
<script>
var options = {
  bottom: '32px', // default: '32px'
  right: '32px', // default: '32px'
  left: 'unset', // default: 'unset'
  time: '0.5s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: '🌓', // default: ''
  autoMatchOsTheme: false // default: true
}
const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
<style>
button.darkmode-toggle {
  z-index: 9999;
}
img, .darkmode-ignore {
  isolation: isolate;
  display: block;
}
</style>

  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

<script>
  var disqus_config = function() {
    this.page.url = "https://yuzhouwan.com/posts/39683/";
    this.page.identifier = "posts/39683/";
    this.page.title = "Apache Eagle 深度调研";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://yuzhouwan.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'e5da61069b94deb8ef3a',
      clientSecret: 'c60ad4e430be258b705027a036eeee3d71cb934b',
      repo        : 'gitment',
      owner       : 'asdf2014',
      admin       : ['asdf2014'],
      id          : 'ec8444abd3bcdde506c344117269f5fd',
        language: '',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'BU4bnWsdAliFfk3fz7iMcFUU-gzGzoHsz',
      appKey     : '1xVLNFSy1qGCda3wt4GiGzHG',
      placeholder: "上述信息都不是必填的，可以直接提交评论",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
